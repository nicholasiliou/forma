import{a as zn,r as E,R as r}from"./vendor-react-Cs6emsHv.js";import{u as tt,a as bn,b as vt,e as Gn,C as $n}from"./vendor-r3f-B-AqW_u7.js";import{j as Hn,k as jt,l as En,m as Vn,n as st,F as wn,o as ke,d as Ee,h as Me,p as Pe,q as at,r as Un,s as Kn,D as Yn,I as qn,c as oe,Q as xt,t as bt,u as Xn,v as vn,w as Zn,x as Qn,y as Mt,z as Jn,E as kn,G as er,H as tr,J as nr,K as Et,X as rr,Y as zt,Z as or,_ as sr,$ as ar,M as Tt,a0 as ir,a1 as Mn,a2 as Ue,a3 as ot,a4 as lr,f as cr,a5 as ur,a6 as dr,a7 as mr,a8 as pr,a9 as fr,aa as hr,ab as St,P as gr,ac as Tn,O as yr,ad as xr,ae as br,af as Er,ag as wr,ah as Sn,ai as vr,T as Xt,aj as Zt,ak as Qt,al as Jt,am as en,an as kr,ao as Mr,ap as Tr,aq as Sr,ar as Ar,as as Rr,at as Cr,au as tn,av as Gt,aw as An,ax as Lr,ay as _r,az as Pr,aA as Ir,aB as Qe,aC as Je,aD as nn,aE as wt}from"./vendor-three-DkcKf3_u.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();var Rn,Dr=zn;Rn=Dr.createRoot;const f={font:{display:'"Space Grotesk", system-ui, sans-serif',body:'"Inter", system-ui, sans-serif'},color:{bgDeep:"#05080f",bgGlass:"rgba(17, 24, 39, 0.88)",accent:"#60a5fa",accentGlow:"#38bdf8",accentWarm:"#f59e0b",accentSuccess:"#10b981",textPrimary:"#f8fafc",textSecondary:"rgba(248, 250, 252, 0.7)",textTertiary:"rgba(248, 250, 252, 0.4)",textMuted:"rgba(248, 250, 252, 0.25)",borderSubtle:"rgba(255, 255, 255, 0.06)",borderDefault:"rgba(255, 255, 255, 0.1)"},radius:{sm:"8px",md:"12px",lg:"16px"}},Fe=.08,$e=.92,He={FADE_DURATION:500,FADE_STEPS:20,TARGET_VOLUME:1},Vt={"Squat (Barbell)":["left_quad","right_quad","left_glute","right_glute"],"Seated Leg Press (Machine)":["left_quad","right_quad","left_glute","right_glute"],"Leg Extension (Machine)":["left_quad","right_quad"],"Seated Leg Curl (Machine)":["left_quad","right_quad"],"Lying Leg Curl (Machine)":["left_quad","right_quad"],"Hip Abductor (Machine)":["left_glute","right_glute"],"Hip Adductor (Machine)":["left_quad","right_quad"],"Hip Thrust (Barbell)":["left_glute","right_glute"],"Romanian Deadlift (Barbell)":["left_glute","right_glute","left_quad","right_quad"],"Standing Calf Raise (Machine)":["left_calf","right_calf"],"Seated Calf Raise (Plate Loaded)":["left_calf","right_calf"],"Bench Press (Barbell)":["chest_left","chest_right","left_shoulder","right_shoulder"],"Bench Press - Wide Grip (Barbell)":["chest_left","chest_right","left_shoulder","right_shoulder"],"Chest Fly":["chest_left","chest_right"],"Incline Chest Press (Machine)":["chest_left","chest_right","left_shoulder","right_shoulder"],"Pull Up":["back","left_bicep","right_bicep"],"Pull Up (Assisted)":["back","left_bicep","right_bicep"],"Lat Pulldown (Cable)":["back","left_bicep","right_bicep"],"Seated Row (Cable)":["back","left_bicep","right_bicep"],"Seated Row (Machine)":["back","left_bicep","right_bicep"],"Seated Wide-Grip Row (Cable)":["back","left_bicep","right_bicep"],"Rowing (Machine)":["back","left_quad","right_quad"],"Reverse Fly (Machine)":["back","left_shoulder","right_shoulder"],"Shoulder Press (Plate Loaded)":["left_shoulder","right_shoulder"],"Shoulder Press (Machine)":["left_shoulder","right_shoulder"],"Seated Overhead Press (Barbell)":["left_shoulder","right_shoulder"],"Front Raise (Cable)":["left_shoulder","right_shoulder"],"Bicep Curl (Barbell)":["left_bicep","right_bicep"],"Bicep Curl (Machine)":["left_bicep","right_bicep"],"Bicep Curl (Cable)":["left_bicep","right_bicep"],"Bicep Curl (Dumbbell)":["left_bicep","right_bicep"],"Skullcrusher (Barbell)":["left_forearm","right_forearm"],"Skullcrusher (Dumbbell)":["left_forearm","right_forearm"],"Triceps Pushdown (Cable - Straight Bar)":["left_forearm","right_forearm"],"Triceps Extension (Cable)":["left_forearm","right_forearm"],"Triceps Extension (Machine)":["left_forearm","right_forearm"],"Crunch (Machine)":["abs_upper","abs_lower"],"Running (Treadmill)":["left_quad","right_quad","left_calf","right_calf"],Hiking:["left_quad","right_quad","left_calf","right_calf","left_glute","right_glute"]};function Or(i,n){const t=[];let e="",o=!1;for(let s=0;s<i.length;s++){const a=i[s];a==='"'?o=!o:a===n&&!o?(t.push(e.trim().replace(/^"|"$/g,"")),e=""):e+=a}return t.push(e.trim().replace(/^"|"$/g,"")),t}function Nr(i){console.log("[WorkoutLoader] Parsing CSV, length:",i?.length);const n=i.trim().split(`
`),t=n[0],e=t.includes(";")?";":",";console.log("[WorkoutLoader] Using delimiter:",e===";"?"semicolon":"comma"),t.split(e);const o=new Map;for(let l=1;l<n.length;l++){const c=Or(n[l],e);if(c.length<5)continue;const u=parseInt(c[0],10);if(isNaN(u))continue;const m=c[1],d=c[2],p=parseInt(c[3],10)||0,y=c[4],M=parseFloat(c[6])||0,v=parseInt(c[7],10)||0;o.has(u)||o.set(u,{id:u,date:m,name:d,durationSec:p,exercises:new Map,muscleVolumes:{}});const b=o.get(u);if(y&&y!=="Exercise Name"){b.exercises.has(y)||b.exercises.set(y,{sets:0,totalVolume:0});const h=b.exercises.get(y);v>0&&(h.sets++,h.totalVolume+=M*v)}}const s=Array.from(o.values()),a=s.filter(l=>{const c=l.exercises.size>0,u=Array.from(l.exercises.values()).some(m=>m.totalVolume>0);return(!c||!u)&&console.log("[WorkoutLoader] Dropping empty workout:",l.id,l.name),c&&u});return console.log("[WorkoutLoader] Parsed",s.length,"workouts,",a.length,"after filtering empty"),a}function Fr(i){const n={};let t=0;const e=i.exercises instanceof Map?Array.from(i.exercises.entries()):Object.entries(i.exercises);for(const[s,a]of e){const l=Vt[s]||[],c=a.totalVolume||a.sets*10;for(const u of l)n[u]=(n[u]||0)+c,n[u]>t&&(t=n[u])}const o={};if(t>0)for(const s in n)o[s]=n[s]/t;return{normalized:o,raw:n}}function Br(i){if(i.length===0)return{checkpoints:[],snapThreshold:.02};const n=i.map(h=>{let x=0;for(const[,A]of h.exercises)x+=A.totalVolume;return x}),t=Math.max(...n,1),e=Math.min(...n,0),o=t-e||1,s=i.map(h=>{const x=h.date.replace(/"/g,"");return new Date(x.replace(" ","T")).getTime()}),a=[];for(let h=0;h<s.length;h++)if(h===0)a.push(0);else{const x=s[h]-s[h-1],A=7*24*60*60*1e3,C=x>A?A+Math.sqrt(x-A)*1e3:x;a.push(C)}const l=[];let c=0;for(const h of a)c+=h,l.push(c);const u=c||1,m=i.map((h,x)=>{const{normalized:A,raw:C}=Fr(h),S=h.date.replace(/"/g,""),R=new Date(S.replace(" ","T")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),k=(n[x]-e)/o,P=.5,B=P+k*(4-P),_=.02+l[x]/u*.96;return{id:h.id,position:_,elevation:B,totalVolume:n[x],durationSec:h.durationSec||0,label:h.name,date:R,dateRaw:S,exercises:Array.from(h.exercises.entries()).map(([g,T])=>({name:g,sets:T.sets,volume:T.totalVolume})),muscleVolumes:A,muscleTonnage:C,celebration:"celebration"}}),d=["right_bicep","left_bicep","right_forearm","left_forearm","right_shoulder","left_shoulder","chest_right","chest_left","abs_upper","abs_lower","right_quad","left_quad","right_calf","left_calf","right_glute","left_glute","back"],p={};d.forEach(h=>{p[h]=1});const y={id:0,position:0,elevation:.3,totalVolume:0,label:"Journey Begins",date:"Start",dateRaw:i[0]?.date?.replace(/"/g,"")||new Date().toISOString(),exercises:[],muscleVolumes:p,isStart:!0,celebration:null},M=Math.max(...m.map(h=>h.id),0),v=m.length>0?Math.max(...m.map(h=>h.position)):.98,b={id:M+100,position:Math.min(v+.01,.995),elevation:5,totalVolume:0,label:"Journey Complete",date:"Finish",dateRaw:i[i.length-1]?.date?.replace(/"/g,"")||new Date().toISOString(),exercises:[],muscleVolumes:p,isEnd:!0,celebration:"victory"};return{checkpoints:[y,...m,b],snapThreshold:.02,notes:"Generated from workout data"}}async function Wr(i="./data/strong.csv"){console.log("[WorkoutLoader] Loading from:",i);try{const n=await fetch(i);if(!n.ok)throw new Error(`Failed to fetch workout data: ${n.status}`);const t=await n.text(),e=Nr(t),o=Br(e);return console.log("[WorkoutLoader] Loaded",o.checkpoints?.length,"workouts as checkpoints"),o}catch(n){return console.error("[WorkoutLoader] Error:",n),{checkpoints:[],snapThreshold:.02}}}function jr(i,n){if(!i||i.length===0)return{};let t=i[0],e=1/0;for(const a of i){const l=Math.abs(a.position-n);l<e&&(e=l,t=a)}const o=t.muscleVolumes||{},s={};for(const a in o){const l=o[a];s[a]=.2+l*.8}return s}let _e=null;async function zr(){if(_e)return _e;try{const i=await fetch("./data/spotify/artist-genres.json");i.ok&&(_e=await i.json(),console.log(`[SpotifyLoader] Loaded ${Object.keys(_e).length} artist genre mappings`))}catch(i){console.warn("[SpotifyLoader] Could not load artist-genres.json:",i.message),_e={}}return _e}function Gr(i){if(!_e)return"unknown";const n=i.toLowerCase(),t=_e[n];return t&&t.primaryGenre?t.primaryGenre:"unknown"}function $r(i){if(!_e)return[];const n=i.toLowerCase();return _e[n]?.genres||[]}function Hr(i){return i.map(n=>({endTime:n.endTime,artistName:n.artistName,trackName:n.trackName,msPlayed:n.msPlayed,genre:Gr(n.artistName),allGenres:$r(n.artistName)}))}function Vr(i){const n=new Map;for(const t of i){const e=t.endTime.split(" ")[0];n.has(e)||n.set(e,{totalMs:0,genres:new Map,tracks:[]});const o=n.get(e);if(o.totalMs+=t.msPlayed,t.msPlayed>=3e4){o.tracks.push(t);for(const s of t.allGenres){const a=o.genreCounts?.get(s)||0;o.genreCounts||(o.genreCounts=new Map),o.genreCounts.set(s,a+1);const l=o.genres.get(s)||0;o.genres.set(s,l+t.msPlayed)}if(t.allGenres.length===0&&t.genre!=="unknown"){const s=o.genreCounts?.get(t.genre)||0;o.genreCounts||(o.genreCounts=new Map),o.genreCounts.set(t.genre,s+1);const a=o.genres.get(t.genre)||0;o.genres.set(t.genre,a+t.msPlayed)}}}return n}function Ur(i,n){const t=i.get(n);if(!t)return null;if(t.genreCounts&&t.genreCounts.size>0){let s=null,a=0;for(const[l,c]of t.genreCounts)c>a&&(a=c,s=l);return s}if(!t.genres||t.genres.size===0)return null;let e=null,o=0;for(const[s,a]of t.genres)a>o&&(o=a,e=s);return e}function Kr(i,n,t=null){const e=i.get(n);if(!e||e.tracks.length===0)return null;let o=e.tracks;t&&(o=o.filter(l=>l.genre===t),o.length===0&&(o=e.tracks));const s=Math.floor(Math.random()*o.length),a=o[s];return{artistName:a.artistName,trackName:a.trackName,genre:a.genre,msPlayed:a.msPlayed}}function Yr(i,n,t=null,e=5){const o=i.get(n);if(!o||o.tracks.length===0)return[];let s=o.tracks;if(t){const u=s.filter(m=>m.genre===t);u.length>0&&(s=u)}const a=[...s].sort(()=>Math.random()-.5),l=new Set,c=[];for(const u of a){const m=`${u.artistName}-${u.trackName}`;if(!l.has(m)&&(l.add(m),c.push({artistName:u.artistName,trackName:u.trackName,genre:u.genre}),c.length>=e))break}return c}function qr(i,n,t,e=null){if(!t||t.length===0)return{};const o=i.get(n);if(!o||o.tracks.length===0){const m={};return t.forEach(d=>{m[d.name]=null}),m}let s=o.tracks;if(e&&e!=="unknown"){const m=s.filter(d=>d.genre===e);m.length>0&&(s=m)}const a=[],l=new Set;for(const m of s){const d=`${m.artistName}-${m.trackName}`;l.has(d)||(l.add(d),a.push({artistName:m.artistName,trackName:m.trackName,genre:m.genre}))}const c=[...a].sort(()=>Math.random()-.5),u={};return t.forEach((m,d)=>{c.length===0?u[m.name]=null:u[m.name]=c[d%c.length]}),u}async function Xr(){await zr();const i=["./data/spotify/StreamingHistory_music_0.json","./data/spotify/StreamingHistory_music_1.json","./data/spotify/StreamingHistory_music_2.json","./data/spotify/StreamingHistory_music_3.json"],n=[];for(const e of i)try{const o=await fetch(e);if(!o.ok)continue;const s=await o.json(),a=Hr(s);n.push(...a)}catch(o){console.warn(`[SpotifyLoader] Failed to load ${e}:`,o.message)}console.log(`[SpotifyLoader] Loaded ${n.length} listening entries`);const t=Vr(n);return console.log(`[SpotifyLoader] Grouped into ${t.size} unique days`),t}function Cn(i){if(!i)return 12*60;const n=i.split(":"),t=parseInt(n[0],10)||12,e=parseInt(n[1],10)||0;return t*60+e}function Zr(i,n,t,e=90){const o=i.get(n);return!o||o.tracks.length===0?[]:o.tracks.map(a=>{const l=a.endTime.split(" ")[1]||"12:00",c=Cn(l);return{...a,minutes:c}}).filter(a=>{const l=t-15,c=t+e+15;return a.minutes>=l&&a.minutes<=c}).sort((a,l)=>a.minutes-l.minutes)}function Qr(i,n,t,e){let o,s;n.includes("T")?(o=n.split("T")[0],s=n.split("T")[1].split("Z")[0]):(o=n.split(" ")[0],s=n.split(" ")[1]),o=o.replace(/"/g,""),s=s?.replace(/"/g,"")||"12:00:00";const a=Cn(s),l=t.reduce((C,S)=>C+(S.sets||1),0),c=Math.max(30,Math.min(120,l*3)),u=Zr(i,o,a,c);if(u.length===0)return{muscleGenres:{},topSong:null,topGenre:"unknown"};const m={},d={};let p=t.reduce((C,S)=>C+(S.volume||S.sets*100),0)||1,y=0,M=0;for(const C of t){const S=C.volume||C.sets*100,L=S/p,R=M+L,k=[];for(;y<u.length;){const g=u[y];if((g.minutes-a+15)/(c+30)<=R)k.push(g),y++;else break}const P={};for(const g of k){const T=g.genre||"unknown";P[T]=(P[T]||0)+1}let O=null,B=0;for(const[g,T]of Object.entries(P))T>B&&g!=="unknown"&&(B=T,O=g);const _=e[C.name]||[];for(const g of _)d[g]||(d[g]={}),O&&(d[g][O]=(d[g][O]||0)+S);M=R}for(const C of Object.keys(d)){const S=d[C];let L=null,R=0;for(const[k,P]of Object.entries(S))P>R&&(R=P,L=k);m[C]=L||"none"}const v={};for(const C of u){const S=C.genre||"unknown";v[S]=(v[S]||0)+1}let b="unknown",h=0;for(const[C,S]of Object.entries(v))S>h&&C!=="unknown"&&(h=S,b=C);const x=u.filter(C=>C.genre===b),A=x.length>0?x[Math.floor(Math.random()*x.length)]:u[Math.floor(Math.random()*u.length)];return{muscleGenres:m,topSong:A?{artistName:A.artistName,trackName:A.trackName,genre:A.genre}:null,topGenre:b}}function Jr(i,n){let t;n.includes("T")?t=n.split("T")[0]:t=n.split(" ")[0],t=t.replace(/"/g,"");const e=Ur(i,t),o=Kr(i,t,e);return{date:t,genre:e||"unknown",song:o}}function eo(i){let n;i.includes("T")?n=i.split("T")[1].split("Z")[0]:n=i.split(" ")[1],n=n?.replace(/"/g,"")||"12:00:00";const t=parseInt(n.split(":")[0],10)||12;let e;return t>=5&&t<12?e="morning":t>=12&&t<17?e="afternoon":t>=17&&t<21?e="evening":e="night",{hour:t,period:e}}const ge={DAY:"day",WEEK:"week"};function to({smoothing:i=.08,checkpoints:n=[],zoomThreshold:t=.5,disabled:e=!1}={}){const[o,s]=E.useState(0),[a,l]=E.useState(!1),[c,u]=E.useState(1),[m,d]=E.useState(ge.DAY),p=E.useRef(0),y=E.useRef(0),M=E.useRef(1),v=E.useRef(1),b=E.useRef(0),h=E.useRef(null),x=E.useRef(n),A=E.useRef(0),C=E.useRef(!1),S=E.useRef(null);E.useEffect(()=>{x.current=n,n.length>0&&A.current===0&&(p.current=n[0].position)},[n]),E.useEffect(()=>{const g=c>=t?ge.DAY:ge.WEEK;g!==m&&d(g)},[c,t,m]);const L=E.useCallback(()=>{const g=x.current;if(!g||g.length===0)return;const T=Math.min(A.current+1,g.length-1);T!==A.current&&(A.current=T,p.current=g[T].position)},[]),R=E.useCallback(()=>{const g=x.current;if(!g||g.length===0)return;const T=Math.max(A.current-1,0);T!==A.current&&(A.current=T,p.current=g[T].position)},[]),k=E.useCallback(()=>{const g=x.current;!g||g.length===0||(A.current=0,p.current=g[0].position)},[]),P=E.useCallback(g=>{const T=x.current;if(!T||T.length===0)return;const I=Math.max(0,Math.min(g,T.length-1));A.current=I,p.current=T[I].position},[]),O=E.useCallback(g=>{p.current=Math.max(0,Math.min(1,g));const T=x.current;if(T&&T.length>0){let I=0,N=1/0;for(let W=0;W<T.length;W++){const F=Math.abs(T[W].position-g);F<N&&(N=F,I=W)}A.current=I}},[]),B=E.useCallback((g,T=!0)=>{T?M.current=g>=.5?1:0:M.current=Math.max(0,Math.min(1,g))},[]),_=E.useCallback(()=>{const g=p.current,T=y.current,I=y.current,N=g-T,W=Math.abs(N)<1e-4?g:T+N*i;y.current=W,b.current=Math.abs(W-I),s(W);const F=M.current,D=v.current,j=F-D,H=Math.abs(j)<.001?F:D+j*.06;v.current=H,u(H),h.current=requestAnimationFrame(_)},[i]);return E.useEffect(()=>(h.current=requestAnimationFrame(_),()=>{h.current&&cancelAnimationFrame(h.current)}),[_]),E.useEffect(()=>{const g=T=>{if(e)return;let N=T.target;for(;N&&N!==document.body;){if(N.dataset?.scrollable==="true")return;const D=window.getComputedStyle(N);if((D.overflowY==="auto"||D.overflowY==="scroll"||D.overflow==="auto"||D.overflow==="scroll")&&N.scrollHeight>N.clientHeight)return;N=N.parentElement}T.preventDefault();const W=T.deltaY<0?.15:-.15,F=Math.max(0,Math.min(1,M.current+W));F>=.5&&M.current<.5?M.current=1:F<.5&&M.current>=.5?M.current=0:M.current=F,l(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{l(!1),M.current=M.current>=.5?1:0},200)};return window.addEventListener("wheel",g,{passive:!1}),()=>{window.removeEventListener("wheel",g),S.current&&clearTimeout(S.current)}},[e]),E.useEffect(()=>{const g=T=>{if(e)return;const I=T.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable||C.current||(T.key==="ArrowRight"||T.key==="ArrowUp"?(T.preventDefault(),L(),C.current=!0,setTimeout(()=>{C.current=!1},300),l(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>l(!1),150)):(T.key==="ArrowLeft"||T.key==="ArrowDown")&&(T.preventDefault(),R(),C.current=!0,setTimeout(()=>{C.current=!1},300),l(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>l(!1),150)))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[L,R,e]),{progress:o,targetProgress:p.current,velocity:b.current,isScrolling:a,zoom:c,viewMode:m,setTargetProgress:O,setZoomLevel:B,goToNextCheckpoint:L,goToPrevCheckpoint:R,goToStart:k,goToCheckpointIndex:P,currentCheckpointIndex:A.current,totalCheckpoints:x.current?.length||0}}function no(){const[i,n]=E.useState({isPlaying:!1,previewUrl:null,trackName:null,artistName:null,currentSongIndex:-1,isMuted:!1,volume:.7}),t=E.useRef(null),e=E.useRef(null);E.useRef(null);const o=E.useRef(0),s=E.useCallback((v,b,h,x)=>{e.current&&clearInterval(e.current);const A=He.FADE_DURATION/He.FADE_STEPS,C=(h-b)/He.FADE_STEPS;let S=0;e.current=setInterval(()=>{S++;const L=Math.max(0,Math.min(1,b+C*S));v.volume=L,S>=He.FADE_STEPS&&(clearInterval(e.current),e.current=null,v.volume=h,x&&x())},A)},[]),a=E.useCallback(()=>{const v=t.current;!v||!i.previewUrl||i.isMuted||(i.isPlaying?(s(v,v.volume,0,()=>{v.pause()}),n(b=>({...b,isPlaying:!1}))):(v.volume=0,v.play().catch(()=>{}),s(v,0,He.TARGET_VOLUME),n(b=>({...b,isPlaying:!0}))))},[i.previewUrl,i.isPlaying,i.isMuted,s]),l=E.useCallback(()=>{const v=t.current;n(b=>{const h=!b.isMuted;return h&&b.isPlaying&&v?(s(v,v.volume,0,()=>{v.pause()}),{...b,isMuted:!0,isPlaying:!1}):{...b,isMuted:h}})},[s]),c=E.useCallback((v,b,h)=>{const x=t.current;if(!x||!v||i.isMuted)return;const A=++o.current;i.isPlaying&&(e.current&&clearInterval(e.current),x.pause(),x.currentTime=0);const C=x._handleCanPlay,S=x._handleError;C&&x.removeEventListener("canplaythrough",C),S&&x.removeEventListener("error",S),n(k=>({...k,previewUrl:v,trackName:b,artistName:h,isPlaying:!1}));const L=()=>{if(o.current!==A){console.log("[Audio] Stale load request cancelled");return}x.removeEventListener("canplaythrough",L),x.removeEventListener("error",R),x._handleCanPlay=null,x._handleError=null,x.volume=0,x.play().then(()=>{if(o.current!==A){x.pause();return}s(x,0,He.TARGET_VOLUME),n(k=>({...k,isPlaying:!0}))}).catch(k=>{console.log("[Audio] Play failed:",k.message)})},R=k=>{x.removeEventListener("canplaythrough",L),x.removeEventListener("error",R),x._handleCanPlay=null,x._handleError=null,console.log("[Audio] Failed to load:",k)};x._handleCanPlay=L,x._handleError=R,x.addEventListener("canplaythrough",L),x.addEventListener("error",R),x.src=v,x.load()},[i.isMuted,i.isPlaying,s]),u=E.useCallback((v,b,h)=>{n(x=>({...x,previewUrl:v,trackName:b,artistName:h,isPlaying:!1}))},[]),m=E.useCallback(v=>{const b=Math.max(0,Math.min(1,v));n(h=>({...h,volume:b})),t.current&&!i.isMuted&&(t.current.volume=b)},[i.isMuted]),d=E.useCallback(()=>{n(v=>({...v,isPlaying:!1}))},[]),p=E.useCallback(()=>{o.current++;const v=t.current;if(e.current&&(clearInterval(e.current),e.current=null),v){const b=v._handleCanPlay,h=v._handleError;b&&v.removeEventListener("canplaythrough",b),h&&v.removeEventListener("error",h),v._handleCanPlay=null,v._handleError=null,v.pause(),v.currentTime=0}n(b=>({...b,isPlaying:!1}))},[]),y=E.useCallback(()=>{const v=t.current;!v||!i.isPlaying||(e.current&&clearInterval(e.current),s(v,v.volume,0,()=>{v.pause()}),n(b=>({...b,isPlaying:!1})))},[i.isPlaying,s]),M=E.useCallback(()=>{const v=t.current;!v||i.isPlaying||i.isMuted||!i.previewUrl||(v.volume=0,v.play().then(()=>{s(v,0,He.TARGET_VOLUME),n(b=>({...b,isPlaying:!0}))}).catch(b=>{console.log("[Audio] Resume failed:",b.message)}))},[i.isPlaying,i.isMuted,i.previewUrl,s]);return{audioState:i,audioRef:t,toggleAudio:a,toggleMute:l,playPreview:c,setAudioPreview:u,handleAudioEnded:d,setVolume:m,stopAudio:p,pauseAudio:y,resumeAudio:M}}var Ut={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ro=E,oo=Symbol.for("react.element"),so=Symbol.for("react.fragment"),ao=Object.prototype.hasOwnProperty,io=ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lo={key:!0,ref:!0,__self:!0,__source:!0};function Ln(i,n,t){var e,o={},s=null,a=null;t!==void 0&&(s=""+t),n.key!==void 0&&(s=""+n.key),n.ref!==void 0&&(a=n.ref);for(e in n)ao.call(n,e)&&!lo.hasOwnProperty(e)&&(o[e]=n[e]);if(i&&i.defaultProps)for(e in n=i.defaultProps,n)o[e]===void 0&&(o[e]=n[e]);return{$$typeof:oo,type:i,key:s,ref:a,props:o,_owner:io.current}}Ut.Fragment=so;Ut.jsx=Ln;Ut.jsxs=Ln;E.createContext(null);function co({title:i,subtitle:n,onClose:t,onMinimize:e,onPopOut:o,onExpand:s,isExpanded:a,onToggleViewMode:l,viewMode:c,accentColor:u,children:m}){return r.createElement("div",{style:{padding:"24px 24px 20px",borderBottom:`1px solid ${f.color.borderSubtle}`,display:"flex",alignItems:"flex-start",gap:"16px",background:"rgba(0, 0, 0, 0.15)",flexShrink:0}},u&&r.createElement("div",{style:{width:"3px",height:"100%",minHeight:"40px",background:u,borderRadius:"2px",flexShrink:0}}),r.createElement("div",{style:{flex:1,minWidth:0}},n&&r.createElement("div",{style:{fontSize:"0.6875rem",fontWeight:500,letterSpacing:"0.15em",textTransform:"uppercase",color:u||f.color.textTertiary,marginBottom:"6px"}},n),r.createElement("div",{style:{fontSize:"1.25rem",fontWeight:700,color:f.color.textPrimary,lineHeight:1.2,letterSpacing:"-0.02em"}},i)),m,r.createElement("div",{style:{display:"flex",gap:"4px",marginTop:"-4px"}},l&&r.createElement("button",{onClick:l,style:{background:"rgba(255, 255, 255, 0.05)",border:"none",borderRadius:f.radius.sm,width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:f.color.textTertiary,transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.1)",d.currentTarget.style.color=f.color.textSecondary},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.05)",d.currentTarget.style.color=f.color.textTertiary},title:c==="day"?"Switch to Week View":"Switch to Day View"},c==="day"?r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("line",{x1:"3",y1:"10",x2:"21",y2:"10",strokeLinecap:"round"}),r.createElement("line",{x1:"9",y1:"4",x2:"9",y2:"10",strokeLinecap:"round"}),r.createElement("line",{x1:"15",y1:"4",x2:"15",y2:"10",strokeLinecap:"round"})):r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("line",{x1:"3",y1:"10",x2:"21",y2:"10",strokeLinecap:"round"}),r.createElement("circle",{cx:"12",cy:"16",r:"2",fill:"currentColor"}))),s&&r.createElement("button",{onClick:s,style:{background:a?"rgba(59, 130, 246, 0.15)":"rgba(255, 255, 255, 0.05)",border:"none",borderRadius:f.radius.sm,width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:a?f.color.accent:f.color.textTertiary,transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.background=a?"rgba(59, 130, 246, 0.25)":"rgba(255, 255, 255, 0.1)",d.currentTarget.style.color=a?f.color.accent:f.color.textSecondary},onMouseLeave:d=>{d.currentTarget.style.background=a?"rgba(59, 130, 246, 0.15)":"rgba(255, 255, 255, 0.05)",d.currentTarget.style.color=a?f.color.accent:f.color.textTertiary},title:a?"Collapse panel":"Expand panel"},a?r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7",strokeLinecap:"round",strokeLinejoin:"round"})):r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7",strokeLinecap:"round",strokeLinejoin:"round"}))),o&&r.createElement("button",{onClick:o,style:{background:"rgba(255, 255, 255, 0.05)",border:"none",borderRadius:f.radius.sm,width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:f.color.textTertiary,transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.1)",d.currentTarget.style.color=f.color.textSecondary},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.05)",d.currentTarget.style.color=f.color.textTertiary},title:"Pop out"},r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("polyline",{points:"15 3 21 3 21 9",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("line",{x1:"10",y1:"14",x2:"21",y2:"3",strokeLinecap:"round",strokeLinejoin:"round"}))),e&&r.createElement("button",{onClick:e,style:{background:"rgba(255, 255, 255, 0.05)",border:"none",borderRadius:f.radius.sm,width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:f.color.textTertiary,transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.1)",d.currentTarget.style.color=f.color.textSecondary},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.05)",d.currentTarget.style.color=f.color.textTertiary},title:"Minimize"},r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 12h14",strokeLinecap:"round"}))),t&&r.createElement("button",{onClick:t,style:{background:"rgba(255, 255, 255, 0.05)",border:"none",borderRadius:f.radius.sm,width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:f.color.textTertiary,transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(239, 68, 68, 0.2)",d.currentTarget.style.color="#ef4444"},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.05)",d.currentTarget.style.color=f.color.textTertiary},title:"Close"},r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})))))}function uo({children:i,noPadding:n=!1}){return r.createElement("div",{style:{flex:1,overflow:"auto",padding:n?0:"24px",scrollbarWidth:"thin",scrollbarColor:`${f.color.borderSubtle} transparent`},className:"panel-content-scroll"},r.createElement("style",null,`
        .panel-content-scroll::-webkit-scrollbar {
          width: 6px;
        }
        .panel-content-scroll::-webkit-scrollbar-track {
          background: transparent;
        }
        .panel-content-scroll::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.15);
          border-radius: 3px;
        }
        .panel-content-scroll::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.25);
        }
      `),i)}function Kt(i=768){const[n,t]=E.useState(!1);return E.useEffect(()=>{const e=()=>{t(window.innerWidth<i)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[i]),n}function At({leftPanel:i,rightPanel:n,bottomPanel:t,mainContent:e,showLeftPanel:o=!1,showRightPanel:s=!1,showBottomPanel:a=!1,isLeftPanelExpanded:l=!1,onLayoutChange:c}){return Kt()?r.createElement("div",{style:{position:"fixed",inset:0,display:"flex",flexDirection:"column",background:f.color.bgDeep}},r.createElement("div",{style:{flex:1,position:"relative",minHeight:"50vh"}},e),(o||s||a)&&r.createElement("div",{style:{maxHeight:"50vh",overflow:"auto",background:"rgba(5, 8, 15, 0.98)",borderTop:`1px solid ${f.color.borderSubtle}`}},o&&i,s&&n,a&&t)):r.createElement("div",{style:{position:"fixed",inset:0,background:f.color.bgDeep}},r.createElement("div",{style:{position:"absolute",inset:0,zIndex:0}},e),o&&r.createElement("div",{style:{position:"absolute",top:0,left:0,bottom:0,width:l?"100%":"380px",maxWidth:l?"100%":"40vw",zIndex:10,background:l?"rgba(5, 8, 15, 0.98)":"rgba(5, 8, 15, 0.95)",backdropFilter:"blur(24px)",borderRight:l?"none":`1px solid ${f.color.borderSubtle}`,display:"flex",flexDirection:"column",overflow:"hidden",transition:"width 0.3s ease, max-width 0.3s ease, background 0.3s ease"}},i),s&&r.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,width:"380px",maxWidth:"40vw",zIndex:10,background:"rgba(5, 8, 15, 0.95)",backdropFilter:"blur(24px)",borderLeft:`1px solid ${f.color.borderSubtle}`,display:"flex",flexDirection:"column",overflow:"hidden"}},n),a&&r.createElement("div",{style:{position:"absolute",left:o?"380px":0,right:s?"380px":0,bottom:0,height:"30vh",maxHeight:"400px",zIndex:10,background:"rgba(5, 8, 15, 0.95)",backdropFilter:"blur(24px)",borderTop:`1px solid ${f.color.borderSubtle}`,display:"flex",flexDirection:"column",overflow:"hidden"}},t))}function _n({size:i="md"}){const n={sm:{fontSize:"1rem",letterSpacing:"0.3em"},md:{fontSize:"0.875rem",letterSpacing:"0.35em"},lg:{fontSize:"1.125rem",letterSpacing:"0.4em"}},t=n[i]||n.md;return r.createElement("div",{style:{fontFamily:f.font.display,fontSize:t.fontSize,fontWeight:600,letterSpacing:t.letterSpacing,color:f.color.accent,textTransform:"uppercase",display:"flex",alignItems:"center",gap:"8px"}},r.createElement("span",{style:{width:"6px",height:"6px",borderRadius:"50%",background:f.color.accent,boxShadow:`0 0 12px ${f.color.accent}`}}),"FORMA")}function rn({items:i,onRestore:n,audioState:t,onToggleAudio:e}){if(!i||i.length===0)return null;const o=t?.isPlaying||!1,s=t?.previewUrl;return r.createElement("div",{style:{position:"fixed",bottom:"16px",right:"16px",display:"flex",flexDirection:"column",gap:"8px",zIndex:1001}},s&&r.createElement("button",{onClick:e,style:{background:o?"linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1))":"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",border:`1px solid ${o?"rgba(16, 185, 129, 0.4)":f.color.borderSubtle}`,borderRadius:f.radius.md,padding:"10px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",color:o?f.color.accentSuccess:f.color.textSecondary,fontSize:"0.75rem",fontFamily:f.font.body,fontWeight:500,transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)"},onMouseEnter:a=>{a.currentTarget.style.transform="translateX(-4px)"},onMouseLeave:a=>{a.currentTarget.style.transform="translateX(0)"}},r.createElement("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:o?f.color.accentSuccess:"rgba(16, 185, 129, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"}},o?r.createElement("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"white"},r.createElement("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),r.createElement("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})):r.createElement("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"white"},r.createElement("path",{d:"M8 5v14l11-7z"}))),r.createElement("span",{style:{maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},o?"Playing...":"Music"),o&&r.createElement("div",{style:{display:"flex",gap:"2px",alignItems:"center",height:"14px"}},[1,2,3].map(a=>r.createElement("div",{key:a,style:{width:"2px",background:f.color.accentSuccess,borderRadius:"1px",animation:"waveform 0.5s ease-in-out infinite alternate",animationDelay:`${a*.1}s`}})))),i.map(a=>r.createElement("button",{key:a.id,onClick:()=>n(a.id),style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",border:`1px solid ${f.color.borderSubtle}`,borderRadius:f.radius.md,padding:"10px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",color:f.color.textSecondary,fontSize:"0.75rem",fontFamily:f.font.body,fontWeight:500,transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)"},onMouseEnter:l=>{l.currentTarget.style.background="rgba(255, 255, 255, 0.08)",l.currentTarget.style.transform="translateX(-4px)"},onMouseLeave:l=>{l.currentTarget.style.background="rgba(255, 255, 255, 0.05)",l.currentTarget.style.transform="translateX(0)"}},r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),r.createElement("path",{d:"M9 9l6 6M15 9l-6 6",strokeLinecap:"round"})),r.createElement("span",null,a.label))),r.createElement("style",null,`
        @keyframes waveform {
          from { height: 4px; }
          to { height: 12px; }
        }
      `))}const nt={genres:{techno:[.75,.95,.5],"hard techno":[.78,.95,.45],hypertechno:[.82,.95,.55],house:[.08,.92,.55],"tech house":[.1,.88,.52],"rally house":[.06,.9,.55],"drum and bass":[0,.95,.55],jungle:[0,.85,.45],"liquid funk":[.95,.7,.55],dubstep:[.68,.9,.48],breakcore:[.95,.95,.5],"lo-fi":[.52,.6,.55],"lo-fi hip hop":[.52,.55,.52],"lo-fi beats":[.52,.6,.55],chillwave:[.48,.5,.58],vaporwave:[.85,.55,.65],"hip hop":[.12,.88,.52],"hip-hop":[.12,.88,.52],rap:[.12,.85,.5],"jazz rap":[.14,.75,.55],"old school hip hop":[.1,.8,.45],phonk:[.78,.88,.42],"drift phonk":[.8,.9,.38],"brazilian phonk":[.72,.85,.45],rock:[0,.75,.42],metal:[0,.9,.35],"hard rock":[.98,.8,.4],"nu metal":[.95,.8,.4],"classic rock":[.02,.65,.5],pop:[.92,.75,.62],synthwave:[.88,.85,.55],"r&b":[.62,.7,.52],hardstyle:[.55,.95,.5],hardcore:[0,.95,.45],frenchcore:[.95,.95,.45],gabber:[.03,.95,.5],jazz:[.14,.65,.48],"jazz beats":[.15,.6,.55],"jazz fusion":[.17,.7,.5],classical:[.58,.4,.55],country:[.1,.55,.5],"classic country":[.1,.5,.45],"city pop":[.45,.7,.6],"j-pop":[.95,.7,.65],"k-pop":[.85,.8,.6],other:[.55,.45,.5],unknown:[0,0,.45]}};function mo(i){const[n,t,e]=i,o=t*Math.min(e,1-e),s=a=>{const l=(a+n*12)%12,c=e-o*Math.max(Math.min(l-3,9-l,1),-1);return Math.round(255*c).toString(16).padStart(2,"0")};return`#${s(0)}${s(8)}${s(4)}`}function Pn(i){if(!i)return nt.genres.unknown;const n=i.toLowerCase();if(nt.genres[n])return nt.genres[n];for(const[t,e]of Object.entries(nt.genres))if(n.includes(t)||t.includes(n))return e;return nt.genres.other}function Te(i){return mo(Pn(i))}function po({muscle:i}){if(!i)return null;const n=i.genre?Te(i.genre):null,e=(o=>!o||o===0?null:o>=1e3?`${(o/1e3).toFixed(1)}t`:`${Math.round(o)} kg`)(i.tonnage);return r.createElement("div",{style:{position:"fixed",left:i.x+15,top:i.y-10,background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",color:f.color.textPrimary,padding:"14px 18px",borderRadius:f.radius.lg,fontSize:"13px",fontFamily:f.font.body,pointerEvents:"none",zIndex:1e3,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.25)",maxWidth:"220px",border:`1px solid ${f.color.borderSubtle}`,overflow:"hidden",animation:"tooltipFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1)"}},n&&r.createElement("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:"50%",height:"1px",background:`linear-gradient(90deg, transparent, ${n}88, transparent)`}}),r.createElement("div",{style:{fontFamily:f.font.display,fontWeight:600,textTransform:"capitalize",fontSize:"0.875rem",letterSpacing:"-0.01em"}},i.id.replace(/_/g," ")),r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"10px"}},i.genre&&r.createElement("div",{style:{fontSize:"0.6875rem",display:"flex",alignItems:"center",gap:"6px",color:f.color.textSecondary}},r.createElement("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",background:n,boxShadow:`0 0 10px ${n}`}}),r.createElement("span",{style:{textTransform:"capitalize",fontWeight:500}},i.genre)),e&&r.createElement("div",{style:{fontSize:"0.6875rem",display:"flex",alignItems:"center",gap:"5px",color:f.color.textSecondary}},r.createElement("span",{style:{fontSize:"0.625rem",opacity:.6,fontWeight:500,letterSpacing:"0.05em"}},"VOL"),r.createElement("span",{style:{fontWeight:600,color:f.color.textPrimary}},e))),r.createElement("style",null,`
        @keyframes tooltipFadeIn {
          from { 
            opacity: 0; 
            transform: translateY(8px) scale(0.95); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
          }
        }
      `))}function fo({workoutData:i,spotifyData:n,opacity:t=1,showDismissHint:e=!0}){const o=E.useMemo(()=>{if(!i?.checkpoints)return null;const s=i.checkpoints.filter(b=>!b.isStart),a=s.length,c=(s.reduce((b,h)=>b+(h.totalVolume||0),0)/1e3).toFixed(1),u=new Set;s.forEach(b=>{b.spotify?.song&&u.add(`${b.spotify.artistName}-${b.spotify.song}`),b.spotify?.alternativeSongs?.forEach(h=>{u.add(`${h.artistName}-${h.trackName}`)})});const m=s.map(b=>{try{return new Date(b.dateRaw?.replace(" ","T"))}catch{return null}}).filter(b=>b&&!isNaN(b)).sort((b,h)=>b-h),d=m[0],p=m[m.length-1],y=d&&p?`${d.toLocaleDateString("en-US",{month:"short",year:"numeric"})} - ${p.toLocaleDateString("en-US",{month:"short",year:"numeric"})}`:"2024 - 2025",M={};s.forEach(b=>{const h=b.spotify?.genre;h&&h!=="unknown"&&(M[h]=(M[h]||0)+1)});const v=Object.entries(M).sort((b,h)=>h[1]-b[1])[0];return{totalWorkouts:a,totalTonnes:c,totalSongs:u.size,dateRange:y,topGenre:v?.[0],topGenreColor:v?Te(v[0]):f.color.accent}},[i]);return!o||t<=0?null:r.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:t>.5?"auto":"none",zIndex:50,opacity:t,transition:"opacity 0.3s ease-out"}},r.createElement("div",{style:{position:"absolute",inset:0,background:`radial-gradient(ellipse at center, transparent 0%, ${f.color.bgDeep}99 70%, ${f.color.bgDeep} 100%)`,backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",pointerEvents:"none"}}),r.createElement("div",{style:{position:"relative",zIndex:1,textAlign:"center",padding:"2rem",maxWidth:"800px"}},r.createElement("div",{style:{marginBottom:"2rem",transform:`translateY(${(1-t)*-20}px)`,transition:"transform 0.3s ease-out"}},r.createElement(_n,{size:"xl"})),r.createElement("div",{style:{fontFamily:f.font.body,fontSize:"1rem",fontWeight:500,letterSpacing:"0.2em",textTransform:"uppercase",color:f.color.textSecondary,marginBottom:"0.75rem"}},"Your Fitness Journey"),r.createElement("div",{style:{fontFamily:f.font.display,fontSize:"clamp(1.5rem, 4vw, 2.25rem)",fontWeight:700,color:f.color.textPrimary,marginBottom:"3rem"}},o.dateRange),r.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"2rem",flexWrap:"wrap",marginBottom:"3rem"}},r.createElement(Rt,{value:o.totalWorkouts,label:"Workouts"}),r.createElement(Rt,{value:`${o.totalTonnes}t`,label:"Lifted",color:f.color.accentWarm}),r.createElement(Rt,{value:o.totalSongs,label:"Songs",color:o.topGenreColor})),r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.75rem",color:f.color.textTertiary,animation:"pulse 2s ease-in-out infinite"}},r.createElement("span",{style:{fontSize:"0.75rem",fontWeight:500,letterSpacing:"0.1em",textTransform:"uppercase"}},e?"Press any key to begin":"Scroll to begin"),e?r.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"4",y:"6",width:"16",height:"12",rx:"2"}),r.createElement("line",{x1:"8",y1:"12",x2:"16",y2:"12"})):r.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M12 5v14M5 12l7 7 7-7"})))),r.createElement("style",null,`
        @keyframes pulse {
          0%, 100% { opacity: 0.5; transform: translateY(0); }
          50% { opacity: 1; transform: translateY(4px); }
        }
      `))}function Rt({value:i,label:n,color:t=f.color.accent}){return r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"}},r.createElement("div",{style:{fontFamily:f.font.display,fontSize:"clamp(1.75rem, 5vw, 2.5rem)",fontWeight:700,color:f.color.textPrimary,lineHeight:1}},typeof i=="number"?i.toLocaleString():i),r.createElement("div",{style:{fontSize:"0.6875rem",fontWeight:500,letterSpacing:"0.08em",textTransform:"uppercase",color:t}},n))}function ho({onPrev:i,onNext:n,onStart:t,currentIndex:e,total:o,canGoPrev:s,canGoNext:a}){const l={width:"36px",height:"36px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.08)",border:`1px solid ${f.color.borderSubtle}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:f.color.textSecondary,transition:"all 0.2s ease"},c={...l,opacity:.3,cursor:"not-allowed"};return r.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center",marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${f.color.borderSubtle}`}},r.createElement("button",{onClick:t,disabled:e===0,style:e===0?c:l,title:"Back to start"},r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M11 17l-5-5 5-5M18 17l-5-5 5-5",strokeLinecap:"round",strokeLinejoin:"round"}))),r.createElement("button",{onClick:i,disabled:!s,style:s?l:c,title:"Previous checkpoint"},r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M15 18l-6-6 6-6",strokeLinecap:"round",strokeLinejoin:"round"}))),r.createElement("div",{style:{padding:"6px 12px",borderRadius:f.radius.sm,background:"rgba(255, 255, 255, 0.03)",border:`1px solid ${f.color.borderSubtle}`,fontSize:"0.6875rem",fontFamily:f.font.body,fontWeight:500,color:f.color.textSecondary,minWidth:"45px",textAlign:"center"}},e+1," / ",o),r.createElement("button",{onClick:n,disabled:!a,style:a?l:c,title:"Next checkpoint"},r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M9 18l6-6-6-6",strokeLinecap:"round",strokeLinejoin:"round"}))))}function go({trackName:i,artistName:n,alternativeSongs:t=[],audioState:e,onSetAudioPreview:o,onToggleAudio:s,onPlayPreview:a,onSetVolume:l,shouldAutoPlay:c=!1}){const[u,m]=E.useState(!1),[d,p]=E.useState(-1),[y,M]=E.useState({trackName:i,artistName:n}),[v,b]=E.useState(null),h=E.useRef(!1),x=E.useRef(""),A=`${i}-${n}`;E.useEffect(()=>{x.current!==A&&(x.current=A,p(-1),M({trackName:i,artistName:n}),b(null),h.current=!1)},[i,n,A]);const C=E.useCallback((B,_)=>{c&&!h.current&&a&&(h.current=!0,setTimeout(()=>{a(B,_.trackName,_.artistName)},100))},[c,a]);E.useEffect(()=>{const B=d===-1?{trackName:i,artistName:n}:t[d];if(!B?.trackName||!B?.artistName)return;const _=new AbortController;m(!0);const g=encodeURIComponent(`${B.trackName} ${B.artistName}`);return fetch(`https://itunes.apple.com/search?term=${g}&media=music&limit=1`,{signal:_.signal}).then(T=>T.json()).then(T=>{if(!_.signal.aborted)if(m(!1),T.results&&T.results[0]?.previewUrl){const I=T.results[0].previewUrl;b(I),M(B),o&&o(I,B.trackName,B.artistName),C(I,B)}else d<t.length-1&&p(I=>I+1)}).catch(T=>{_.signal.aborted||(m(!1),console.log("[SpotifyPreview] Could not fetch preview:",T.message),d<t.length-1&&p(I=>I+1))}),()=>{_.abort()}},[i,n,d,t,o,C]);const S=B=>{const _=parseFloat(B.target.value);l&&l(_)},L=e?.isPlaying||!1,R=e?.previewUrl||v,k=e?.volume??.7,P=e?.trackName||y.trackName,O=e?.artistName||y.artistName;return r.createElement("div",{style:{marginTop:"12px"}},(P||O)&&r.createElement("div",{style:{padding:"8px 10px",marginBottom:"8px",background:"rgba(16, 185, 129, 0.08)",borderRadius:f.radius.sm,border:"1px solid rgba(16, 185, 129, 0.15)"}},r.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:f.color.textPrimary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},P||"Unknown Track"),r.createElement("div",{style:{fontSize:"10px",color:f.color.textSecondary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginTop:"2px"}},O||"Unknown Artist"),L&&r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px",fontSize:"9px",color:f.color.accentSuccess}},r.createElement("div",{style:{display:"flex",gap:"2px",alignItems:"center",height:"12px"}},[1,2,3,4].map(B=>r.createElement("div",{key:B,style:{width:"2px",background:f.color.accentSuccess,borderRadius:"1px",animation:"waveform 0.5s ease-in-out infinite alternate",animationDelay:`${B*.1}s`}}))),r.createElement("span",null,"Now playing"))),R&&r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginTop:"8px",padding:"6px 10px",background:"rgba(255, 255, 255, 0.03)",borderRadius:f.radius.sm}},r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"rgba(255,255,255,0.5)",strokeWidth:"2"},r.createElement("path",{d:"M11 5L6 9H2v6h4l5 4V5z"})),r.createElement("input",{type:"range",min:"0",max:"1",step:"0.05",value:k,onChange:S,style:{flex:1,height:"4px",appearance:"none",background:`linear-gradient(to right, ${f.color.accentSuccess} ${k*100}%, rgba(255,255,255,0.15) ${k*100}%)`,borderRadius:"2px",cursor:"pointer"}}),r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"rgba(255,255,255,0.5)",strokeWidth:"2"},r.createElement("path",{d:"M11 5L6 9H2v6h4l5 4V5z"}),r.createElement("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}))),r.createElement("style",null,`
        @keyframes waveform {
          from { height: 4px; }
          to { height: 14px; }
        }
        input[type="range"]::-webkit-slider-thumb {
          appearance: none;
          width: 12px;
          height: 12px;
          border-radius: 50%;
          background: ${f.color.accentSuccess};
          cursor: pointer;
        }
      `))}function yo(i,n){if(!i||!n||n.length<2)return null;const t=n.filter(D=>!D.isStart).sort((D,j)=>{const H=new Date((D.dateRaw||D.date).replace(" ","T")),X=new Date((j.dateRaw||j.date).replace(" ","T"));return H-X}),e=t.findIndex(D=>D.id===i.id);if(e<0)return null;const o=i.totalVolume||0,s=t.slice(0,e),a=s.map(D=>D.totalVolume||0),l=Math.min(5,a.length),c=a.slice(-l),u=c.length>0?c.reduce((D,j)=>D+j,0)/c.length:o,d=(e>0?t[e-1]:null)?.totalVolume||0,p=d>0?(o-d)/d*100:0,y=[...a,o],v=[...y].sort((D,j)=>j-D).indexOf(o)+1,b=v===1&&a.length>0,h=t.map(D=>{const j=(D.dateRaw||D.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,"");return j?new Date(j):null});let x=1;for(let D=e;D>0;D--){const j=h[D],H=h[D-1];if(j&&H)if((j-H)/864e5<=3)x++;else break}const A=h[e],C=e>0?h[e-1]:null,S=A&&C?Math.round((A-C)/(1e3*60*60*24)):null,L=new Set;s.forEach(D=>{(D.exercises||[]).forEach(j=>{L.add(j.name||j.Exercise)})});const R=(i.exercises||[]).filter(D=>!L.has(D.name||D.Exercise)),k=[],P=i.exercises||[];P.forEach(D=>{const j=D.name||D.Exercise,H=parseFloat(D.weight||D.Weight)||0;for(let X=e-1;X>=0;X--){const Y=(t[X].exercises||[]).find(q=>(q.name||q.Exercise)===j);if(Y){const q=parseFloat(Y.weight||Y.Weight)||0;if(H>q&&q>0){const ne=H-q;k.push({exercise:j,increase:ne,prevWeight:q,currentWeight:H})}break}}});const O={};t.slice(0,e+1).forEach(D=>{(D.exercises||[]).forEach(j=>{const H=j.name||j.Exercise;O[H]=(O[H]||0)+1})});const B=Object.entries(O).sort((D,j)=>j[1]-D[1])[0],_=i.muscleTonnage||{},I=Object.entries({Chest:["chest_left","chest_right"],Back:["back"],Legs:["left_quad","right_quad","left_calf","right_calf","left_glute","right_glute"],Shoulders:["left_shoulder","right_shoulder"],Arms:["left_bicep","right_bicep","left_forearm","right_forearm"],Core:["abs_upper","abs_lower"]}).map(([D,j])=>({name:D,volume:j.reduce((H,X)=>H+(_[X]||0),0)})).filter(D=>D.volume>0).sort((D,j)=>j.volume-D.volume)[0],N=P.length,W=s.length>0?s.reduce((D,j)=>D+(j.exercises?.length||0),0)/s.length:N,F=A?.toLocaleDateString("en-US",{weekday:"long"});return{currentVolume:o,rollingAvg:u,volumeChangeFromPrev:p,volumeRank:v,totalWorkoutsAtTime:y.length,isPersonalRecordAtTime:b,currentStreak:x,daysSinceLast:S,newExercises:R,progressiveOverloads:k,mostFrequentExercise:B?{name:B[0],count:B[1]}:null,dominantGroup:I,currentExCount:N,avgExCount:W,dayOfWeek:F,workoutNumber:e+1}}function xo(i,n){if(!i)return[];const t=[];if(i.isPersonalRecordAtTime&&t.push({icon:"crown",type:"achievement",text:`New personal best! Highest volume in your first ${i.totalWorkoutsAtTime} workouts.`,priority:1}),i.progressiveOverloads.length>0){const s=i.progressiveOverloads.sort((a,l)=>l.increase-a.increase)[0];t.push({icon:"trending-up",type:"achievement",text:`Increased ${s.exercise} by ${s.increase}kg (${s.prevWeight}  ${s.currentWeight}kg).`,priority:1})}const e=i.rollingAvg>0?(i.currentVolume-i.rollingAvg)/i.rollingAvg*100:0;if(Math.abs(e)>25&&i.totalWorkoutsAtTime>3&&t.push({icon:e>0?"trending-up":"activity",type:e>0?"positive":"neutral",text:e>0?`${Math.round(e)}% above your recent 5-workout average.`:`Lighter session - ${Math.round(Math.abs(e))}% below your recent average.`,priority:e>0?2:4}),i.currentStreak>=3&&t.push({icon:"flame",type:"streak",text:`${i.currentStreak} workout streak! Building momentum.`,priority:2}),i.daysSinceLast&&i.daysSinceLast>=7&&t.push({icon:"refresh",type:"comeback",text:`Back after ${i.daysSinceLast} days away. Welcome back!`,priority:2}),i.newExercises.length>0){const s=i.newExercises.slice(0,2).map(a=>a.name||a.Exercise).join(", ");t.push({icon:"sparkles",type:"discovery",text:i.newExercises.length===1?`First time trying ${s}.`:`Added ${i.newExercises.length} new exercises to your repertoire.`,priority:2})}if(i.dominantGroup&&i.dominantGroup.volume>0){const s=(i.dominantGroup.volume/1e3).toFixed(1);t.push({icon:"target",type:"focus",text:`${i.dominantGroup.name} focus day - ${s}k kg on this muscle group.`,priority:3})}if(i.avgExCount>0&&Math.abs(i.currentExCount-i.avgExCount)>=2){const s=i.currentExCount-i.avgExCount;t.push({icon:s>0?"layers":"zap",type:"pattern",text:s>0?`Comprehensive session with ${i.currentExCount} exercises (${Math.round(s)} more than usual).`:`Focused session - ${i.currentExCount} exercises, keeping it efficient.`,priority:4})}return[10,25,50,75,100,150,200,250,300,365].includes(i.workoutNumber)&&t.push({icon:"milestone",type:"milestone",text:`Workout #${i.workoutNumber} complete!`,priority:1}),(i.dayOfWeek==="Saturday"||i.dayOfWeek==="Sunday")&&t.push({icon:"calendar",type:"pattern",text:`${i.dayOfWeek} session - making the most of the weekend.`,priority:5}),t.sort((s,a)=>s.priority-a.priority).slice(0,3)}function bo({name:i,color:n}){return{crown:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("path",{d:"M2 20h20v-4l-4-8-4 4-4-8-4 8-4 8v4z",strokeLinecap:"round",strokeLinejoin:"round"})),"trending-up":r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("polyline",{points:"17 6 23 6 23 12",strokeLinecap:"round",strokeLinejoin:"round"})),activity:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12",strokeLinecap:"round",strokeLinejoin:"round"})),flame:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("path",{d:"M8.5 14.5A2.5 2.5 0 0011 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 11-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 002.5 2.5z"})),refresh:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("polyline",{points:"23 4 23 10 17 10",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10",strokeLinecap:"round",strokeLinejoin:"round"})),sparkles:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("path",{d:"M12 3l1.5 4.5L18 9l-4.5 1.5L12 15l-1.5-4.5L6 9l4.5-1.5L12 3z",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M5 19l.5 1.5L7 21l-1.5.5L5 23l-.5-1.5L3 21l1.5-.5L5 19z",strokeLinecap:"round",strokeLinejoin:"round"})),target:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("circle",{cx:"12",cy:"12",r:"10"}),r.createElement("circle",{cx:"12",cy:"12",r:"6"}),r.createElement("circle",{cx:"12",cy:"12",r:"2"})),layers:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("polygon",{points:"12 2 2 7 12 12 22 7 12 2",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("polyline",{points:"2 17 12 22 22 17",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("polyline",{points:"2 12 12 17 22 12",strokeLinecap:"round",strokeLinejoin:"round"})),zap:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",strokeLinecap:"round",strokeLinejoin:"round"})),milestone:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),r.createElement("line",{x1:"4",y1:"22",x2:"4",y2:"15"})),calendar:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2"},r.createElement("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),r.createElement("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),r.createElement("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),r.createElement("line",{x1:"3",y1:"10",x2:"21",y2:"10"}))}[i]||null}function Eo({checkpoint:i,allCheckpoints:n}){const t=E.useMemo(()=>yo(i,n),[i,n]),e=E.useMemo(()=>xo(t),[t,i]);if(!t||e.length===0)return null;const o={achievement:"#fbbf24",positive:"#22c55e",neutral:f.color.textSecondary,streak:"#f97316",comeback:"#60a5fa",discovery:"#a855f7",focus:"#ec4899",pattern:f.color.textSecondary,milestone:"#f59e0b"};return r.createElement("div",{style:{marginTop:"16px",padding:"12px",background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:`1px solid ${f.color.borderSubtle}`}},r.createElement("div",{style:{fontSize:"0.5625rem",fontWeight:500,letterSpacing:"0.1em",textTransform:"uppercase",color:f.color.textTertiary,marginBottom:"10px"}},"Insights"),r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},e.map((s,a)=>r.createElement("div",{key:a,style:{display:"flex",alignItems:"flex-start",gap:"8px"}},r.createElement("div",{style:{flexShrink:0,marginTop:"1px"}},r.createElement(bo,{name:s.icon,color:o[s.type]})),r.createElement("div",{style:{fontSize:"0.6875rem",lineHeight:1.5,color:f.color.textSecondary}},s.text)))),r.createElement("div",{style:{display:"flex",gap:"12px",marginTop:"12px",paddingTop:"10px",borderTop:`1px solid ${f.color.borderSubtle}`}},r.createElement("div",{style:{flex:1}},r.createElement("div",{style:{fontSize:"0.875rem",fontWeight:600,color:f.color.textPrimary}},"#",t.workoutNumber),r.createElement("div",{style:{fontSize:"0.5rem",color:f.color.textTertiary,textTransform:"uppercase",letterSpacing:"0.05em"}},"workout")),t.volumeChangeFromPrev!==0&&Math.abs(t.volumeChangeFromPrev)>5&&r.createElement("div",{style:{flex:1}},r.createElement("div",{style:{fontSize:"0.875rem",fontWeight:600,color:t.volumeChangeFromPrev>0?"#22c55e":"#f97316"}},t.volumeChangeFromPrev>0?"+":"",Math.round(t.volumeChangeFromPrev),"%"),r.createElement("div",{style:{fontSize:"0.5rem",color:f.color.textTertiary,textTransform:"uppercase",letterSpacing:"0.05em"}},"vs last")),t.currentStreak>1&&r.createElement("div",{style:{flex:1}},r.createElement("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#f97316"}},t.currentStreak),r.createElement("div",{style:{fontSize:"0.5rem",color:f.color.textTertiary,textTransform:"uppercase",letterSpacing:"0.05em"}},"streak")),t.progressiveOverloads.length>0&&r.createElement("div",{style:{flex:1}},r.createElement("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"#22c55e"}},t.progressiveOverloads.length),r.createElement("div",{style:{fontSize:"0.5rem",color:f.color.textTertiary,textTransform:"uppercase",letterSpacing:"0.05em"}},"PRs"))))}function on(i,n){if(n===Hn)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(n===jt||n===En){let t=i.getIndex();if(t===null){const a=[],l=i.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);i.setIndex(a),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const e=t.count-2,o=[];if(n===jt)for(let a=1;a<=e;a++)o.push(t.getX(0)),o.push(t.getX(a)),o.push(t.getX(a+1));else for(let a=0;a<e;a++)a%2===0?(o.push(t.getX(a)),o.push(t.getX(a+1)),o.push(t.getX(a+2))):(o.push(t.getX(a+2)),o.push(t.getX(a+1)),o.push(t.getX(a)));o.length/3!==e&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(o),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),i}class In extends Vn{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new To(t)}),this.register(function(t){return new Do(t)}),this.register(function(t){return new Oo(t)}),this.register(function(t){return new No(t)}),this.register(function(t){return new Ao(t)}),this.register(function(t){return new Ro(t)}),this.register(function(t){return new Co(t)}),this.register(function(t){return new Lo(t)}),this.register(function(t){return new Mo(t)}),this.register(function(t){return new _o(t)}),this.register(function(t){return new So(t)}),this.register(function(t){return new Io(t)}),this.register(function(t){return new Po(t)}),this.register(function(t){return new vo(t)}),this.register(function(t){return new Fo(t)}),this.register(function(t){return new Bo(t)})}load(n,t,e,o){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=st.extractUrlBase(n);a=st.resolveURL(u,this.path)}else a=st.extractUrlBase(n);this.manager.itemStart(n);const l=function(u){o?o(u):console.error(u),s.manager.itemError(n),s.manager.itemEnd(n)},c=new wn(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(n,function(u){try{s.parse(u,a,function(m){t(m),s.manager.itemEnd(n)},l)}catch(m){l(m)}},e,l)}setDRACOLoader(n){return this.dracoLoader=n,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,t,e,o){let s;const a={},l={},c=new TextDecoder;if(typeof n=="string")s=JSON.parse(n);else if(n instanceof ArrayBuffer)if(c.decode(new Uint8Array(n,0,4))===Dn){try{a[K.KHR_BINARY_GLTF]=new Wo(n)}catch(d){o&&o(d);return}s=JSON.parse(a[K.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(n));else s=n;if(s.asset===void 0||s.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new Qo(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){const d=this.pluginCallbacks[m](u);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[d.name]=d,a[d.name]=!0}if(s.extensionsUsed)for(let m=0;m<s.extensionsUsed.length;++m){const d=s.extensionsUsed[m],p=s.extensionsRequired||[];switch(d){case K.KHR_MATERIALS_UNLIT:a[d]=new ko;break;case K.KHR_DRACO_MESH_COMPRESSION:a[d]=new jo(s,this.dracoLoader);break;case K.KHR_TEXTURE_TRANSFORM:a[d]=new zo;break;case K.KHR_MESH_QUANTIZATION:a[d]=new Go;break;default:p.indexOf(d)>=0&&l[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}u.setExtensions(a),u.setPlugins(l),u.parse(e,o)}parseAsync(n,t){const e=this;return new Promise(function(o,s){e.parse(n,t,o,s)})}}function wo(){let i={};return{get:function(n){return i[n]},add:function(n,t){i[n]=t},remove:function(n){delete i[n]},removeAll:function(){i={}}}}const K={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class vo{constructor(n){this.parser=n,this.name=K.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,t=this.parser.json.nodes||[];for(let e=0,o=t.length;e<o;e++){const s=t[e];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(n){const t=this.parser,e="light:"+n;let o=t.cache.get(e);if(o)return o;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[n];let u;const m=new Me(16777215);c.color!==void 0&&m.setRGB(c.color[0],c.color[1],c.color[2],Pe);const d=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new Yn(m),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Kn(m),u.distance=d;break;case"spot":u=new Un(m),u.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,We(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=t.createUniqueName(c.name||"light_"+n),o=Promise.resolve(u),t.cache.add(e,o),o}getDependency(n,t){if(n==="light")return this._loadLight(t)}createNodeAttachment(n){const t=this,e=this.parser,s=e.json.nodes[n],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(c){return e._getNodeRef(t.cache,l,c)})}}class ko{constructor(){this.name=K.KHR_MATERIALS_UNLIT}getMaterialType(){return ot}extendParams(n,t,e){const o=[];n.color=new Me(1,1,1),n.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;n.color.setRGB(a[0],a[1],a[2],Pe),n.opacity=a[3]}s.baseColorTexture!==void 0&&o.push(e.assignTexture(n,"map",s.baseColorTexture,at))}return Promise.all(o)}}class Mo{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,t){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=o.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class To{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(e.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(e.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(e.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const l=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ee(l,l)}return Promise.all(s)}}class So{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(e.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(e.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class Ao{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Me(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=o.extensions[this.name];if(a.sheenColorFactor!==void 0){const l=a.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],Pe)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(e.assignTexture(t,"sheenColorMap",a.sheenColorTexture,at)),a.sheenRoughnessTexture!==void 0&&s.push(e.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Ro{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(e.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class Co{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(e.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const l=a.attenuationColor||[1,1,1];return t.attenuationColor=new Me().setRGB(l[0],l[1],l[2],Pe),Promise.all(s)}}class Lo{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=o.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class _o{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(e.assignTexture(t,"specularIntensityMap",a.specularTexture));const l=a.specularColorFactor||[1,1,1];return t.specularColor=new Me().setRGB(l[0],l[1],l[2],Pe),a.specularColorTexture!==void 0&&s.push(e.assignTexture(t,"specularColorMap",a.specularColorTexture,at)),Promise.all(s)}}class Po{constructor(n){this.parser=n,this.name=K.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(e.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class Io{constructor(n){this.parser=n,this.name=K.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ke}extendMaterialParams(n,t){const e=this.parser,o=e.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],a=o.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(e.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class Do{constructor(n){this.parser=n,this.name=K.KHR_TEXTURE_BASISU}loadTexture(n){const t=this.parser,e=t.json,o=e.textures[n];if(!o.extensions||!o.extensions[this.name])return null;const s=o.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(n,s.source,a)}}class Oo{constructor(n){this.parser=n,this.name=K.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const t=this.name,e=this.parser,o=e.json,s=o.textures[n];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=o.images[a.source];let c=e.textureLoader;if(l.uri){const u=e.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return e.loadTextureImage(n,a.source,c);if(o.extensionsRequired&&o.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){n(t.height===1)}})),this.isSupported}}class No{constructor(n){this.parser=n,this.name=K.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(n){const t=this.name,e=this.parser,o=e.json,s=o.textures[n];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=o.images[a.source];let c=e.textureLoader;if(l.uri){const u=e.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return e.loadTextureImage(n,a.source,c);if(o.extensionsRequired&&o.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return e.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){n(t.height===1)}})),this.isSupported}}class Fo{constructor(n){this.name=K.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const t=this.parser.json,e=t.bufferViews[n];if(e.extensions&&e.extensions[this.name]){const o=e.extensions[this.name],s=this.parser.getDependency("buffer",o.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(l){const c=o.byteOffset||0,u=o.byteLength||0,m=o.count,d=o.byteStride,p=new Uint8Array(l,c,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(m,d,p,o.mode,o.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(m*d);return a.decodeGltfBuffer(new Uint8Array(y),m,d,p,o.mode,o.filter),y})})}else return null}}class Bo{constructor(n){this.name=K.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const t=this.parser.json,e=t.nodes[n];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const o=t.meshes[e.mesh];for(const u of o.primitives)if(u.mode!==ve.TRIANGLES&&u.mode!==ve.TRIANGLE_STRIP&&u.mode!==ve.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=e.extensions[this.name].attributes,l=[],c={};for(const u in a)l.push(this.parser.getDependency("accessor",a[u]).then(m=>(c[u]=m,c[u])));return l.length<1?null:(l.push(this.parser.createNodeMesh(n)),Promise.all(l).then(u=>{const m=u.pop(),d=m.isGroup?m.children:[m],p=u[0].count,y=[];for(const M of d){const v=new bt,b=new oe,h=new xt,x=new oe(1,1,1),A=new qn(M.geometry,M.material,p);for(let C=0;C<p;C++)c.TRANSLATION&&b.fromBufferAttribute(c.TRANSLATION,C),c.ROTATION&&h.fromBufferAttribute(c.ROTATION,C),c.SCALE&&x.fromBufferAttribute(c.SCALE,C),A.setMatrixAt(C,v.compose(b,h,x));for(const C in c)if(C==="_COLOR_0"){const S=c[C];A.instanceColor=new Xn(S.array,S.itemSize,S.normalized)}else C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&M.geometry.setAttribute(C,c[C]);vn.prototype.copy.call(A,M),this.parser.assignFinalMaterial(A),y.push(A)}return m.isGroup?(m.clear(),m.add(...y),m):y[0]}))}}const Dn="glTF",rt=12,sn={JSON:1313821514,BIN:5130562};class Wo{constructor(n){this.name=K.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(n,0,rt),e=new TextDecoder;if(this.header={magic:e.decode(new Uint8Array(n.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Dn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-rt,s=new DataView(n,rt);let a=0;for(;a<o;){const l=s.getUint32(a,!0);a+=4;const c=s.getUint32(a,!0);if(a+=4,c===sn.JSON){const u=new Uint8Array(n,rt+a,l);this.content=e.decode(u)}else if(c===sn.BIN){const u=rt+a;this.body=n.slice(u,u+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class jo{constructor(n,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=K.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(n,t){const e=this.json,o=this.dracoLoader,s=n.extensions[this.name].bufferView,a=n.extensions[this.name].attributes,l={},c={},u={};for(const m in a){const d=$t[m]||m.toLowerCase();l[d]=a[m]}for(const m in n.attributes){const d=$t[m]||m.toLowerCase();if(a[m]!==void 0){const p=e.accessors[n.attributes[m]],y=et[p.componentType];u[d]=y.name,c[d]=p.normalized===!0}}return t.getDependency("bufferView",s).then(function(m){return new Promise(function(d,p){o.decodeDracoFile(m,function(y){for(const M in y.attributes){const v=y.attributes[M],b=c[M];b!==void 0&&(v.normalized=b)}d(y)},l,u,Pe,p)})})}}class zo{constructor(){this.name=K.KHR_TEXTURE_TRANSFORM}extendTexture(n,t){return(t.texCoord===void 0||t.texCoord===n.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(n=n.clone(),t.texCoord!==void 0&&(n.channel=t.texCoord),t.offset!==void 0&&n.offset.fromArray(t.offset),t.rotation!==void 0&&(n.rotation=t.rotation),t.scale!==void 0&&n.repeat.fromArray(t.scale),n.needsUpdate=!0),n}}class Go{constructor(){this.name=K.KHR_MESH_QUANTIZATION}}class On extends Mr{constructor(n,t,e,o){super(n,t,e,o)}copySampleValue_(n){const t=this.resultBuffer,e=this.sampleValues,o=this.valueSize,s=n*o*3+o;for(let a=0;a!==o;a++)t[a]=e[s+a];return t}interpolate_(n,t,e,o){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=l*2,u=l*3,m=o-t,d=(e-t)/m,p=d*d,y=p*d,M=n*u,v=M-u,b=-2*y+3*p,h=y-p,x=1-b,A=h-p+d;for(let C=0;C!==l;C++){const S=a[v+C+l],L=a[v+C+c]*m,R=a[M+C+l],k=a[M+C]*m;s[C]=x*S+A*L+b*R+h*k}return s}}const $o=new xt;class Ho extends On{interpolate_(n,t,e,o){const s=super.interpolate_(n,t,e,o);return $o.fromArray(s).normalize().toArray(s),s}}const ve={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},et={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},an={9728:rr,9729:Et,9984:nr,9985:tr,9986:er,9987:kn},ln={33071:sr,33648:or,10497:zt},Ct={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$t={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Be={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Vo={CUBICSPLINE:void 0,LINEAR:Sn,STEP:wr},Lt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Uo(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Mn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:kr})),i.DefaultMaterial}function Ve(i,n,t){for(const e in t.extensions)i[e]===void 0&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[e]=t.extensions[e])}function We(i,n){n.extras!==void 0&&(typeof n.extras=="object"?Object.assign(i.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function Ko(i,n,t){let e=!1,o=!1,s=!1;for(let u=0,m=n.length;u<m;u++){const d=n[u];if(d.POSITION!==void 0&&(e=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(s=!0),e&&o&&s)break}if(!e&&!o&&!s)return Promise.resolve(i);const a=[],l=[],c=[];for(let u=0,m=n.length;u<m;u++){const d=n[u];if(e){const p=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):i.attributes.position;a.push(p)}if(o){const p=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):i.attributes.normal;l.push(p)}if(s){const p=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):i.attributes.color;c.push(p)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const m=u[0],d=u[1],p=u[2];return e&&(i.morphAttributes.position=m),o&&(i.morphAttributes.normal=d),s&&(i.morphAttributes.color=p),i.morphTargetsRelative=!0,i})}function Yo(i,n){if(i.updateMorphTargets(),n.weights!==void 0)for(let t=0,e=n.weights.length;t<e;t++)i.morphTargetInfluences[t]=n.weights[t];if(n.extras&&Array.isArray(n.extras.targetNames)){const t=n.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let e=0,o=t.length;e<o;e++)i.morphTargetDictionary[t[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function qo(i){let n;const t=i.extensions&&i.extensions[K.KHR_DRACO_MESH_COMPRESSION];if(t?n="draco:"+t.bufferView+":"+t.indices+":"+_t(t.attributes):n=i.indices+":"+_t(i.attributes)+":"+i.mode,i.targets!==void 0)for(let e=0,o=i.targets.length;e<o;e++)n+=":"+_t(i.targets[e]);return n}function _t(i){let n="";const t=Object.keys(i).sort();for(let e=0,o=t.length;e<o;e++)n+=t[e]+":"+i[t[e]]+";";return n}function Ht(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Xo(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Zo=new bt;class Qo{constructor(n={},t={}){this.json=n,this.extensions={},this.plugins={},this.options=t,this.cache=new wo,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,o=!1,s=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,s=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||o&&s<98?this.textureLoader=new Zn(this.options.manager):this.textureLoader=new Qn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new wn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,t){const e=this,o=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(a){const l={scene:a[0][o.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:o.asset,parser:e,userData:{}};return Ve(s,l,o),We(l,o),Promise.all(e._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){for(const c of l.scenes)c.updateMatrixWorld();n(l)})}).catch(t)}_markDefs(){const n=this.json.nodes||[],t=this.json.skins||[],e=this.json.meshes||[];for(let o=0,s=t.length;o<s;o++){const a=t[o].joints;for(let l=0,c=a.length;l<c;l++)n[a[l]].isBone=!0}for(let o=0,s=n.length;o<s;o++){const a=n[o];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(e[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(n,t){t!==void 0&&(n.refs[t]===void 0&&(n.refs[t]=n.uses[t]=0),n.refs[t]++)}_getNodeRef(n,t,e){if(n.refs[t]<=1)return e;const o=e.clone(),s=(a,l)=>{const c=this.associations.get(a);c!=null&&this.associations.set(l,c);for(const[u,m]of a.children.entries())s(m,l.children[u])};return s(e,o),o.name+="_instance_"+n.uses[t]++,o}_invokeOne(n){const t=Object.values(this.plugins);t.push(this);for(let e=0;e<t.length;e++){const o=n(t[e]);if(o)return o}return null}_invokeAll(n){const t=Object.values(this.plugins);t.unshift(this);const e=[];for(let o=0;o<t.length;o++){const s=n(t[o]);s&&e.push(s)}return e}getDependency(n,t){const e=n+":"+t;let o=this.cache.get(e);if(!o){switch(n){case"scene":o=this.loadScene(t);break;case"node":o=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":o=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":o=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":o=this.loadSkin(t);break;case"animation":o=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":o=this.loadCamera(t);break;default:if(o=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(n,t)}),!o)throw new Error("Unknown type: "+n);break}this.cache.add(e,o)}return o}getDependencies(n){let t=this.cache.get(n);if(!t){const e=this,o=this.json[n+(n==="mesh"?"es":"s")]||[];t=Promise.all(o.map(function(s,a){return e.getDependency(n,a)})),this.cache.add(n,t)}return t}loadBuffer(n){const t=this.json.buffers[n],e=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&n===0)return Promise.resolve(this.extensions[K.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(s,a){e.load(st.resolveURL(t.uri,o.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(n){const t=this.json.bufferViews[n];return this.getDependency("buffer",t.buffer).then(function(e){const o=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+o)})}loadAccessor(n){const t=this,e=this.json,o=this.json.accessors[n];if(o.bufferView===void 0&&o.sparse===void 0){const a=Ct[o.type],l=et[o.componentType],c=o.normalized===!0,u=new l(o.count*a);return Promise.resolve(new Mt(u,a,c))}const s=[];return o.bufferView!==void 0?s.push(this.getDependency("bufferView",o.bufferView)):s.push(null),o.sparse!==void 0&&(s.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(s).then(function(a){const l=a[0],c=Ct[o.type],u=et[o.componentType],m=u.BYTES_PER_ELEMENT,d=m*c,p=o.byteOffset||0,y=o.bufferView!==void 0?e.bufferViews[o.bufferView].byteStride:void 0,M=o.normalized===!0;let v,b;if(y&&y!==d){const h=Math.floor(p/y),x="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+h+":"+o.count;let A=t.cache.get(x);A||(v=new u(l,h*y,o.count*y/m),A=new Jn(v,y/m),t.cache.add(x,A)),b=new vr(A,c,p%y/m,M)}else l===null?v=new u(o.count*c):v=new u(l,p,o.count*c),b=new Mt(v,c,M);if(o.sparse!==void 0){const h=Ct.SCALAR,x=et[o.sparse.indices.componentType],A=o.sparse.indices.byteOffset||0,C=o.sparse.values.byteOffset||0,S=new x(a[1],A,o.sparse.count*h),L=new u(a[2],C,o.sparse.count*c);l!==null&&(b=new Mt(b.array.slice(),b.itemSize,b.normalized));for(let R=0,k=S.length;R<k;R++){const P=S[R];if(b.setX(P,L[R*c]),c>=2&&b.setY(P,L[R*c+1]),c>=3&&b.setZ(P,L[R*c+2]),c>=4&&b.setW(P,L[R*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(n){const t=this.json,e=this.options,s=t.textures[n].source,a=t.images[s];let l=this.textureLoader;if(a.uri){const c=e.manager.getHandler(a.uri);c!==null&&(l=c)}return this.loadTextureImage(n,s,l)}loadTextureImage(n,t,e){const o=this,s=this.json,a=s.textures[n],l=s.images[t],c=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(t,e).then(function(m){m.flipY=!1,m.name=a.name||l.name||"",m.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(m.name=l.uri);const p=(s.samplers||{})[a.sampler]||{};return m.magFilter=an[p.magFilter]||Et,m.minFilter=an[p.minFilter]||kn,m.wrapS=ln[p.wrapS]||zt,m.wrapT=ln[p.wrapT]||zt,o.associations.set(m,{textures:n}),m}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(n,t){const e=this,o=this.json,s=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(d=>d.clone());const a=o.images[n],l=self.URL||self.webkitURL;let c=a.uri||"",u=!1;if(a.bufferView!==void 0)c=e.getDependency("bufferView",a.bufferView).then(function(d){u=!0;const p=new Blob([d],{type:a.mimeType});return c=l.createObjectURL(p),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const m=Promise.resolve(c).then(function(d){return new Promise(function(p,y){let M=p;t.isImageBitmapLoader===!0&&(M=function(v){const b=new Xt(v);b.needsUpdate=!0,p(b)}),t.load(st.resolveURL(d,s.path),M,void 0,y)})}).then(function(d){return u===!0&&l.revokeObjectURL(c),d.userData.mimeType=a.mimeType||Xo(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[n]=m,m}assignTexture(n,t,e,o){const s=this;return this.getDependency("texture",e.index).then(function(a){if(!a)return null;if(e.texCoord!==void 0&&e.texCoord>0&&(a=a.clone(),a.channel=e.texCoord),s.extensions[K.KHR_TEXTURE_TRANSFORM]){const l=e.extensions!==void 0?e.extensions[K.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=s.associations.get(a);a=s.extensions[K.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),s.associations.set(a,c)}}return o!==void 0&&(a.colorSpace=o),n[t]=a,a})}assignFinalMaterial(n){const t=n.geometry;let e=n.material;const o=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(n.isPoints){const l="PointsMaterial:"+e.uuid;let c=this.cache.get(l);c||(c=new ar,Tt.prototype.copy.call(c,e),c.color.copy(e.color),c.map=e.map,c.sizeAttenuation=!1,this.cache.add(l,c)),e=c}else if(n.isLine){const l="LineBasicMaterial:"+e.uuid;let c=this.cache.get(l);c||(c=new ir,Tt.prototype.copy.call(c,e),c.color.copy(e.color),c.map=e.map,this.cache.add(l,c)),e=c}if(o||s||a){let l="ClonedMaterial:"+e.uuid+":";o&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=e.clone(),s&&(c.vertexColors=!0),a&&(c.flatShading=!0),o&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(e))),e=c}n.material=e}getMaterialType(){return Mn}loadMaterial(n){const t=this,e=this.json,o=this.extensions,s=e.materials[n];let a;const l={},c=s.extensions||{},u=[];if(c[K.KHR_MATERIALS_UNLIT]){const d=o[K.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),u.push(d.extendParams(l,s,t))}else{const d=s.pbrMetallicRoughness||{};if(l.color=new Me(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;l.color.setRGB(p[0],p[1],p[2],Pe),l.opacity=p[3]}d.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",d.baseColorTexture,at)),l.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,l.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(n)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(n,l)})))}s.doubleSided===!0&&(l.side=Ue);const m=s.alphaMode||Lt.OPAQUE;if(m===Lt.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,m===Lt.MASK&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==ot&&(u.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new Ee(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;l.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&a!==ot&&(u.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==ot){const d=s.emissiveFactor;l.emissive=new Me().setRGB(d[0],d[1],d[2],Pe)}return s.emissiveTexture!==void 0&&a!==ot&&u.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,at)),Promise.all(u).then(function(){const d=new a(l);return s.name&&(d.name=s.name),We(d,s),t.associations.set(d,{materials:n}),s.extensions&&Ve(o,d,s),d})}createUniqueName(n){const t=lr.sanitizeNodeName(n||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(n){const t=this,e=this.extensions,o=this.primitiveCache;function s(l){return e[K.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(c){return cn(c,l,t)})}const a=[];for(let l=0,c=n.length;l<c;l++){const u=n[l],m=qo(u),d=o[m];if(d)a.push(d.promise);else{let p;u.extensions&&u.extensions[K.KHR_DRACO_MESH_COMPRESSION]?p=s(u):p=cn(new cr,u,t),o[m]={primitive:u,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(n){const t=this,e=this.json,o=this.extensions,s=e.meshes[n],a=s.primitives,l=[];for(let c=0,u=a.length;c<u;c++){const m=a[c].material===void 0?Uo(this.cache):this.getDependency("material",a[c].material);l.push(m)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(c){const u=c.slice(0,c.length-1),m=c[c.length-1],d=[];for(let y=0,M=m.length;y<M;y++){const v=m[y],b=a[y];let h;const x=u[y];if(b.mode===ve.TRIANGLES||b.mode===ve.TRIANGLE_STRIP||b.mode===ve.TRIANGLE_FAN||b.mode===void 0)h=s.isSkinnedMesh===!0?new ur(v,x):new dr(v,x),h.isSkinnedMesh===!0&&h.normalizeSkinWeights(),b.mode===ve.TRIANGLE_STRIP?h.geometry=on(h.geometry,En):b.mode===ve.TRIANGLE_FAN&&(h.geometry=on(h.geometry,jt));else if(b.mode===ve.LINES)h=new mr(v,x);else if(b.mode===ve.LINE_STRIP)h=new pr(v,x);else if(b.mode===ve.LINE_LOOP)h=new fr(v,x);else if(b.mode===ve.POINTS)h=new hr(v,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(h.geometry.morphAttributes).length>0&&Yo(h,s),h.name=t.createUniqueName(s.name||"mesh_"+n),We(h,s),b.extensions&&Ve(o,h,b),t.assignFinalMaterial(h),d.push(h)}for(let y=0,M=d.length;y<M;y++)t.associations.set(d[y],{meshes:n,primitives:y});if(d.length===1)return s.extensions&&Ve(o,d[0],s),d[0];const p=new St;s.extensions&&Ve(o,p,s),t.associations.set(p,{meshes:n});for(let y=0,M=d.length;y<M;y++)p.add(d[y]);return p})}loadCamera(n){let t;const e=this.json.cameras[n],o=e[e.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?t=new gr(Tn.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):e.type==="orthographic"&&(t=new yr(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),e.name&&(t.name=this.createUniqueName(e.name)),We(t,e),Promise.resolve(t)}loadSkin(n){const t=this.json.skins[n],e=[];for(let o=0,s=t.joints.length;o<s;o++)e.push(this._loadNodeShallow(t.joints[o]));return t.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",t.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(o){const s=o.pop(),a=o,l=[],c=[];for(let u=0,m=a.length;u<m;u++){const d=a[u];if(d){l.push(d);const p=new bt;s!==null&&p.fromArray(s.array,u*16),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new xr(l,c)})}loadAnimation(n){const t=this.json,e=this,o=t.animations[n],s=o.name?o.name:"animation_"+n,a=[],l=[],c=[],u=[],m=[];for(let d=0,p=o.channels.length;d<p;d++){const y=o.channels[d],M=o.samplers[y.sampler],v=y.target,b=v.node,h=o.parameters!==void 0?o.parameters[M.input]:M.input,x=o.parameters!==void 0?o.parameters[M.output]:M.output;v.node!==void 0&&(a.push(this.getDependency("node",b)),l.push(this.getDependency("accessor",h)),c.push(this.getDependency("accessor",x)),u.push(M),m.push(v))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u),Promise.all(m)]).then(function(d){const p=d[0],y=d[1],M=d[2],v=d[3],b=d[4],h=[];for(let x=0,A=p.length;x<A;x++){const C=p[x],S=y[x],L=M[x],R=v[x],k=b[x];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const P=e._createAnimationTracks(C,S,L,R,k);if(P)for(let O=0;O<P.length;O++)h.push(P[O])}return new br(s,void 0,h)})}createNodeMesh(n){const t=this.json,e=this,o=t.nodes[n];return o.mesh===void 0?null:e.getDependency("mesh",o.mesh).then(function(s){const a=e._getNodeRef(e.meshCache,o.mesh,s);return o.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let c=0,u=o.weights.length;c<u;c++)l.morphTargetInfluences[c]=o.weights[c]}),a})}loadNode(n){const t=this.json,e=this,o=t.nodes[n],s=e._loadNodeShallow(n),a=[],l=o.children||[];for(let u=0,m=l.length;u<m;u++)a.push(e.getDependency("node",l[u]));const c=o.skin===void 0?Promise.resolve(null):e.getDependency("skin",o.skin);return Promise.all([s,Promise.all(a),c]).then(function(u){const m=u[0],d=u[1],p=u[2];p!==null&&m.traverse(function(y){y.isSkinnedMesh&&y.bind(p,Zo)});for(let y=0,M=d.length;y<M;y++)m.add(d[y]);return m})}_loadNodeShallow(n){const t=this.json,e=this.extensions,o=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const s=t.nodes[n],a=s.name?o.createUniqueName(s.name):"",l=[],c=o._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(n)});return c&&l.push(c),s.camera!==void 0&&l.push(o.getDependency("camera",s.camera).then(function(u){return o._getNodeRef(o.cameraCache,s.camera,u)})),o._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(n)}).forEach(function(u){l.push(u)}),this.nodeCache[n]=Promise.all(l).then(function(u){let m;if(s.isBone===!0?m=new Er:u.length>1?m=new St:u.length===1?m=u[0]:m=new vn,m!==u[0])for(let d=0,p=u.length;d<p;d++)m.add(u[d]);if(s.name&&(m.userData.name=s.name,m.name=a),We(m,s),s.extensions&&Ve(e,m,s),s.matrix!==void 0){const d=new bt;d.fromArray(s.matrix),m.applyMatrix4(d)}else s.translation!==void 0&&m.position.fromArray(s.translation),s.rotation!==void 0&&m.quaternion.fromArray(s.rotation),s.scale!==void 0&&m.scale.fromArray(s.scale);return o.associations.has(m)||o.associations.set(m,{}),o.associations.get(m).nodes=n,m}),this.nodeCache[n]}loadScene(n){const t=this.extensions,e=this.json.scenes[n],o=this,s=new St;e.name&&(s.name=o.createUniqueName(e.name)),We(s,e),e.extensions&&Ve(t,s,e);const a=e.nodes||[],l=[];for(let c=0,u=a.length;c<u;c++)l.push(o.getDependency("node",a[c]));return Promise.all(l).then(function(c){for(let m=0,d=c.length;m<d;m++)s.add(c[m]);const u=m=>{const d=new Map;for(const[p,y]of o.associations)(p instanceof Tt||p instanceof Xt)&&d.set(p,y);return m.traverse(p=>{const y=o.associations.get(p);y!=null&&d.set(p,y)}),d};return o.associations=u(s),s})}_createAnimationTracks(n,t,e,o,s){const a=[],l=n.name?n.name:n.uuid,c=[];Be[s.path]===Be.weights?n.traverse(function(p){p.morphTargetInfluences&&c.push(p.name?p.name:p.uuid)}):c.push(l);let u;switch(Be[s.path]){case Be.weights:u=Qt;break;case Be.rotation:u=Jt;break;case Be.position:case Be.scale:u=Zt;break;default:switch(e.itemSize){case 1:u=Qt;break;case 2:case 3:default:u=Zt;break}break}const m=o.interpolation!==void 0?Vo[o.interpolation]:Sn,d=this._getArrayFromAccessor(e);for(let p=0,y=c.length;p<y;p++){const M=new u(c[p]+"."+Be[s.path],t.array,d,m);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(M),a.push(M)}return a}_getArrayFromAccessor(n){let t=n.array;if(n.normalized){const e=Ht(t.constructor),o=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)o[s]=t[s]*e;t=o}return t}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(e){const o=this instanceof Jt?Ho:On;return new o(this.times,this.values,this.getValueSize()/3,e)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Jo(i,n,t){const e=n.attributes,o=new Tr;if(e.POSITION!==void 0){const l=t.json.accessors[e.POSITION],c=l.min,u=l.max;if(c!==void 0&&u!==void 0){if(o.set(new oe(c[0],c[1],c[2]),new oe(u[0],u[1],u[2])),l.normalized){const m=Ht(et[l.componentType]);o.min.multiplyScalar(m),o.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=n.targets;if(s!==void 0){const l=new oe,c=new oe;for(let u=0,m=s.length;u<m;u++){const d=s[u];if(d.POSITION!==void 0){const p=t.json.accessors[d.POSITION],y=p.min,M=p.max;if(y!==void 0&&M!==void 0){if(c.setX(Math.max(Math.abs(y[0]),Math.abs(M[0]))),c.setY(Math.max(Math.abs(y[1]),Math.abs(M[1]))),c.setZ(Math.max(Math.abs(y[2]),Math.abs(M[2]))),p.normalized){const v=Ht(et[p.componentType]);c.multiplyScalar(v)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(l)}i.boundingBox=o;const a=new Sr;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,i.boundingSphere=a}function cn(i,n,t){const e=n.attributes,o=[];function s(a,l){return t.getDependency("accessor",a).then(function(c){i.setAttribute(l,c)})}for(const a in e){const l=$t[a]||a.toLowerCase();l in i.attributes||o.push(s(e[a],l))}if(n.indices!==void 0&&!i.index){const a=t.getDependency("accessor",n.indices).then(function(l){i.setIndex(l)});o.push(a)}return en.workingColorSpace!==Pe&&"COLOR_0"in e&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${en.workingColorSpace}" not supported.`),We(i,n),Jo(i,n,t),Promise.all(o).then(function(){return n.targets!==void 0?Ko(i,n.targets,t):i})}const Nn={"Bench Press (Barbell)":"rig.benchpress","Bench Press - Wide Grip (Barbell)":"rig.benchpress","Incline Chest Press (Machine)":"rig.benchpress","Bicep Curl (Machine)":"bicep-curl","Bicep Curl (Cable)":"bicep-curl","Bicep Curl (Barbell)":"bicep-curl","Bicep Curl (Dumbbell)":"bicep-curl","Crunch (Machine)":"crunch","Chest Fly":"fly","Reverse Fly (Machine)":"fly","Seated Row (Cable)":"seated-row","Seated Row (Machine)":"seated-row","Seated Wide-Grip Row (Cable)":"seated-row","Rowing (Machine)":"seated-row","Lat Pulldown (Cable)":"seated-row","Shoulder Press (Machine)":"shoulder press","Shoulder Press (Plate Loaded)":"shoulder press","Seated Overhead Press (Barbell)":"shoulder press","Squat (Barbell)":"squat","Seated Leg Press (Machine)":"squat","Leg Extension (Machine)":"squat","Lying Leg Curl (Machine)":"squat","Seated Leg Curl (Machine)":"squat","Triceps Extension (Machine)":"tricep-extension","Triceps Extension (Cable)":"tricep-extension","Triceps Pushdown (Cable - Straight Bar)":"tricep-extension","Skullcrusher (Barbell)":"tricep-extension","Skullcrusher (Dumbbell)":"tricep-extension","Hip Abductor (Machine)":"abductur-adductur","Hip Adductor (Machine)":"abductur-adductur","Standing Calf Raise (Machine)":"squat","Seated Calf Raise (Plate Loaded)":"squat","Hip Thrust (Barbell)":"squat"};function es(i){return Nn[i]||null}async function ts(){return console.log("[ExerciseAnimations] Using embedded animations from character model"),null}function ns(i){const n=Nn[i];return{name:i,animationFile:null,prompt:null,hasAnimation:!!n,embeddedClipName:n}}const rs={chest_left:"Chest",chest_right:"Chest",back:"Back",left_shoulder:"Shoulders",right_shoulder:"Shoulders",left_bicep:"Biceps",right_bicep:"Biceps",left_forearm:"Triceps",right_forearm:"Triceps",left_quad:"Quads",right_quad:"Quads",left_glute:"Glutes",right_glute:"Glutes",left_calf:"Calves",right_calf:"Calves",abs_upper:"Core",abs_lower:"Core"};function os({checkpoint:i,currentAnimation:n=null,onSelectExercise:t,showPrompt:e=!1,muscleGenres:o={},isPaused:s=!1,onTogglePause:a}){const[l,c]=E.useState(null),[u,m]=E.useState({}),d=r.useMemo(()=>i?.exercises?[...i.exercises].sort((y,M)=>(M.volume||0)-(y.volume||0)):[],[i]);if(E.useEffect(()=>{if(!d.length)return;const y={};d.forEach(M=>{const v=ns(M.name);v&&(y[M.name]=v)}),m(y)},[d]),!i?.exercises?.length)return null;const p=y=>{const M=u[y.name];M?.hasAnimation&&t&&t(y.name,M.animationFile,y.song||null)};return r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},d.map((y,M)=>{const b=u[y.name]?.hasAnimation,h=n===y.name,x=l===y.name,A=Vt[y.name]||[],C=[...new Set(A.map(O=>rs[O]).filter(Boolean))],S=y.song?.genre,L=A[0],R=L&&o?o[L]:null,k=S&&S!=="unknown"&&S!=="none"?S:R&&R!=="unknown"&&R!=="none"?R:null,P=k?Te(k):null;return r.createElement("div",{key:y.name,onClick:()=>p(y),onMouseEnter:()=>c(y.name),onMouseLeave:()=>c(null),style:{display:"flex",flexDirection:"column",gap:"6px",padding:"10px 12px",borderRadius:"8px",background:h?"rgba(99, 102, 241, 0.2)":x&&b?"rgba(255, 255, 255, 0.08)":"rgba(255, 255, 255, 0.03)",border:h?"1px solid rgba(99, 102, 241, 0.4)":"1px solid transparent",cursor:b?"pointer":"default",opacity:b?1:.6,transition:"all 0.15s ease"}},r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.createElement("div",{style:{flex:1,minWidth:0,display:"flex",alignItems:"center",gap:"6px"}},h&&r.createElement("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:s?"#f59e0b":"#6366f1",animation:s?"none":"pulse 1.5s ease-in-out infinite"}}),r.createElement("span",{style:{fontSize:"12px",fontWeight:h?600:400,color:h?"#fff":"rgba(255, 255, 255, 0.85)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},y.name)),b?r.createElement("div",{onClick:O=>{O.stopPropagation(),h&&a?a():p(y)},style:{width:"24px",height:"24px",borderRadius:"50%",background:h?s?"rgba(245, 158, 11, 0.3)":"rgba(99, 102, 241, 0.3)":"rgba(255, 255, 255, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease",cursor:"pointer"}},h&&!s?r.createElement("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none"},r.createElement("rect",{x:"2",y:"1",width:"2",height:"8",fill:"white",rx:"0.5"}),r.createElement("rect",{x:"6",y:"1",width:"2",height:"8",fill:"white",rx:"0.5"})):r.createElement("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none"},r.createElement("path",{d:"M2 1.5v7l6-3.5-6-3.5z",fill:"white"}))):r.createElement("span",{style:{fontSize:"9px",color:"rgba(255, 255, 255, 0.3)",padding:"4px 6px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"4px"}},"No anim")),r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px",color:"rgba(255, 255, 255, 0.4)"}},r.createElement("span",null,y.sets," sets  ",Math.round(y.volume||0).toLocaleString()," kg"),y.song?r.createElement("span",{style:{display:"flex",alignItems:"center",gap:"4px",color:"rgba(16, 185, 129, 0.8)",fontSize:"9px"}},r.createElement("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor"},r.createElement("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})),r.createElement("span",{style:{maxWidth:"80px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},y.song.trackName)):r.createElement("span",{style:{fontSize:"9px",color:"rgba(255, 255, 255, 0.25)",padding:"1px 4px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"3px"}},"No song")),r.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"}},C.map(O=>r.createElement("span",{key:O,style:{fontSize:"9px",padding:"2px 6px",borderRadius:"4px",background:P?`${P}30`:"rgba(255, 255, 255, 0.08)",color:P||"rgba(255, 255, 255, 0.6)",border:`1px solid ${P?`${P}50`:"rgba(255, 255, 255, 0.1)"}`,fontWeight:500}},O)),k&&P&&r.createElement("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"4px",background:`${P}20`,color:P,border:`1px solid ${P}40`,fontWeight:500}},k)))}),e&&l&&u[l]?.prompt&&r.createElement("div",{style:{marginTop:"8px",padding:"8px 10px",background:"rgba(0, 0, 0, 0.4)",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.1)"}},r.createElement("div",{style:{fontSize:"10px",fontWeight:600,color:"rgba(255, 255, 255, 0.5)",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.5px"}},"Animation Prompt"),r.createElement("div",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.7)",fontStyle:"italic",lineHeight:1.4}},u[l].prompt)),r.createElement("style",null,`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `))}function ss({weekDates:i=[],checkpoints:n=[],currentCheckpoint:t,onDayClick:e,allCheckpoints:o=[]}){const s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],a=Math.max(...n.map(d=>d.totalVolume||0),1),l={};n.forEach(d=>{const p=(d.dateRaw||d.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,"");p&&(l[p]=d)});const c={};o.forEach((d,p)=>{c[d.id]=p});const u=t?(t.dateRaw||t.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,""):null,m=d=>{if(!d||!e)return;const p=c[d.id];typeof p=="number"&&e(p)};return r.createElement("div",{style:{display:"flex",gap:"4px",padding:"8px",background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)"}},i.map((d,p)=>{const y=l[d],M=!!y,v=d===u,b=y?(y.totalVolume||0)/a:0,h=y?.spotify?.genre,x=h?Te(h):f.color.accent;return r.createElement("div",{key:d,onClick:()=>M&&m(y),style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:M?"pointer":"default"}},r.createElement("span",{style:{fontSize:"9px",fontWeight:500,color:f.color.textTertiary,textTransform:"uppercase"}},s[p]),r.createElement("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:M?`${x}${Math.round(20+b*40).toString(16)}`:"rgba(255, 255, 255, 0.03)",border:v?`2px solid ${f.color.accent}`:M?`1px solid ${x}40`:"1px solid rgba(255, 255, 255, 0.06)",transition:"all 0.2s ease",position:"relative"},title:M?`${y.label}
${Math.round(y.totalVolume||0).toLocaleString()} kg
Genre: ${h||"Unknown"}
Click to navigate`:"No workout"},r.createElement("span",{style:{fontSize:"11px",fontWeight:M?600:400,color:M?f.color.textPrimary:f.color.textTertiary}},new Date(d).getDate()),v&&r.createElement("div",{style:{position:"absolute",bottom:"-4px",width:"4px",height:"4px",borderRadius:"50%",background:f.color.accent}})),M&&r.createElement("div",{style:{width:"24px",height:"3px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"2px",overflow:"hidden"}},r.createElement("div",{style:{width:`${b*100}%`,height:"100%",background:x,borderRadius:"2px"}})))}))}const Pt={Chest:["chest_left","chest_right"],Back:["back"],Legs:["left_quad","right_quad","left_calf","right_calf","left_glute","right_glute"],Shoulders:["left_shoulder","right_shoulder"],Arms:["left_bicep","right_bicep","left_forearm","right_forearm"],Core:["abs_upper","abs_lower"]},be={Chest:"#ef4444",Back:"#f97316",Legs:"#22c55e",Shoulders:"#3b82f6",Arms:"#a855f7",Core:"#eab308",Total:"#60a5fa"},as=[{id:"cumulative",label:"Cumulative",description:"Total volume over time"},{id:"per-session",label:"Per Session",description:"Volume each workout"},{id:"weekly",label:"Weekly",description:"Aggregated by week"}];function Fn({workoutData:i,currentProgress:n,selectedDate:t,onPointSelect:e,onPointNavigate:o}){const[s,a]=E.useState("cumulative"),[l,c]=E.useState(["Total"]),[u,m]=E.useState(null),d=E.useMemo(()=>{if(!i?.checkpoints)return{points:[],maxValue:0,dateToIndex:{}};const k=i.checkpoints.filter(g=>!g.isStart).sort((g,T)=>{const I=new Date((g.dateRaw||g.date).replace(" ","T")),N=new Date((T.dateRaw||T.date).replace(" ","T"));return I-N});if(k.length===0)return{points:[],maxValue:0,dateToIndex:{}};const P=[],O={Total:0};Object.keys(Pt).forEach(g=>O[g]=0);const B={};if(k.forEach((g,T)=>{const I=(g.dateRaw||g.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,"");if(!I)return;B[I]=T;const N=g.muscleTonnage||{},F={Total:g.totalVolume||0};Object.entries(Pt).forEach(([j,H])=>{F[j]=H.reduce((X,re)=>X+(N[re]||0),0)}),Object.keys(F).forEach(j=>{O[j]+=F[j]});const D={date:I,dateFormatted:new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric"}),index:T,checkpoint:g,progress:(T+1)/(k.length+1)};s==="cumulative"?D.values={...O}:D.values=F,P.push(D)}),s==="weekly"){const g=[],T={};return P.forEach(I=>{const N=new Date(I.date),W=new Date(N);W.setDate(N.getDate()-N.getDay());const F=W.toISOString().split("T")[0];T[F]||(T[F]={date:F,dateFormatted:W.toLocaleDateString("en-US",{month:"short",day:"numeric"}),values:{},count:0,progress:I.progress},Object.keys(be).forEach(D=>T[F].values[D]=0)),Object.entries(I.values).forEach(([D,j])=>{T[F].values[D]+=j}),T[F].count++,T[F].progress=I.progress}),Object.values(T).sort((I,N)=>new Date(I.date)-new Date(N.date)).forEach((I,N)=>{I.index=N,g.push(I)}),{points:g,maxValue:Math.max(...g.flatMap(I=>l.map(N=>I.values[N]||0))),dateToIndex:B}}const _=Math.max(...P.flatMap(g=>l.map(T=>g.values[T]||0)));return{points:P,maxValue:_,dateToIndex:B}},[i,s,l]),p=E.useMemo(()=>{if(!n||d.points.length===0)return null;let k=0,P=1/0;return d.points.forEach((O,B)=>{const _=Math.abs(O.progress-n);_<P&&(P=_,k=B)}),k},[d.points,n]),y=E.useCallback(k=>{c(P=>P.includes(k)?P.length===1?P:P.filter(O=>O!==k):[...P,k])},[]),{points:M,maxValue:v}=d;if(M.length===0)return r.createElement("div",{style:{padding:"20px",textAlign:"center",color:f.color.textTertiary,fontSize:"0.75rem"}},"No data available");const b=320,h=160,x={top:20,right:15,bottom:35,left:45},A=b-x.left-x.right,C=h-x.top-x.bottom,S=[0,v*.5,v].map(k=>k>=1e3?`${(k/1e3).toFixed(0)}k`:Math.round(k)),L=k=>{s!=="weekly"&&(e?.(k.date,k.checkpoint),o&&o(k.progress,k.index))},R=E.useMemo(()=>{if(l.length!==1||l[0]==="Total"||!i?.checkpoints)return null;const k=l[0],P=Pt[k];if(!P)return null;const O={};let B=0,_=0;i.checkpoints.forEach(I=>{if(I.isStart)return;const N=I.muscleTonnage||{},W=P.reduce((F,D)=>F+(N[D]||0),0);if(W>0){B+=W,_++;const F=I.spotify?.genre;F&&F!=="unknown"&&(O[F]=(O[F]||0)+W)}});let g=null,T=0;for(const[I,N]of Object.entries(O))N>T&&(T=N,g=I);return{group:k,totalVolume:B,workoutCount:_,topGenre:g,genrePercentage:g?Math.round(T/B*100):0}},[l,i]);return r.createElement("div",{style:{fontFamily:f.font.body}},r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px",flexWrap:"wrap",gap:"8px"}},r.createElement("div",{style:{fontSize:"0.6875rem",fontWeight:500,letterSpacing:"0.08em",textTransform:"uppercase",color:f.color.textTertiary}},"Volume Over Time"),r.createElement("div",{style:{display:"flex",gap:"2px",background:"rgba(255, 255, 255, 0.03)",borderRadius:f.radius.sm,padding:"2px"}},as.map(k=>r.createElement("button",{key:k.id,onClick:()=>a(k.id),style:{padding:"4px 8px",fontSize:"0.5625rem",fontFamily:f.font.body,background:s===k.id?"rgba(255, 255, 255, 0.1)":"transparent",border:"none",borderRadius:f.radius.sm,color:s===k.id?f.color.textPrimary:f.color.textTertiary,cursor:"pointer",transition:"all 0.15s ease"}},k.label)))),R&&r.createElement("div",{style:{marginBottom:"10px",padding:"10px 12px",background:`${be[R.group]}10`,border:`1px solid ${be[R.group]}30`,borderRadius:f.radius.sm}},r.createElement("div",{style:{fontSize:"0.6875rem",fontWeight:600,color:be[R.group],marginBottom:"6px"}},R.group," Insights"),r.createElement("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",fontSize:"0.5625rem",color:f.color.textSecondary}},r.createElement("div",null,r.createElement("span",{style:{color:f.color.textTertiary}},"Total: "),r.createElement("span",{style:{fontWeight:500}},(R.totalVolume/1e3).toFixed(1),"k kg")),r.createElement("div",null,r.createElement("span",{style:{color:f.color.textTertiary}},"Workouts: "),r.createElement("span",{style:{fontWeight:500}},R.workoutCount)),R.topGenre&&r.createElement("div",null,r.createElement("span",{style:{color:f.color.textTertiary}},"Favorite music: "),r.createElement("span",{style:{fontWeight:500,color:f.color.textPrimary}},R.topGenre),r.createElement("span",{style:{color:f.color.textTertiary}}," (",R.genrePercentage,"%)")))),r.createElement("svg",{viewBox:"0 0 320 160",preserveAspectRatio:"xMidYMid meet",style:{width:"100%",height:"auto",overflow:"visible"},onMouseLeave:()=>m(null)},S.map((k,P)=>{const O=x.top+C-P/(S.length-1)*C;return r.createElement("g",{key:P},r.createElement("line",{x1:x.left,y1:O,x2:320-x.right,y2:O,stroke:f.color.borderSubtle,strokeDasharray:"2,2",opacity:.5}),r.createElement("text",{x:x.left-6,y:O+3,textAnchor:"end",fontSize:"9",fill:f.color.textTertiary},k))}),p!==null&&r.createElement("g",null,r.createElement("line",{x1:x.left+p/(M.length-1)*A,y1:x.top,x2:x.left+p/(M.length-1)*A,y2:x.top+C,stroke:f.color.accent,strokeWidth:"2",strokeDasharray:"4,4"}),r.createElement("circle",{cx:x.left+p/(M.length-1)*A,cy:x.top-6,r:"4",fill:f.color.accent})),l.map(k=>{if(M.length<2)return null;const P=M.map((O,B)=>{const _=x.left+B/(M.length-1)*A,g=x.top+C-(O.values[k]||0)/v*C;return`${_},${g}`}).join(" ");return r.createElement("g",{key:k},r.createElement("polygon",{points:`${x.left},${x.top+C} ${P} ${x.left+A},${x.top+C}`,fill:be[k],fillOpacity:"0.1"}),r.createElement("polyline",{points:P,fill:"none",stroke:be[k],strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),M.map((k,P)=>{const O=x.left+P/(M.length-1)*A,B=u===P,_=p===P;return r.createElement("g",{key:P},r.createElement("rect",{x:O-A/M.length/2,y:x.top,width:A/M.length,height:C,fill:"transparent",style:{cursor:s!=="weekly"?"pointer":"default"},onMouseEnter:()=>m(P),onClick:()=>L(k)}),(B||_)&&l.map(g=>{const T=x.top+C-(k.values[g]||0)/v*C;return r.createElement("circle",{key:g,cx:O,cy:T,r:_?5:4,fill:be[g],stroke:f.color.bgDeep,strokeWidth:"2"})}))}),M.length>0&&[0,Math.floor(M.length/2),M.length-1].map((k,P)=>M[k]?r.createElement("text",{key:P,x:x.left+k/(M.length-1)*A,y:h-8,textAnchor:"middle",fontSize:"9",fill:f.color.textTertiary},M[k].dateFormatted):null)),u!==null&&M[u]&&r.createElement("div",{style:{marginTop:"4px",padding:"6px 10px",background:"rgba(0, 0, 0, 0.6)",borderRadius:f.radius.sm,fontSize:"0.5625rem",display:"flex",gap:"12px",flexWrap:"wrap"}},r.createElement("div",{style:{color:f.color.textSecondary}},M[u].dateFormatted),l.map(k=>r.createElement("div",{key:k,style:{display:"flex",alignItems:"center",gap:"4px"}},r.createElement("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:be[k]}}),r.createElement("span",{style:{color:f.color.textPrimary}},((M[u].values[k]||0)/1e3).toFixed(1),"k")))),r.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"10px"}},Object.keys(be).map(k=>r.createElement("button",{key:k,onClick:()=>y(k),style:{display:"flex",alignItems:"center",gap:"4px",padding:"3px 8px",fontSize:"0.5625rem",fontFamily:f.font.body,background:l.includes(k)?`${be[k]}20`:"transparent",border:`1px solid ${l.includes(k)?be[k]+"60":f.color.borderSubtle}`,borderRadius:f.radius.sm,color:l.includes(k)?be[k]:f.color.textTertiary,cursor:"pointer",transition:"all 0.15s ease"}},r.createElement("div",{style:{width:"6px",height:"6px",borderRadius:"2px",background:be[k],opacity:l.includes(k)?1:.4}}),k))))}function is({checkpoints:i=[],size:n=280}){const[t,e]=E.useState(null),[o,s]=E.useState({x:0,y:0}),a=E.useRef(null),l=Math.min(Math.max(n,200),400),{data:c,totalSets:u}=E.useMemo(()=>{if(!i||i.length===0)return{data:[],totalSets:0};const h={},x={"Bench Press":"Chest","Incline Bench Press":"Chest","Dumbbell Fly":"Chest","Push Up":"Chest","Cable Crossover":"Chest",Deadlift:"Back","Barbell Row":"Back","Pull Up":"Back","Lat Pulldown":"Back","Seated Row":"Back","Shoulder Press":"Shoulders","Lateral Raise":"Shoulders","Front Raise":"Shoulders","Face Pull":"Shoulders","Bicep Curl":"Arms","Hammer Curl":"Arms","Tricep Extension":"Arms","Tricep Pushdown":"Arms",Squat:"Legs","Leg Press":"Legs",Lunge:"Legs","Leg Extension":"Legs","Leg Curl":"Legs","Calf Raise":"Legs",Crunch:"Core",Plank:"Core","Russian Twist":"Core"},A=R=>{const k=R.toLowerCase();return k.includes("bench")||k.includes("chest")||k.includes("fly")||k.includes("push up")?"Chest":k.includes("row")||k.includes("pull")||k.includes("deadlift")||k.includes("lat")?"Back":k.includes("shoulder")||k.includes("press")||k.includes("lateral")||k.includes("face")?"Shoulders":k.includes("curl")||k.includes("tricep")||k.includes("bicep")?"Arms":k.includes("squat")||k.includes("leg")||k.includes("lunge")||k.includes("calf")?"Legs":k.includes("crunch")||k.includes("plank")||k.includes("ab")||k.includes("core")?"Core":"Other"};let C=0;i.forEach(R=>{R.isStart||R.isEnd||R.exercises?.forEach(k=>{const P=k.name||"Unknown",O=k.sets||1;h[P]||(h[P]={name:P,sets:0,category:x[P]||A(P)}),h[P].sets+=O,C+=O})});const S={};return Object.values(h).forEach(R=>{S[R.category]||(S[R.category]={name:R.category,sets:0,exercises:[]}),S[R.category].sets+=R.sets,S[R.category].exercises.push(R)}),Object.values(S).forEach(R=>{R.exercises.sort((k,P)=>P.sets-k.sets),R.exercises=R.exercises.slice(0,5)}),{data:Object.values(S).sort((R,k)=>k.sets-R.sets).slice(0,6),totalSets:C}},[i]);if(c.length===0)return null;const m=l/2,d=l/2,p=l*.15,y=l*.28,M=l*.42,v={Chest:"#ef4444",Back:"#3b82f6",Shoulders:"#f59e0b",Arms:"#a855f7",Legs:"#22c55e",Core:"#06b6d4",Other:"#6b7280"},b=E.useMemo(()=>{const h=[];let x=-Math.PI/2;return c.forEach(A=>{const C=A.sets/u*Math.PI*2,S=x,L=x+C,R=v[A.name]||"#6b7280";h.push({type:"category",name:A.name,sets:A.sets,path:un(m,d,p,y,S,L),color:R,midAngle:(S+L)/2});let k=S;A.exercises.forEach(P=>{const O=P.sets/u*Math.PI*2,B=k+O;h.push({type:"exercise",name:P.name,sets:P.sets,category:A.name,path:un(m,d,y+2,M,k,B),color:R,opacity:.7,midAngle:(k+B)/2}),k=B}),x=L}),h},[c,u,m,d]);return r.createElement("div",{style:{background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)",padding:"12px",display:"flex",flexDirection:"column",alignItems:"center"}},r.createElement("div",{style:{position:"relative"}},r.createElement("svg",{width:l,height:l,viewBox:`0 0 ${l} ${l}`},b.map((h,x)=>r.createElement("path",{key:x,d:h.path,fill:h.color,fillOpacity:t===null?h.opacity||.9:t.type==="category"&&t.name===h.name||t.type==="exercise"&&(t.name===h.name||t.name===h.category)?1:.2,stroke:"rgba(0,0,0,0.3)",strokeWidth:"1",style:{cursor:"pointer",transition:"fill-opacity 0.2s"},onMouseEnter:A=>{h.type==="category"?e({type:"category",name:h.name,sets:h.sets}):e({type:"exercise",name:h.name,sets:h.sets,category:h.category})},onMouseMove:A=>{if(a.current){const C=a.current.getBoundingClientRect();s({x:A.clientX-C.left,y:A.clientY-C.top})}},onMouseLeave:()=>e(null)})),r.createElement("text",{x:m,y:d-5,textAnchor:"middle",fill:f.color.textPrimary,fontSize:"16",fontWeight:"600",fontFamily:f.font.body},u),r.createElement("text",{x:m,y:d+10,textAnchor:"middle",fill:f.color.textTertiary,fontSize:"9",fontFamily:f.font.body},t?`${t.type==="category",t.name}: ${t.sets||0} sets`:"total sets"))),t&&t.type==="exercise"&&r.createElement("div",{style:{position:"absolute",left:o.x+10,top:o.y-28,padding:"6px 10px",background:"rgba(0,0,0,0.85)",color:f.color.textPrimary,borderRadius:"6px",fontSize:"10px",pointerEvents:"none",zIndex:40,transform:o.x>l/2?"translateX(-100%)":"none"}},r.createElement("div",{style:{fontWeight:600}},t.name),r.createElement("div",{style:{fontSize:11,color:f.color.textSecondary}},t.sets," sets  ",t.category)),r.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"12px",justifyContent:"center"}},c.map(h=>r.createElement("div",{key:h.name,style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"9px",color:t===h.name?v[h.name]:f.color.textTertiary,cursor:"pointer"},onMouseEnter:()=>e(h.name),onMouseLeave:()=>e(null)},r.createElement("div",{style:{width:"6px",height:"6px",borderRadius:"2px",background:v[h.name]}}),h.name))))}function un(i,n,t,e,o,s){const a=ft(i,n,t,s),l=ft(i,n,t,o),c=ft(i,n,e,s),u=ft(i,n,e,o),m=s-o<=Math.PI?0:1;return["M",c.x,c.y,"A",e,e,0,m,0,u.x,u.y,"L",l.x,l.y,"A",t,t,0,m,1,a.x,a.y,"Z"].join(" ")}function ft(i,n,t,e){return{x:i+t*Math.cos(e),y:n+t*Math.sin(e)}}function ls({checkpoints:i=[],width:n,height:t}){const[e,o]=E.useState(null),[s,a]=E.useState({x:0,y:0}),l=E.useRef(null),[c,u]=E.useState({width:320,height:180});E.useEffect(()=>{if(typeof n=="number"&&typeof t=="number"||!l.current)return;const L=l.current,R=new ResizeObserver(k=>{const P=k[0];if(!P)return;const O=P.contentRect.width,B=Math.max(240,O-24),_=Math.round(Math.min(B,560)),g=Math.round(Math.max(180,Math.min(260,_*.56)));u({width:_,height:g})});return R.observe(L),()=>R.disconnect()},[n,t]);const m=typeof n=="number"?n:c.width,d=typeof t=="number"?t:c.height,{monthlyData:p,globalMax:y,months:M}=E.useMemo(()=>{if(!i||i.length===0)return{monthlyData:{},globalMax:0,months:[]};const L={};i.forEach(O=>{if(!(O.isStart||O.isEnd))try{const B=O.dateRaw?.split(" ")[0]?.replace(/"/g,""),_=new Date(B),g=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`;L[g]||(L[g]=[]),L[g].push(O.totalVolume||0)}catch{}});const R={};let k=0;Object.entries(L).forEach(([O,B])=>{if(B.length===0)return;const _=[...B].sort((q,ne)=>q-ne),g=_.length,T=_[0],I=_[g-1],N=g%2===0?(_[g/2-1]+_[g/2])/2:_[Math.floor(g/2)],W=Math.floor(g/4),F=Math.floor(3*g/4),D=_[W],j=_[F],H=j-D,X=Math.max(T,D-1.5*H),re=Math.min(I,j+1.5*H),Y=_.filter(q=>q<X||q>re);R[O]={min:T,max:I,median:N,q1:D,q3:j,whiskerLow:X,whiskerHigh:re,outliers:Y,count:g,mean:B.reduce((q,ne)=>q+ne,0)/g},k=Math.max(k,I)});const P=Object.keys(R).sort();return{monthlyData:R,globalMax:k,months:P}},[i]),v=L=>{if(l.current){const R=l.current.getBoundingClientRect();a({x:L.clientX-R.left,y:L.clientY-R.top})}};if(M.length===0)return null;const b={top:20,right:15,bottom:35,left:45},h=m-b.left-b.right,x=d-b.top-b.bottom,A=Math.min(30,h/M.length*.6),C=h/M.length,S=L=>b.top+x-L/y*x;return r.createElement("div",{ref:l,onMouseMove:v,style:{background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)",padding:"12px",position:"relative"}},r.createElement("svg",{width:m,height:d,viewBox:`0 0 ${m} ${d}`,style:{display:"block"}},[0,.25,.5,.75,1].map((L,R)=>{const k=y*L,P=S(k);return r.createElement("g",{key:R},r.createElement("line",{x1:b.left,y1:P,x2:m-b.right,y2:P,stroke:"rgba(255, 255, 255, 0.06)",strokeDasharray:"2,2"}),r.createElement("text",{x:b.left-5,y:P,textAnchor:"end",dominantBaseline:"middle",fill:f.color.textTertiary,fontSize:"8",fontFamily:f.font.body},(k/1e3).toFixed(0),"k"))}),M.map((L,R)=>{const k=p[L],P=b.left+R*C+C/2,O=e===L;return r.createElement("g",{key:L,onMouseEnter:()=>o(L),onMouseLeave:()=>o(null),style:{cursor:"pointer"}},r.createElement("line",{x1:P,y1:S(k.whiskerHigh),x2:P,y2:S(k.whiskerLow),stroke:O?f.color.accent:"rgba(255, 255, 255, 0.4)",strokeWidth:"1"}),r.createElement("line",{x1:P-A/4,y1:S(k.whiskerHigh),x2:P+A/4,y2:S(k.whiskerHigh),stroke:O?f.color.accent:"rgba(255, 255, 255, 0.4)",strokeWidth:"1"}),r.createElement("line",{x1:P-A/4,y1:S(k.whiskerLow),x2:P+A/4,y2:S(k.whiskerLow),stroke:O?f.color.accent:"rgba(255, 255, 255, 0.4)",strokeWidth:"1"}),r.createElement("rect",{x:P-A/2,y:S(k.q3),width:A,height:S(k.q1)-S(k.q3),fill:O?"rgba(59, 130, 246, 0.3)":"rgba(59, 130, 246, 0.15)",stroke:f.color.accent,strokeWidth:"1"}),r.createElement("line",{x1:P-A/2,y1:S(k.median),x2:P+A/2,y2:S(k.median),stroke:f.color.accent,strokeWidth:"2"}),r.createElement("circle",{cx:P,cy:S(k.mean),r:"2.5",fill:f.color.accentWarm}),k.outliers.map((B,_)=>r.createElement("circle",{key:_,cx:P,cy:S(B),r:"2",fill:"none",stroke:f.color.textTertiary,strokeWidth:"1"})),r.createElement("text",{x:P,y:t-8,textAnchor:"middle",fill:O?f.color.textPrimary:f.color.textTertiary,fontSize:"9",fontFamily:f.font.body},dn(L)))}),r.createElement("text",{x:10,y:b.top+x/2,textAnchor:"middle",fill:f.color.textTertiary,fontSize:"8",fontFamily:f.font.body,transform:`rotate(-90, 10, ${b.top+x/2})`},"Volume (kg)")),e&&p[e]&&r.createElement("div",{style:{position:"absolute",left:s.x+10,top:s.y-40,padding:"8px 12px",background:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(8px)",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.1)",fontSize:"10px",color:f.color.textPrimary,whiteSpace:"nowrap",pointerEvents:"none",zIndex:100,transform:s.x>m/2?"translateX(-100%)":"none"}},r.createElement("div",{style:{fontWeight:600,marginBottom:"4px"}},dn(e)),r.createElement("div",{style:{display:"flex",gap:"12px",color:f.color.textSecondary}},r.createElement("span",null,"Med: ",(p[e].median/1e3).toFixed(1),"k"),r.createElement("span",null,"Avg: ",(p[e].mean/1e3).toFixed(1),"k"),r.createElement("span",null,"n=",p[e].count))),r.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginTop:"8px",fontSize:"9px",color:f.color.textTertiary}},r.createElement("span",{style:{display:"flex",alignItems:"center",gap:"4px"}},r.createElement("span",{style:{width:"10px",height:"2px",background:f.color.accent}}),"Median"),r.createElement("span",{style:{display:"flex",alignItems:"center",gap:"4px"}},r.createElement("span",{style:{width:"6px",height:"6px",borderRadius:"50%",background:f.color.accentWarm}}),"Mean")))}function dn(i){const[n,t]=i.split("-");return new Date(parseInt(n),parseInt(t)-1).toLocaleDateString("en-US",{month:"short"})}const mn={chest:"#ef4444",back:"#3b82f6",shoulder:"#8b5cf6",bicep:"#f97316",forearm:"#eab308",quad:"#22c55e",glute:"#14b8a6",calf:"#06b6d4",abs:"#ec4899"},pn={chest:"Chest",back:"Back",shoulder:"Shoulders",bicep:"Biceps",forearm:"Forearms",quad:"Quads",glute:"Glutes",calf:"Calves",abs:"Core"};function cs({genreMuscleData:i,muscleSessionCounts:n,genrePlayCounts:t}){const[e,o]=E.useState(null),[s,a]=E.useState({width:300,height:300}),[l,c]=E.useState("volume"),[u,m]=E.useState(6),d=E.useRef(null);E.useEffect(()=>{if(!d.current)return;const g=new ResizeObserver(T=>{const I=T[0];if(I){const N=Math.min(I.contentRect.width,400);a({width:N,height:N})}});return g.observe(d.current),()=>g.disconnect()},[]);const{genres:p,allGenresCount:y,muscles:M,connections:v,maxValue:b}=E.useMemo(()=>{if(!i||Object.keys(i).length===0)return{genres:[],allGenresCount:0,muscles:[],connections:[],maxValue:0,genreTotalPlays:0,muscleTotalValue:0};const g={},T={},I={},N={},W=[];Object.entries(i).forEach(([G,J])=>{!G||G==="unknown"||(T[G]=(T[G]||0)+1,Object.entries(J).forEach(([xe,Ae])=>{Ae<=0||(g[G]=(g[G]||0)+Ae,I[xe]=(I[xe]||0)+Ae,N[xe]=(N[xe]||0)+1,W.push({genre:G,muscle:xe,volume:Ae}))}))});const F=n||N,D=t||T,j=Object.entries(g).map(([G,J])=>({name:G,total:J,plays:Number(D?.[G]??0),color:Te(G)}));let H=j.filter(G=>G.name&&G.name!=="unknown"&&G.plays>1).sort((G,J)=>J.plays-G.plays||J.total-G.total);H.length===0&&(H=j.sort((G,J)=>J.total-G.total).slice(0,6).map(G=>({...G,plays:Math.max(1,G.plays||0)})));const X=H.slice(0,Math.max(1,Math.min(u,H.length))),re=Object.entries(I).sort((G,J)=>J[1]-G[1]).slice(0,6).map(([G,J])=>({name:G,total:J,sessions:F[G]||1,color:mn[G]||"#666",label:pn[G]||G})),Y=X.reduce((G,J)=>G+J.plays,0),q=l==="volume"?re.reduce((G,J)=>G+J.total,0):re.reduce((G,J)=>G+J.sessions,0),ne=new Set(X.map(G=>G.name)),ie=new Set(re.map(G=>G.name)),fe=W.filter(G=>ne.has(G.genre)&&ie.has(G.muscle)),ye=Math.max(...fe.map(G=>G.volume),1);return{genres:X,allGenresCount:H.length,muscles:re,connections:fe,maxValue:ye,genreTotalPlays:Y,muscleTotalValue:q}},[i,n,t,l,u]);E.useEffect(()=>{y&&m(g=>Math.max(1,Math.min(g,y)))},[y]);const{genreArcs:h,muscleArcs:x}=E.useMemo(()=>{const{width:g,height:T}=s,I=g/2,N=T/2,W=Math.min(g,T)/2-40,F=p.reduce((ue,Se)=>ue+Se.plays,0),D=l==="volume"?M.reduce((ue,Se)=>ue+Se.total,0):M.reduce((ue,Se)=>ue+Se.sessions,0),j=Math.PI,X=Math.PI*2-j,re=Math.min(.03,X/Math.max(1,p.length)*.12),Y=re*Math.max(0,p.length-1),q=X-Y;let ne=j;const ie=p.map((ue,Se)=>{const Ie=ue.plays/Math.max(1,F),se=q*Ie,we=ne,he=we+se,le=(we+he)/2;return ne=he+re,{...ue,startAngle:we,endAngle:he,midAngle:le,x:I+Math.cos(le)*W,y:N+Math.sin(le)*W,labelX:I+Math.cos(le)*(W+25),labelY:N+Math.sin(le)*(W+25)}}),fe=0,G=Math.PI-fe,J=.03,xe=J*Math.max(0,M.length-1),Ae=G-xe;let Re=fe;const ze=M.map((ue,Se)=>{const se=(l==="volume"?ue.total:ue.sessions)/Math.max(1,D),we=Ae*se,he=Re,le=he+we,Ce=(he+le)/2;return Re=le+J,{...ue,startAngle:he,endAngle:le,midAngle:Ce,x:I+Math.cos(Ce)*W,y:N+Math.sin(Ce)*W,labelX:I+Math.cos(Ce)*(W+25),labelY:N+Math.sin(Ce)*(W+25)}});return{genreArcs:ie,muscleArcs:ze}},[s,p,M,l]),A=E.useCallback((g,T,I,N,W,F)=>{const D=W+Math.cos(g)*I,j=F+Math.sin(g)*I,H=W+Math.cos(T)*I,X=F+Math.sin(T)*I,re=W+Math.cos(g)*N,Y=F+Math.sin(g)*N,q=W+Math.cos(T)*N,ne=F+Math.sin(T)*N,ie=T-g>Math.PI?1:0;return`
      M ${D} ${j}
      A ${I} ${I} 0 ${ie} 1 ${H} ${X}
      L ${q} ${ne}
      A ${N} ${N} 0 ${ie} 0 ${re} ${Y}
      Z
    `},[]),C=E.useCallback((g,T,I,N,W)=>{const F=W-30,D=I+Math.cos(g.startAngle)*F,j=N+Math.sin(g.startAngle)*F,H=I+Math.cos(g.endAngle)*F,X=N+Math.sin(g.endAngle)*F,re=I+Math.cos(T.startAngle)*F,Y=N+Math.sin(T.startAngle)*F,q=I+Math.cos(T.endAngle)*F,ne=N+Math.sin(T.endAngle)*F;return`
      M ${D} ${j}
      Q ${I} ${N} ${re} ${Y}
      A ${F} ${F} 0 0 1 ${q} ${ne}
      Q ${I} ${N} ${H} ${X}
      A ${F} ${F} 0 0 1 ${D} ${j}
      Z
    `},[]);if(p.length===0||M.length===0)return r.createElement("div",{style:{padding:"20px",textAlign:"center",color:f.color.textTertiary,fontSize:"12px"}},"Not enough data for music-muscle connections");const S=p.length>22,{width:L,height:R}=s,k=L/2,P=R/2,O=Math.min(L,R)/2-40,B=12,_=(g,T)=>e?e.type==="genre"?g===e.name:e.type==="muscle"?T===e.name:!0:!0;return r.createElement("div",{ref:d,style:{width:"100%",minHeight:"200px",position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",margin:"0 auto",paddingTop:"10px",paddingBottom:"8px",overflow:"visible"}},y>1&&r.createElement("div",{style:{width:"100%",maxWidth:"380px",marginBottom:"10px",padding:"0 6px"}},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"10px",color:f.color.textTertiary,marginBottom:"6px"}},r.createElement("span",null,"Genres"),r.createElement("span",{style:{color:f.color.textSecondary}},p.length," / ",y)),r.createElement("input",{type:"range",min:1,max:y,step:1,value:Math.min(u,y),onChange:g=>m(parseInt(g.target.value,10)||1),style:{width:"100%"},"aria-label":"Number of genres to display"}),S&&r.createElement("div",{style:{marginTop:"6px",fontSize:"10px",color:f.color.textMuted}},"Genre labels hidden at high counts  hover to inspect.")),r.createElement("svg",{width:L,height:R,viewBox:`0 0 ${L} ${R}`,style:{overflow:"visible"}},r.createElement("g",null,v.map((g,T)=>{const I=h.find(D=>D.name===g.genre),N=x.find(D=>D.name===g.muscle);if(!I||!N)return null;const F=_(g.genre,g.muscle)?.3+g.volume/b*.4:.05;return r.createElement("path",{key:`ribbon-${T}`,d:C(I,N,k,P,O),fill:I.color,opacity:F,style:{transition:"opacity 0.2s ease"}})})),r.createElement("g",null,h.map((g,T)=>{const I=!e||e.type==="genre"&&e.name===g.name||v.some(N=>N.genre===g.name&&N.muscle===e?.name);return r.createElement("g",{key:`genre-${T}`},r.createElement("path",{d:A(g.startAngle,g.endAngle,O-B,O,k,P),fill:g.color,opacity:I?1:.3,style:{cursor:"pointer",transition:"opacity 0.2s ease"},onMouseEnter:()=>o({type:"genre",name:g.name}),onMouseLeave:()=>o(null)}),!S&&(()=>{const N=Math.max(8,Math.min(g.labelX,L-8)),W=Math.max(8,Math.min(g.labelY,R-8)),F=g.midAngle>Math.PI*1.5?"start":"end";return r.createElement("text",{x:N,y:W,textAnchor:F,dominantBaseline:"middle",fill:I?f.color.textPrimary:f.color.textTertiary,fontSize:"10",fontFamily:f.font.body,style:{pointerEvents:"none",textTransform:"capitalize",transition:"fill 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:60}},g.name)})())})),r.createElement("g",null,x.map((g,T)=>{const I=!e||e.type==="muscle"&&e.name===g.name||v.some(N=>N.muscle===g.name&&N.genre===e?.name);return r.createElement("g",{key:`muscle-${T}`},r.createElement("path",{d:A(g.startAngle,g.endAngle,O-B,O,k,P),fill:g.color,opacity:I?1:.3,style:{cursor:"pointer",transition:"opacity 0.2s ease"},onMouseEnter:()=>o({type:"muscle",name:g.name}),onMouseLeave:()=>o(null)}),(()=>{const N=Math.max(8,Math.min(g.labelX,L-8)),W=Math.max(8,Math.min(g.labelY,R-8)),F=g.midAngle<Math.PI/2?"start":"end";return r.createElement("text",{x:N,y:W,textAnchor:F,dominantBaseline:"middle",fill:I?f.color.textPrimary:f.color.textTertiary,fontSize:"10",fontFamily:f.font.body,style:{pointerEvents:"none",transition:"fill 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:80}},g.label)})())}))),r.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"8px",marginTop:"12px",fontSize:"10px"}},r.createElement("span",{style:{color:f.color.textTertiary}},"Muscle by:"),r.createElement("button",{onClick:()=>c("volume"),style:{background:l==="volume"?"rgba(59, 130, 246, 0.2)":"transparent",border:`1px solid ${l==="volume"?"rgba(59, 130, 246, 0.4)":"rgba(255, 255, 255, 0.1)"}`,borderRadius:"4px",padding:"4px 8px",color:l==="volume"?f.color.accent:f.color.textTertiary,cursor:"pointer",fontSize:"10px",fontFamily:f.font.body,transition:"all 0.2s ease"}},"Volume"),r.createElement("button",{onClick:()=>c("sessions"),style:{background:l==="sessions"?"rgba(59, 130, 246, 0.2)":"transparent",border:`1px solid ${l==="sessions"?"rgba(59, 130, 246, 0.4)":"rgba(255, 255, 255, 0.1)"}`,borderRadius:"4px",padding:"4px 8px",color:l==="sessions"?f.color.accent:f.color.textTertiary,cursor:"pointer",fontSize:"10px",fontFamily:f.font.body,transition:"all 0.2s ease"}},"Sessions")),e&&r.createElement("div",{style:{position:"absolute",bottom:"50px",left:"50%",transform:"translateX(-50%)",padding:"6px 12px",background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(16px)",borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.08)",fontSize:"11px",color:f.color.textPrimary,whiteSpace:"nowrap",zIndex:10}},e.type==="genre"?r.createElement(r.Fragment,null,r.createElement("span",{style:{color:Te(e.name),textTransform:"capitalize"}},e.name)," - ",p.find(g=>g.name===e.name)?.plays||0," plays,"," ",v.filter(g=>g.genre===e.name).length," muscle groups"):r.createElement(r.Fragment,null,r.createElement("span",{style:{color:mn[e.name]}},pn[e.name]||e.name)," - ",l==="volume"?`${((M.find(g=>g.name===e.name)?.total||0)/1e3).toFixed(1)}t`:`${M.find(g=>g.name===e.name)?.sessions||0} sessions`,","," ",v.filter(g=>g.muscle===e.name).length," genres")))}function us({viewMode:i=ge.DAY,checkpoint:n,currentIndex:t,totalCheckpoints:e,allCheckpoints:o,onPrev:s,onNext:a,canGoPrev:l,canGoNext:c,audioState:u,onSetAudioPreview:m,onToggleAudio:d,onPlayPreview:p,onSetVolume:y,currentAnimation:M,onSelectExercise:v,muscleGenres:b,isAnimationPaused:h,onToggleAnimationPause:x,onClose:A,onExpand:C,isExpanded:S,onToggleViewMode:L,onNavigateToCheckpoint:R,workoutData:k,onShowCars:P,spotifyData:O,currentExerciseSong:B}){const _=Kt(),g=n?.spotify,T=g?.genre?Te(g.genre):f.color.accentSuccess,I=B||g?.song||null,N=E.useMemo(()=>{if(!n?.dateRaw)return null;const Y=n.dateRaw.split(" ")[0].replace(/"/g,""),q=new Date(Y),ne=q.getDay(),ie=q.getDate()-ne+(ne===0?-6:1),fe=new Date(q.setDate(ie)),ye=[];for(let G=0;G<7;G++){const J=new Date(fe);J.setDate(fe.getDate()+G),ye.push(J.toISOString().split("T")[0])}return{start:ye[0],end:ye[6],dates:ye,label:`Week of ${fe.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`}},[n?.dateRaw]),W=E.useMemo(()=>!N||!o?[]:o.filter(Y=>{if(Y.isStart)return!1;const q=(Y.dateRaw||Y.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,"");return N.dates.includes(q)}),[N,o]),F=E.useMemo(()=>{if(!n?.dateRaw)return"";const Y=n.dateRaw.split(" ")[0].replace(/"/g,""),q=n.dateRaw.split(" ")[1]?.substring(0,5)||"";return{date:new Date(Y).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),time:q}},[n?.dateRaw]),D=n?.isStart===!0,j=n?.isEnd===!0,H=D?"Welcome":j?"Congratulations!":i===ge.DAY?n?.label||"Workout":N?.label||"Week Overview",X=D?"Your Fitness Journey":j?"Journey Complete":i===ge.DAY?F.date:`${W.length} workout${W.length!==1?"s":""} this week`,re=E.useMemo(()=>{const Y=t/Math.max(1,e-1);return Math.round(Y*100)},[t,e]);return r.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",fontFamily:f.font.body,color:f.color.textPrimary}},r.createElement(co,{title:H,subtitle:X,accentColor:T,onExpand:C,isExpanded:S,onToggleViewMode:L,viewMode:i===ge.WEEK?"week":"day"}),r.createElement(uo,null,D?r.createElement(fs,{allCheckpoints:o,workoutData:k,onNavigateToCheckpoint:R,journeyProgress:re}):j?r.createElement(hs,{allCheckpoints:o,workoutData:k,spotifyDataByDate:O}):i===ge.DAY?r.createElement(ds,{checkpoint:n,formattedDate:F,spotifyData:g,selectedSong:I,genreColor:T,audioState:u,onSetAudioPreview:m,onToggleAudio:d,onPlayPreview:p,onSetVolume:y,currentAnimation:M,currentExerciseSong:B,onSelectExercise:v,muscleGenres:b,isAnimationPaused:h,onToggleAnimationPause:x,allCheckpoints:o,onShowCars:P}):r.createElement(ms,{currentWeek:N,weekCheckpoints:W,allCheckpoints:o,currentCheckpoint:n,workoutData:k,onNavigateToCheckpoint:R,currentIndex:t})),_&&r.createElement("div",{style:{padding:"12px 16px",borderTop:`1px solid ${f.color.borderDefault}`,background:f.color.bgElevated}},r.createElement(ho,{onPrev:s,onNext:a,canGoPrev:l,canGoNext:c,currentIndex:t,totalCheckpoints:e})))}function ds({checkpoint:i,formattedDate:n,spotifyData:t,selectedSong:e,genreColor:o,audioState:s,onSetAudioPreview:a,onToggleAudio:l,onPlayPreview:c,onSetVolume:u,currentAnimation:m,currentExerciseSong:d,onSelectExercise:p,muscleGenres:y,isAnimationPaused:M,onToggleAnimationPause:v,allCheckpoints:b,onShowCars:h}){const x=i?.totalVolume||0,A=x>0?Math.max(1,Math.round(x/1e3)):0,C=i?.durationSec||0,S=C>0?C/60:0,L=C>0&&(S<30||S>180),R=k=>k<=0?"--":`${Math.floor(k/60)} min`;return r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"28px"}},r.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"12px"}},r.createElement(ps,{label:"Total Volume",value:`${Math.round(x).toLocaleString()} kg`,icon:"weight",onClick:()=>h?.(x),hint:`${A} car${A!==1?"s":""}`}),r.createElement(je,{label:"Duration",value:R(C),icon:"duration"}),r.createElement(je,{label:"Time",value:n.time||"--:--",icon:"clock"}),t?.genre&&r.createElement(je,{label:"Top Genre",value:t.genre,color:o,icon:"music"})),L&&r.createElement("div",{style:{padding:"10px 12px",borderRadius:f.radius.md,background:"rgba(239, 68, 68, 0.10)",border:"1px solid rgba(239, 68, 68, 0.25)",color:f.color.textSecondary,fontSize:"12px",lineHeight:1.4}},r.createElement("span",{style:{color:f.color.textPrimary,fontWeight:600}},"Duration looks unusual.")," ","This workout is ",Math.round(S)," minutes (",S<30?"below 30 min":"above 3 hours","), so it may be faulty data."),e&&r.createElement("div",null,r.createElement(Ke,null,"Now Playing"),r.createElement(go,{trackName:e.trackName,artistName:e.artistName,alternativeSongs:t?.alternativeSongs||[],audioState:s,onSetAudioPreview:a,onToggleAudio:l,onPlayPreview:c,onSetVolume:u,shouldAutoPlay:d?.shouldAutoPlay||!1})),i?.exercises?.length>0&&r.createElement("div",null,r.createElement(Ke,null,"Exercises (",i.exercises.length,")"),r.createElement(os,{checkpoint:i,currentAnimation:m,onSelectExercise:p,showPrompt:!1,muscleGenres:y,isPaused:M,onTogglePause:v})),r.createElement(Eo,{checkpoint:i,allCheckpoints:b}))}function ms({currentWeek:i,weekCheckpoints:n,allCheckpoints:t,currentCheckpoint:e,workoutData:o,onNavigateToCheckpoint:s,currentIndex:a}){const l=E.useMemo(()=>{const m=n.reduce((M,v)=>M+(v.totalVolume||0),0),d=n.length,p=n.map(M=>M.spotify?.genre).filter(Boolean),y=p.length>0?p.sort((M,v)=>p.filter(b=>b===v).length-p.filter(b=>b===M).length)[0]:null;return{totalVolume:m,workoutCount:d,topGenre:y}},[n]),c=E.useMemo(()=>!t||t.length===0?0:a/t.length,[a,t]),u=E.useCallback((m,d)=>{s&&typeof d=="number"&&s(d+1)},[s]);return r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"28px"}},r.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"16px"}},r.createElement(je,{label:"Week Volume",value:`${Math.round(l.totalVolume).toLocaleString()} kg`,icon:"weight"}),r.createElement(je,{label:"Workouts",value:l.workoutCount.toString(),icon:"calendar"}),l.topGenre&&r.createElement(je,{label:"Top Genre",value:l.topGenre,color:Te(l.topGenre),icon:"music"})),r.createElement(Fn,{workoutData:o,currentProgress:c,onPointNavigate:u}),r.createElement("div",null,r.createElement(Ke,null,"This Week"),r.createElement(ss,{weekDates:i?.dates||[],checkpoints:n,currentCheckpoint:e,onDayClick:s,allCheckpoints:t})))}function je({label:i,value:n,icon:t,color:e}){const o={weight:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M6 9v12M18 9v12M12 3v18M2 9h4M18 9h4M8 9h8M8 21h8"})),clock:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("circle",{cx:"12",cy:"12",r:"10"}),r.createElement("path",{d:"M12 6v6l4 2"})),music:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M9 18V5l12-2v13M9 18c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zM21 16c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"})),calendar:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),r.createElement("path",{d:"M16 2v4M8 2v4M3 10h18"})),duration:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 3v4M3 5h4M6 17v4M4 19h4M13 3l-1.5 8h5L15 19"}))};return r.createElement("div",{style:{flex:"1 1 120px",padding:"16px",background:e?`${e}10`:"rgba(255, 255, 255, 0.03)",border:`1px solid ${e?`${e}30`:"rgba(255, 255, 255, 0.06)"}`,borderRadius:"12px"}},r.createElement("div",{style:{fontSize:"11px",fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",color:e||f.color.textTertiary,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"}},r.createElement("span",{style:{color:e||f.color.textTertiary}},o[t]),i),r.createElement("div",{style:{fontSize:"20px",fontWeight:700,color:f.color.textPrimary,letterSpacing:"-0.02em"}},n))}function ps({label:i,value:n,icon:t,color:e,onClick:o,hint:s}){const[a,l]=E.useState(!1),c={weight:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M6 9v12M18 9v12M12 3v18M2 9h4M18 9h4M8 9h8M8 21h8"})),clock:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("circle",{cx:"12",cy:"12",r:"10"}),r.createElement("path",{d:"M12 6v6l4 2"})),music:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M9 18V5l12-2v13M9 18c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zM21 16c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"})),calendar:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),r.createElement("path",{d:"M16 2v4M8 2v4M3 10h18"})),duration:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 3v4M3 5h4M6 17v4M4 19h4M13 3l-1.5 8h5L15 19"}))};return r.createElement("button",{onClick:o,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{flex:"1 1 120px",padding:"16px",background:a?"rgba(59, 130, 246, 0.15)":e?`${e}10`:"rgba(255, 255, 255, 0.03)",border:`1px solid ${a?"rgba(59, 130, 246, 0.4)":e?`${e}30`:"rgba(255, 255, 255, 0.06)"}`,borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s ease",fontFamily:f.font.body,transform:a?"translateY(-2px)":"none",boxShadow:a?"0 4px 20px rgba(59, 130, 246, 0.2)":"none"}},r.createElement("div",{style:{fontSize:"11px",fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",color:e||f.color.textTertiary,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"}},r.createElement("span",{style:{color:e||f.color.textTertiary}},c[t]),i),r.createElement("div",{style:{fontSize:"20px",fontWeight:700,color:f.color.textPrimary,letterSpacing:"-0.02em"}},n),r.createElement("div",{style:{fontSize:"10px",color:a?f.color.accent:f.color.textTertiary,marginTop:"8px",display:"flex",alignItems:"center",gap:"6px",opacity:a?1:.7,transition:"all 0.2s ease"}},a?"Click to visualize":s,a&&r.createElement("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 12h14M12 5l7 7-7 7"}))))}function fs({allCheckpoints:i,workoutData:n,onNavigateToCheckpoint:t,journeyProgress:e}){const o=E.useMemo(()=>{if(!i)return null;const a=i.filter(d=>!d.isStart&&!d.isEnd),l=a.reduce((d,p)=>d+(p.totalVolume||0),0),c=a[0]?.dateRaw,u=a[a.length-1]?.dateRaw;let m="";try{const d=p=>new Date(p.replace(" ","T")).toLocaleDateString("en-US",{month:"short",day:"numeric"});c&&u&&(m=`${d(c)} - ${d(u)}`)}catch{}return{totalWorkouts:a.length,totalVolume:Math.round(l),dateRange:m}},[i]),s=E.useCallback((a,l)=>{t&&typeof l=="number"&&t(l+1)},[t]);return r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"20px"}},r.createElement("div",{style:{padding:"16px",background:"rgba(59, 130, 246, 0.08)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:f.radius.md}},r.createElement("div",{style:{fontSize:"14px",fontWeight:500,color:f.color.textPrimary,marginBottom:"8px"}},"Explore Your Fitness Journey"),r.createElement("div",{style:{fontSize:"12px",color:f.color.textSecondary,lineHeight:1.5}},"Navigate through ",o?.totalWorkouts||0," workouts spanning ",o?.dateRange||"your journey",". See your muscles light up, hear what you listened to, and discover insights along the way.")),o&&r.createElement("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"}},r.createElement(je,{label:"Workouts",value:o.totalWorkouts.toString(),icon:"calendar"}),r.createElement(je,{label:"Total Volume",value:`${(o.totalVolume/1e3).toFixed(0)}k kg`,icon:"weight"})),r.createElement("div",null,r.createElement(Ke,null,"How to Navigate"),r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"10px"}},r.createElement(Dt,{icon:"scroll",title:"Scroll",description:"Zoom in for day details, out for week overview"}),r.createElement(Dt,{icon:"arrows",title:"Arrow Keys",description:"Move between workouts"}),r.createElement(Dt,{icon:"drag",title:"Click + Drag",description:"Rotate the 3D view"}))),r.createElement(Fn,{workoutData:n,currentProgress:0,onPointNavigate:s}))}function ht({value:i,label:n,color:t,isText:e=!1}){return r.createElement("div",{style:{flex:"1 1 100px",minWidth:"100px",background:f.color.bgGlass,backdropFilter:"blur(12px)",borderRadius:"12px",padding:"16px 14px",border:`1px solid ${f.color.borderSubtle}`,textAlign:"center",position:"relative",overflow:"hidden",transition:"transform 0.2s ease"}},r.createElement("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:"60%",height:"3px",background:`linear-gradient(90deg, transparent, ${t}, transparent)`,opacity:.8}}),r.createElement("div",{style:{fontFamily:f.font.display,fontSize:e?"15px":"22px",fontWeight:700,color:f.color.textPrimary,lineHeight:1.2,marginBottom:"6px",textTransform:e?"capitalize":"none",letterSpacing:e?"0":"-0.02em"}},typeof i=="number"?i.toLocaleString():i),r.createElement("div",{style:{fontSize:"10px",fontWeight:600,letterSpacing:"0.1em",textTransform:"uppercase",color:t}},n))}function It({icon:i,color:n,text:t}){const e={lightning:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:n},r.createElement("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})),trophy:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:n},r.createElement("path",{d:"M12 2C9.24 2 7 4.24 7 7h2c0-1.66 1.34-3 3-3s3 1.34 3 3h2c0-2.76-2.24-5-5-5zm0 20c1.66 0 3-1.34 3-3h-6c0 1.66 1.34 3 3 3zm6-6v-4c0-3.07-1.63-5.64-4.5-6.32V5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 6.36 6 8.92 6 12v4l-2 2v1h16v-1l-2-2z"})),calendar:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:n},r.createElement("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"}))};return r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"14px",padding:"12px 14px",background:"rgba(255, 255, 255, 0.03)",borderRadius:"10px",border:`1px solid ${f.color.borderSubtle}`}},r.createElement("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:`${n}20`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}},e[i]),r.createElement("span",{style:{fontSize:"13px",color:f.color.textSecondary,lineHeight:1.4,fontWeight:500}},t))}function hs({allCheckpoints:i,workoutData:n,spotifyDataByDate:t}){const e=E.useMemo(()=>{if(!i)return null;const o=i.filter(_=>!_.isStart&&!_.isEnd),s=o.reduce((_,g)=>_+(g.totalVolume||0),0),a=o.reduce((_,g)=>_+(g.exercises?.length||0),0),l=o[0]?.dateRaw,c=o[o.length-1]?.dateRaw;let u=0;try{if(l&&c){const _=new Date(l.replace(" ","T")),g=new Date(c.replace(" ","T"));u=Math.ceil((g-_)/6048e5)}}catch{}const m={};o.forEach(_=>{Object.entries(_.muscleVolumes||{}).forEach(([g,T])=>{const I=g.replace(/left_|right_/,"");m[I]=(m[I]||0)+1})});const d=Object.entries(m).sort((_,g)=>g[1]-_[1])[0],p={},y={},M={},v=_=>{const g=(_.dateRaw||_.date||"").toString();return g?(g.includes("T")?g.split("T")[0]:g.split(" ")[0]).replace(/"/g,""):null};o.forEach(_=>{const g=v(_),I=(g&&t?.get?.(g))?.genreCounts;let N=[];if(I&&I.size>0)N=Array.from(I.entries());else{const F=_.spotify?.genre;F&&F!=="unknown"&&(N=[[F,1]])}let W=!1;for(const[F,D]of N)!F||F==="unknown"||D<=0||(W=!0,p[F]=(p[F]||0)+D,M[F]=(M[F]||0)+(_.totalVolume||0));if(W)for(const[F]of N)!F||F==="unknown"||(y[F]=(y[F]||0)+1)});const b=Object.entries(p).sort((_,g)=>g[1]-_[1])[0],h=s/o.length,A=Object.entries(M).map(([_,g])=>({genre:_,avgVolume:g/(y[_]||1),count:y[_]||0})).filter(_=>_.count>=3).sort((_,g)=>g.avgVolume-_.avgVolume)[0],C=A?Math.round((A.avgVolume-h)/h*100):0,S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],L=[0,0,0,0,0,0,0];o.forEach(_=>{try{const g=new Date(_.dateRaw?.replace(" ","T"));L[g.getDay()]++}catch{}});const R=S[L.indexOf(Math.max(...L))],k={};o.forEach(_=>{try{const T=new Date(_.dateRaw?.replace(" ","T")).toLocaleDateString("en-US",{month:"short",year:"numeric"});k[T]=(k[T]||0)+(_.totalVolume||0)}catch{}});const P=Object.entries(k).sort((_,g)=>g[1]-_[1])[0],O={};if(o.forEach(_=>{const g=v(_),I=(g&&t?.get?.(g))?.genreCounts;let N=[];if(I&&I.size>0)N=Array.from(I.entries());else{const D=_.spotify?.genre;D&&D!=="unknown"&&(N=[[D,1]])}const W=N.filter(([D,j])=>D&&D!=="unknown"&&j>0),F=W.reduce((D,[,j])=>D+j,0);if(!(W.length===0||F<=0))for(const[D,j]of W){const H=j/F;O[D]||(O[D]={}),Object.entries(_.muscleTonnage||{}).forEach(([X,re])=>{const Y=X.replace(/left_|right_/,"");O[D][Y]=(O[D][Y]||0)+re*H})}}),t?.get&&Object.keys(p).length>0)for(const _ of Object.keys(O))(p[_]||0)<=1&&delete O[_];const B=Object.entries(O).map(([_,g])=>{const T=Object.entries(g).sort((I,N)=>N[1]-I[1]);return{genre:_,topMuscle:T[0]?.[0]||"N/A",volume:T[0]?.[1]||0,color:Te(_)}}).sort((_,g)=>(p[g.genre]||0)-(p[_.genre]||0)).slice(0,4);return{totalWorkouts:o.length,totalVolume:Math.round(s),totalExercises:a,weeks:u,topMuscle:d?.[0]||"N/A",topGenre:b?.[0]||"N/A",topGenreColor:b?Te(b[0]):f.color.accent,favoriteDay:R,genreTopMuscles:B,genreMuscleMap:O,genrePlayCounts:p,performanceGenre:A?.genre,performanceBoost:C,strongestMonth:P?.[0],strongestMonthVolume:P?.[1]||0}},[i,t]);return e?r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"28px"}},r.createElement("div",{style:{padding:"24px",background:"linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(59, 130, 246, 0.1))",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"16px",textAlign:"center"}},r.createElement("div",{style:{fontSize:"18px",fontWeight:700,color:f.color.textPrimary,marginBottom:"8px",letterSpacing:"-0.02em"}},"The Work You've Built"),r.createElement("div",{style:{fontSize:"13px",color:f.color.textSecondary,lineHeight:1.5}},"Your dedication, visualized in data")),r.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"}},r.createElement(ht,{value:e.totalWorkouts,label:"Workouts",color:f.color.accent}),r.createElement(ht,{value:`${(e.totalVolume/1e3).toFixed(1)}t`,label:"Volume",color:f.color.accentWarm}),r.createElement(ht,{value:e.topMuscle,label:"Top Focus",color:"#ef4444",isText:!0}),r.createElement(ht,{value:e.topGenre,label:"Top Genre",color:e.topGenreColor,isText:!0})),r.createElement("div",null,r.createElement(Ke,null,"Personal Insights"),r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"12px"}},e.performanceGenre&&e.performanceBoost>0&&r.createElement(It,{icon:"lightning",color:Te(e.performanceGenre),text:`You lift ${e.performanceBoost}% more when listening to ${e.performanceGenre}`}),e.strongestMonth&&r.createElement(It,{icon:"trophy",color:f.color.accentWarm,text:`${e.strongestMonth} was your strongest month with ${(e.strongestMonthVolume/1e3).toFixed(1)}t lifted`}),r.createElement(It,{icon:"calendar",color:f.color.accentSuccess,text:`You prefer training on ${e.favoriteDay}s`}))),e.genreMuscleMap&&Object.keys(e.genreMuscleMap).length>0&&r.createElement("div",null,r.createElement(Ke,null,"Music-Muscle Connection"),r.createElement("div",{style:{background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)",padding:"12px"}},r.createElement(cs,{genreMuscleData:e.genreMuscleMap,genrePlayCounts:e.genrePlayCounts}),r.createElement("div",{style:{fontSize:"10px",color:f.color.textTertiary,textAlign:"center",marginTop:"8px"}},"Hover to explore connections between genres and muscle groups"))),r.createElement("div",null,r.createElement(Ke,null,"Journey Analytics"),r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"20px"}},r.createElement("div",{style:{background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)",padding:"16px",maxWidth:"500px",margin:"0 auto",width:"100%"}},r.createElement("div",{style:{fontSize:"11px",fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",color:f.color.textSecondary,marginBottom:"12px",textAlign:"center"}},"Exercise Breakdown"),r.createElement(is,{checkpoints:i})),r.createElement("div",{style:{background:"rgba(255, 255, 255, 0.02)",borderRadius:f.radius.md,border:"1px solid rgba(255, 255, 255, 0.06)",padding:"16px",maxWidth:"600px",margin:"0 auto",width:"100%"}},r.createElement("div",{style:{fontSize:"11px",fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",color:f.color.textSecondary,marginBottom:"12px",textAlign:"center"}},"Volume Distribution"),r.createElement(ls,{checkpoints:i})))),r.createElement("div",{style:{padding:"12px",background:"rgba(255, 255, 255, 0.02)",border:`1px solid ${f.color.borderSubtle}`,borderRadius:f.radius.sm,textAlign:"center"}},r.createElement("div",{style:{fontSize:"10px",color:f.color.textTertiary}},"Use arrow keys to revisit your journey"))):null}function Dt({icon:i,title:n,description:t}){const e={scroll:r.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.createElement("line",{x1:"12",y1:"6",x2:"12",y2:"10"})),arrows:r.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 12h14M12 5l7 7-7 7"})),drag:r.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M12 2L12 22M2 12L22 12"}),r.createElement("circle",{cx:"12",cy:"12",r:"3"}))};return r.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",padding:"10px 12px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)",borderRadius:f.radius.sm}},r.createElement("div",{style:{color:f.color.accent,flexShrink:0,marginTop:"2px"}},e[i]),r.createElement("div",null,r.createElement("div",{style:{fontSize:"12px",fontWeight:500,color:f.color.textPrimary,marginBottom:"2px"}},n),r.createElement("div",{style:{fontSize:"11px",color:f.color.textTertiary}},t)))}function Ke({children:i}){return r.createElement("div",{style:{fontSize:"12px",fontWeight:700,letterSpacing:"0.12em",textTransform:"uppercase",color:f.color.textSecondary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`1px solid ${f.color.borderSubtle}`}},i)}const te={IDLE:"idle",WALK:"walk",CELEBRATION:"celebration"};function gs(i,{defaultState:n=te.IDLE,onStateChange:t}={}){const e=E.useRef({}),o=E.useRef(n),s=E.useRef(null),a=E.useRef({}),l=E.useCallback((y,M,v={})=>{if(!i)return null;const b=i.clipAction(M);return b.setLoop(v.loop!==!1?Ar:Rr,1/0),v.loop===!1&&(b.clampWhenFinished=!0),v.speed&&(b.timeScale=v.speed),e.current[y]={action:b,options:{blendDuration:v.blendDuration||.3,loop:v.loop!==!1,speed:v.speed||1,onComplete:v.onComplete||null}},a.current[y]=M,b},[i]),c=E.useCallback((y,M={})=>{if(!i)return;if(!e.current[y]){console.warn(`Animation state "${y}" not registered`);return}const v=o.current,b=e.current[v],h=e.current[y];if(!h)return;const x=M.blendDuration??h.options.blendDuration,A=h.action;if(!(v===y&&s.current===A&&A.isRunning())&&(A.reset(),A.setEffectiveTimeScale(h.options.speed),A.setEffectiveWeight(1),s.current&&b&&A.crossFadeFrom(s.current,x,!0),A.play(),o.current=y,s.current=A,t?.(y,v),!h.options.loop&&h.options.onComplete)){const C=A.getClip().duration;setTimeout(()=>{o.current===y&&c(h.options.onComplete)},(C-x)*1e3)}},[i,t]),u=E.useCallback(()=>o.current,[]),m=E.useCallback(y=>o.current===y,[]),d=E.useCallback(()=>{i&&(i.stopAllAction(),s.current=null)},[i]),p=E.useCallback(()=>Object.keys(e.current),[]);return{registerClip:l,transitionTo:c,getCurrentState:u,isInState:m,stopAll:d,getRegisteredStates:p,actionsRef:e,currentStateRef:o}}function ys({mixer:i,embeddedClips:n=[],isMoving:t=!1,triggerCelebration:e=null,onCelebrationComplete:o,onReady:s,currentCheckpointId:a=null,selectedExercise:l=null,isPaused:c=!1}){const[u,m]=E.useState(!1),d=E.useRef(null),p=E.useRef(!1),y=E.useRef(null),M=E.useRef(null),v=E.useRef(null),b=E.useRef(c),{registerClip:h,transitionTo:x,isInState:A,actionsRef:C}=gs(i,{defaultState:te.IDLE,onStateChange:(S,L)=>{console.log(`Animation: ${L} -> ${S}`),L===te.CELEBRATION&&S===te.IDLE&&o?.()}});return E.useEffect(()=>{if(i)if(b.current=c,c)i.timeScale=0;else{i.timeScale=1;const S=a!=null,L=M.current===a;S&&L&&C.current[te.CELEBRATION]&&(A(te.CELEBRATION)||x(te.CELEBRATION))}},[i,c,C,x,t,a,A]),E.useEffect(()=>{ts().catch(console.warn)},[]),E.useEffect(()=>{if(!i||a===null||a===void 0)return;(async()=>{let L=null;const R=l?.animationFile!=null||l?.name!=null;if(l?.name&&(L=l.name,console.log(`[Animation] Loading user-selected exercise: ${L}`)),!L){M.current=null;return}const k=R&&v.current!==L;if(y.current===L&&!k){M.current=a;return}R&&(v.current=L);const P=es(L);let O=null;console.log(`[Animation] Loading for exercise: "${L}" -> embedded clip name: "${P}"`),console.log(`[Animation] Available embedded clips: ${n.length}`),P&&n.length>0&&(O=n.find(B=>B.name.toLowerCase()===P.toLowerCase()||B.name.toLowerCase().includes(P.toLowerCase())),console.log(O?`[Animation] Found embedded clip: ${O.name} for exercise: ${L}`:`[Animation] No matching embedded clip found for "${P}"`)),O?(h(te.CELEBRATION,O,{loop:!0,blendDuration:.4}),y.current=L,M.current=a,console.log(`[Animation] Loaded exercise animation: ${L}`),t||x(te.CELEBRATION)):k&&!t&&x(te.CELEBRATION)})()},[i,a,l,n,h,t,x]),E.useEffect(()=>{if(i&&!p.current){if(n.length>0){if(p.current=!0,console.log("[Animation] Using embedded clips from model:"),n.forEach((S,L)=>{const R=S.name.toLowerCase();console.log(`  - ${S.name}`),(R.includes("t-pose")||R.includes("tpose")||R.includes("idle")||R.includes("stand"))&&(h(te.IDLE,S,{loop:!0,blendDuration:.3}),console.log(`[Animation] Registered "${S.name}" as IDLE`)),(R.includes("walk")||R==="run"||R.includes("locomotion")||R.includes("running"))&&(h(te.WALK,S,{loop:!0,blendDuration:.2}),console.log(`[Animation] Registered "${S.name}" as WALK`)),(R.includes("victory")||R.includes("celebrate")||R.includes("cheer")||R.includes("dance"))&&(h(te.CELEBRATION,S,{loop:!0,blendDuration:.4}),console.log(`[Animation] Registered "${S.name}" as CELEBRATION`))}),!C.current[te.IDLE]){const S=n.find(L=>L.name.toLowerCase().includes("t-pose")||L.name.toLowerCase().includes("tpose"));S?(h(te.IDLE,S,{loop:!0,blendDuration:.3}),console.log(`[Animation] Registered "${S.name}" as IDLE (fallback)`)):n.length>0&&(h(te.IDLE,n[0],{loop:!0,blendDuration:.3}),console.log(`[Animation] Registered "${n[0].name}" as IDLE (first clip)`))}!C.current[te.WALK]&&C.current[te.IDLE]&&console.log("[Animation] No walk animation, using IDLE for WALK state"),C.current[te.IDLE]&&x(te.IDLE),m(!0),s?.();return}p.current=!0,console.warn("[Animation] No embedded clips found in character model. Character requires animations baked in."),m(!0),s?.()}},[i,n,h,x,C,s]),E.useEffect(()=>{if(u&&!b.current){if(t&&C.current[te.WALK])x(te.WALK);else if(!t){const S=a!=null,L=M.current===a;S&&L&&C.current[te.CELEBRATION]?x(te.CELEBRATION):C.current[te.IDLE]&&x(te.IDLE)}}},[t,u,a,x,C]),E.useEffect(()=>{u&&e&&d.current!==e&&C.current[te.CELEBRATION]&&(d.current=e,x(te.CELEBRATION))},[e,u,x,C]),tt((S,L)=>{i&&i.update(L)}),null}const xs={back:["back"],calf_L:["left_calf"],calf_R:["right_calf"],chest:["chest_left","chest_right"],core:["abs_upper","abs_lower"],lower_arm_L:["left_forearm"],lower_arm_R:["right_forearm"],quad_L:["left_quad","left_glute"],quad_R:["right_quad","right_glute"],shoulder_L:["left_shoulder"],shoulder_R:["right_shoulder"],upper_arm_L:["left_bicep"],upper_arm_R:["right_bicep"],skin:["skin"]},Ot=[.6,.3,.5];function fn(i,n,t){const e=new Me;return e.setHSL(i,n,t),e}const bs=E.forwardRef(function({onHoverMuscle:n,isMoving:t=!1,triggerCelebration:e=null,onCelebrationComplete:o,onAnimationReady:s,showMuscles:a=!0,muscleOpacities:l=null,muscleGenres:c=null,muscleTonnage:u=null,currentCheckpointId:m=null,selectedExercise:d=null,isAnimationPaused:p=!1,...y},M){const v=bn(In,"./models/character_animated.glb"),b=E.useRef(),h=E.useRef(),[x,A]=E.useState(!1),[C,S]=E.useState(!1),L=E.useRef({}),R=E.useRef([]);E.useImperativeHandle(M,()=>b.current,[]),E.useEffect(()=>{const{scene:O,animations:B}=v,_={};console.log("Character: Scanning meshes..."),O.traverse(T=>{if(T.isMesh){const I=T.material?.name||"",N=T.name||"",W=I||N;console.log(`  Mesh: "${N}" | Material: "${I}"`);const F=xs[W];if(F&&!F.includes("skin")){const D=fn(Ot[0],Ot[1],Ot[2]),j=new ke({color:D,emissive:D.clone().multiplyScalar(.3),emissiveIntensity:.8,transparent:!0,opacity:.9,roughness:.25,metalness:.7,reflectivity:.5,clearcoat:.2,clearcoatRoughness:.3,envMapIntensity:.8,side:Ue,depthTest:!0,depthWrite:!0});T.material&&T.material.dispose&&T.material.dispose(),T.material=j,T.material.needsUpdate=!0,T.castShadow=!1,T.receiveShadow=!0,T.renderOrder=1,T.userData.muscleIds=F,T.userData.materialName=W,_[W]={mesh:T,material:T.material,muscleIds:F},console.log(`Character: muscle mesh "${W}" -> [${F.join(", ")}]`)}else F&&F.includes("skin")?(T.material=new ke({color:new Me(13162751),metalness:.1,roughness:.05,clearcoat:1,clearcoatRoughness:.03,sheen:.5,sheenRoughness:.2,sheenColor:new Me(8965375),transparent:!0,opacity:.35,side:Ue,depthWrite:!1,depthTest:!0,envMapIntensity:1.5}),T.castShadow=!1,T.receiveShadow=!0,T.renderOrder=10,console.log("Character: found skin mesh - applied glass material")):(T.material=new ke({color:new Me(15791359),transmission:.9,thickness:.8,roughness:.05,metalness:0,ior:1.45,transparent:!0,opacity:.2,side:Ue,depthWrite:!0,depthTest:!0}),T.castShadow=!1,T.receiveShadow=!0,T.renderOrder=1,console.log(`Character: unknown mesh "${T.name}" with material "${I}" - applied glass`))}}),L.current=_,Object.keys(_).length===0?(console.warn("Character: No muscle meshes found! Model may not have separate muscle materials."),console.warn("Character: Expected material names: chest, back, core, quad_L, quad_R, etc."),console.warn("Character: Found materials:",O.children.map(T=>T.material?.name).filter(Boolean))):console.log(`Character: found ${Object.keys(_).length} muscle meshes`);const g=O.getObjectByName("rig001")||O.getObjectByName("Armature")||O;return h.current=new Cr(g),B&&B.length>0&&(console.log(`Character: found ${B.length} embedded animations`),B.forEach(T=>{console.log(`  - ${T.name} (${T.duration.toFixed(2)}s)`)}),R.current=B),S(!0),console.log(`Character: mixer ready (root="${g.name}")`),()=>{h.current?.stopAllAction(),S(!1)}},[v]);const k=E.useCallback(O=>{if(!n)return;let B=null;if(O.intersections&&O.intersections.length>0)for(const _ of O.intersections){const g=_.object,T=g?.userData?.muscleIds;if(T&&T.length>0&&!T.includes("skin")){B={object:g,muscleIds:T,materialName:g.userData.materialName};break}}if(B){const{muscleIds:_,materialName:g}=B,T=_[0],I=c?.[T]||null;let N=0;if(u)for(const W of _)N+=u[W]||0;n({id:g.replace(/_L$|_R$/,"").replace("_"," "),muscleIds:_,genre:I!=="none"?I:null,tonnage:N,x:O.pointer.x*window.innerWidth/2+window.innerWidth/2,y:-O.pointer.y*window.innerHeight/2+window.innerHeight/2})}else n(null)},[n,c,u]),P=E.useCallback(()=>{n&&n(null)},[n]);return tt(()=>{if(!a){Object.values(L.current).forEach(({mesh:O})=>{O.visible=!1});return}Object.entries(L.current).forEach(([O,{mesh:B,material:_,muscleIds:g}])=>{if(!_)return;let T=0,I=!1;if(l!==null){for(const F of g){const D=l[F];D!==void 0&&D>0&&(T=Math.max(T,D),I=!0)}I?T=.3+T*.7:T=.25,B.visible=!0}else B.visible=!0,T=.85;let N=null,W=!1;if(c!==null){for(const F of g)if(c[F]&&c[F]!=="none"){const D=Pn(c[F]);N=fn(D[0],D[1],D[2]),W=!0;break}}if(!W){B.visible=!1;return}B.visible=!0,_.color.copy(N),_.emissive.copy(N).multiplyScalar(.4+T*.3),_.emissiveIntensity=1+T*.8,_.opacity=T})}),r.createElement("group",{ref:b,...y},r.createElement("primitive",{object:v.scene,onPointerMove:k,onPointerOut:P}),C&&h.current&&r.createElement(ys,{mixer:h.current,embeddedClips:R.current,isMoving:t,triggerCelebration:e,onCelebrationComplete:o,currentCheckpointId:m,selectedExercise:d,isPaused:p,onReady:()=>{A(!0),s?.()}}))});function Es(i=null){const n=[{x:0,z:15},{x:-4,z:-10},{x:0,z:-35},{x:5,z:-65},{x:0,z:-95},{x:-5,z:-125},{x:0,z:-155},{x:4,z:-185},{x:0,z:-210}];if(i&&i.length>0){const o=Math.max(n.length,i.length*2),s=[];for(let l=0;l<o;l++){const c=l/(o-1),u=c*(n.length-1),m=Math.floor(u),d=Math.min(m+1,n.length-1),p=u-m,y=n[m].x+(n[d].x-n[m].x)*p,M=n[m].z+(n[d].z-n[m].z)*p,v=Bn(i,c);s.push(new oe(y,v,M))}return new tn(s,!1,"catmullrom",.5)}const t=n.map(o=>new oe(o.x,0,o.z));return new tn(t,!1,"catmullrom",.5)}function yt(i,n,t=0){const e=Math.max(0,Math.min(1,n)),o=i.getPointAt(e);t!==0&&(o.y+=t);const s=i.getTangentAt(e),a=o.clone().add(s);return{position:o,tangent:s,lookAt:a}}function ws(i,n,t=.025){let e=null,o=1/0;for(const s of i){const a=Math.abs(s.position-n);a<o&&(o=a,e=s)}return{checkpoint:e,distance:o,shouldSnap:o<=t}}function Bn(i,n){let t=i[0],e=i[i.length-1];for(let l=0;l<i.length-1;l++)if(n>=i[l].position&&n<=i[l+1].position){t=i[l],e=i[l+1];break}if(n<=t.position)return t.elevation;if(n>=e.position)return e.elevation;const o=e.position-t.position,s=(n-t.position)/o,a=s*s*(3-2*s);return t.elevation+(e.elevation-t.elevation)*a}const vs=[{id:0,position:0,elevation:0,label:"Start",celebration:null},{id:1,position:.2,elevation:.3,label:"Checkpoint 1",celebration:"celebration"},{id:2,position:.4,elevation:-.1,label:"Checkpoint 2",celebration:"celebration"},{id:3,position:.6,elevation:.5,label:"Checkpoint 3",celebration:"celebration"},{id:4,position:.8,elevation:.2,label:"Checkpoint 4",celebration:"celebration"},{id:5,position:1,elevation:0,label:"Finish",celebration:"celebration"}],ks=.02,Ms={checkpoints:vs,snapThreshold:ks};function hn({text:i,position:n,fontSize:t=.6,color:e="#60a5fa",align:o="left"}){const s=E.useRef();vt();const a=E.useMemo(()=>{const u=document.createElement("canvas"),m=u.getContext("2d"),d=4,p=t*100*d;u.width=512*d,u.height=64*d,m.clearRect(0,0,u.width,u.height),m.font=`bold ${p}px system-ui, -apple-system, sans-serif`,m.fillStyle=e,m.textAlign=o,m.textBaseline="middle";const y=o==="left"?10:o==="right"?u.width-10:u.width/2;m.fillText(i,y,u.height/2);const M=new An(u);return M.minFilter=Et,M.magFilter=Et,M},[i,t,e,o]),l=t*8,c=t*1;return r.createElement("mesh",{ref:s,position:n,rotation:[-Math.PI/2,0,0]},r.createElement("planeGeometry",{args:[l,c]}),r.createElement("meshBasicMaterial",{map:a,transparent:!0,opacity:.9,depthWrite:!1,side:Ue}))}function Ts({checkpoints:i,curve:n}){const t=E.useMemo(()=>{if(!i||i.length<2||!n)return[];const e=i.filter(u=>!u.isStart&&u.dateRaw).sort((u,m)=>{const d=new Date(u.dateRaw.replace(" ","T")),p=new Date(m.dateRaw.replace(" ","T"));return d-p});if(e.length===0)return[];const o=new Date(e[0].dateRaw.replace(" ","T")),s=u=>{const m=new Date(u),d=m.getDay(),p=m.getDate()-d+(d===0?-6:1);return m.setDate(p),m.setHours(0,0,0,0),m},a=s(o),l=new Set,c=[];return e.forEach((u,m)=>{const d=new Date(u.dateRaw.replace(" ","T")),p=s(d),y=Math.floor((p-a)/(7*24*60*60*1e3))+1;if(!l.has(y)){l.add(y);const{position:M}=yt(n,u.position);c.push({weekNumber:y,position:u.position,worldPosition:M,date:p.toLocaleDateString("en-US",{month:"short",day:"numeric"}),checkpointId:u.id})}}),c},[i,n]);return t.length===0?null:r.createElement("group",null,t.map(e=>{const o=e.worldPosition.z;return r.createElement("group",{key:`week-${e.weekNumber}`,position:[0,.01,o]},r.createElement("mesh",{rotation:[-Math.PI/2,0,0]},r.createElement("planeGeometry",{args:[15,.06]}),r.createElement("meshBasicMaterial",{color:"#3b82f6",transparent:!0,opacity:.5,blending:Gt,depthWrite:!1})),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.005,0]},r.createElement("planeGeometry",{args:[15,.25]}),r.createElement("meshBasicMaterial",{color:"#3b82f6",transparent:!0,opacity:.12,blending:Gt,depthWrite:!1})),r.createElement(hn,{text:`WEEK ${e.weekNumber}`,position:[-5.5,.02,0],fontSize:.6,color:"#60a5fa",align:"left"}),r.createElement(hn,{text:e.date,position:[5.5,.02,0],fontSize:.4,color:"#94a3b8",align:"right"}))}))}function Ss({characterRef:i,progress:n=0,onCheckpointReached:t,onMovementStateChange:e,debugPath:o=!1,checkpointsOverride:s=null}){const a=E.useRef(null),l=E.useRef(n),c=E.useRef(!1),u=s||Ms,m=u.checkpoints||[],d=u.snapThreshold||.02,p=E.useMemo(()=>Es(m),[m]),y=E.useMemo(()=>p?new Lr(p,200,.08,8,!1):null,[p]),M=E.useMemo(()=>m.map((v,b)=>{const{position:h}=yt(p,v.position),x=v.muscleVolumes||{},A=Object.values(x),C=A.length>0?A.reduce((k,P)=>k+P,0)/A.length:.3,S=v.spotify?.genre,L=S&&S!=="unknown",R=L?Te(S):"#505560";return{...v,worldPosition:h,scale:.15+C*.2,isFirst:b===0,isLast:b===m.length-1,genreColor:R,hasGenre:L}}),[m,p]);return tt(()=>{if(!i?.current)return;const{position:v}=yt(p,n);i.current.position.copy(v),i.current.rotation.y=3;const h=Math.abs(n-l.current)>1e-4;h!==c.current&&(c.current=h,e?.(h));const{checkpoint:x,distance:A}=ws(m,n,d);x&&A<.015&&x.id!==a.current&&(a.current=x.id,t?.(x)),x&&A>.04&&(a.current=null),l.current=n}),E.useCallback(v=>{const b=Bn(m,v);return yt(p,v,b)},[p,m]),r.createElement(r.Fragment,null,o&&y&&r.createElement("group",null,r.createElement("mesh",{geometry:y},r.createElement("meshBasicMaterial",{color:"#2a5080",transparent:!0,opacity:.5})),M.map(v=>{const b=v.isFirst?"#4ade80":v.isLast?"#f87171":v.genreColor,h=v.hasGenre?1:.5,x=.25+v.scale*.3;return r.createElement("group",{key:v.id,position:v.worldPosition},r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.03,0]},r.createElement("circleGeometry",{args:[x,24]}),r.createElement("meshPhysicalMaterial",{color:b,emissive:b,emissiveIntensity:.4*h,metalness:.8,roughness:.2,reflectivity:.5,clearcoat:.3,clearcoatRoughness:.4,transparent:!0,opacity:.85,side:Ue})),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.025,0]},r.createElement("ringGeometry",{args:[x,x+.08,24]}),r.createElement("meshPhysicalMaterial",{color:b,emissive:b,emissiveIntensity:.6*h,metalness:.9,roughness:.15,transparent:!0,opacity:.7,side:Ue})),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0]},r.createElement("circleGeometry",{args:[x+.15,16]}),r.createElement("meshBasicMaterial",{color:b,transparent:!0,opacity:.2*h,blending:Gt,depthWrite:!1})))}),r.createElement(Ts,{checkpoints:m,curve:p})))}const gn={type:"change"},Nt={type:"start"},yn={type:"end"},gt=new _r,xn=new Pr,As=Math.cos(70*Tn.DEG2RAD);class Rs extends Ir{constructor(n,t){super(),this.object=n,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new oe,this.cursor=new oe,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Qe.ROTATE,MIDDLE:Qe.DOLLY,RIGHT:Qe.PAN},this.touches={ONE:Je.ROTATE,TWO:Je.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(w){w.addEventListener("keydown",Xe),this._domElementKeyEvents=w},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Xe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(gn),e.update(),s=o.NONE},this.update=function(){const w=new oe,z=new xt().setFromUnitVectors(n.up,new oe(0,1,0)),V=z.clone().invert(),ee=new oe,de=new xt,Le=new oe,me=2*Math.PI;return function($=null){const U=e.object.position;w.copy(U).sub(e.target),w.applyQuaternion(z),l.setFromVector3(w),e.autoRotate&&s===o.NONE&&_(O($)),e.enableDamping?(l.theta+=c.theta*e.dampingFactor,l.phi+=c.phi*e.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let Z=e.minAzimuthAngle,Q=e.maxAzimuthAngle;isFinite(Z)&&isFinite(Q)&&(Z<-Math.PI?Z+=me:Z>Math.PI&&(Z-=me),Q<-Math.PI?Q+=me:Q>Math.PI&&(Q-=me),Z<=Q?l.theta=Math.max(Z,Math.min(Q,l.theta)):l.theta=l.theta>(Z+Q)/2?Math.max(Z,l.theta):Math.min(Q,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(m,e.dampingFactor):e.target.add(m),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let pe=!1;if(e.zoomToCursor&&L||e.object.isOrthographicCamera)l.radius=j(l.radius);else{const ce=l.radius;l.radius=j(l.radius*u),pe=ce!=l.radius}if(w.setFromSpherical(l),w.applyQuaternion(V),U.copy(e.target).add(w),e.object.lookAt(e.target),e.enableDamping===!0?(c.theta*=1-e.dampingFactor,c.phi*=1-e.dampingFactor,m.multiplyScalar(1-e.dampingFactor)):(c.set(0,0,0),m.set(0,0,0)),e.zoomToCursor&&L){let ce=null;if(e.object.isPerspectiveCamera){const Ne=w.length();ce=j(Ne*u);const Ze=Ne-ce;e.object.position.addScaledVector(C,Ze),e.object.updateMatrixWorld(),pe=!!Ze}else if(e.object.isOrthographicCamera){const Ne=new oe(S.x,S.y,0);Ne.unproject(e.object);const Ze=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/u)),e.object.updateProjectionMatrix(),pe=Ze!==e.object.zoom;const pt=new oe(S.x,S.y,0);pt.unproject(e.object),e.object.position.sub(pt).add(Ne),e.object.updateMatrixWorld(),ce=w.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ce!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ce).add(e.object.position):(gt.origin.copy(e.object.position),gt.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(gt.direction))<As?n.lookAt(e.target):(xn.setFromNormalAndCoplanarPoint(e.object.up,e.target),gt.intersectPlane(xn,e.target))))}else if(e.object.isOrthographicCamera){const ce=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/u)),ce!==e.object.zoom&&(e.object.updateProjectionMatrix(),pe=!0)}return u=1,L=!1,pe||ee.distanceToSquared(e.object.position)>a||8*(1-de.dot(e.object.quaternion))>a||Le.distanceToSquared(e.target)>a?(e.dispatchEvent(gn),ee.copy(e.object.position),de.copy(e.object.quaternion),Le.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",De),e.domElement.removeEventListener("pointerdown",se),e.domElement.removeEventListener("pointercancel",he),e.domElement.removeEventListener("wheel",it),e.domElement.removeEventListener("pointermove",we),e.domElement.removeEventListener("pointerup",he),e.domElement.getRootNode().removeEventListener("keydown",Ye,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Xe),e._domElementKeyEvents=null)};const e=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const a=1e-6,l=new nn,c=new nn;let u=1;const m=new oe,d=new Ee,p=new Ee,y=new Ee,M=new Ee,v=new Ee,b=new Ee,h=new Ee,x=new Ee,A=new Ee,C=new oe,S=new Ee;let L=!1;const R=[],k={};let P=!1;function O(w){return w!==null?2*Math.PI/60*e.autoRotateSpeed*w:2*Math.PI/60/60*e.autoRotateSpeed}function B(w){const z=Math.abs(w*.01);return Math.pow(.95,e.zoomSpeed*z)}function _(w){c.theta-=w}function g(w){c.phi-=w}const T=function(){const w=new oe;return function(V,ee){w.setFromMatrixColumn(ee,0),w.multiplyScalar(-V),m.add(w)}}(),I=function(){const w=new oe;return function(V,ee){e.screenSpacePanning===!0?w.setFromMatrixColumn(ee,1):(w.setFromMatrixColumn(ee,0),w.crossVectors(e.object.up,w)),w.multiplyScalar(V),m.add(w)}}(),N=function(){const w=new oe;return function(V,ee){const de=e.domElement;if(e.object.isPerspectiveCamera){const Le=e.object.position;w.copy(Le).sub(e.target);let me=w.length();me*=Math.tan(e.object.fov/2*Math.PI/180),T(2*V*me/de.clientHeight,e.object.matrix),I(2*ee*me/de.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(T(V*(e.object.right-e.object.left)/e.object.zoom/de.clientWidth,e.object.matrix),I(ee*(e.object.top-e.object.bottom)/e.object.zoom/de.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function W(w){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?u/=w:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function F(w){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?u*=w:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function D(w,z){if(!e.zoomToCursor)return;L=!0;const V=e.domElement.getBoundingClientRect(),ee=w-V.left,de=z-V.top,Le=V.width,me=V.height;S.x=ee/Le*2-1,S.y=-(de/me)*2+1,C.set(S.x,S.y,1).unproject(e.object).sub(e.object.position).normalize()}function j(w){return Math.max(e.minDistance,Math.min(e.maxDistance,w))}function H(w){d.set(w.clientX,w.clientY)}function X(w){D(w.clientX,w.clientX),h.set(w.clientX,w.clientY)}function re(w){M.set(w.clientX,w.clientY)}function Y(w){p.set(w.clientX,w.clientY),y.subVectors(p,d).multiplyScalar(e.rotateSpeed);const z=e.domElement;_(2*Math.PI*y.x/z.clientHeight),g(2*Math.PI*y.y/z.clientHeight),d.copy(p),e.update()}function q(w){x.set(w.clientX,w.clientY),A.subVectors(x,h),A.y>0?W(B(A.y)):A.y<0&&F(B(A.y)),h.copy(x),e.update()}function ne(w){v.set(w.clientX,w.clientY),b.subVectors(v,M).multiplyScalar(e.panSpeed),N(b.x,b.y),M.copy(v),e.update()}function ie(w){D(w.clientX,w.clientY),w.deltaY<0?F(B(w.deltaY)):w.deltaY>0&&W(B(w.deltaY)),e.update()}function fe(w){let z=!1;switch(w.code){case e.keys.UP:w.ctrlKey||w.metaKey||w.shiftKey?g(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):N(0,e.keyPanSpeed),z=!0;break;case e.keys.BOTTOM:w.ctrlKey||w.metaKey||w.shiftKey?g(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):N(0,-e.keyPanSpeed),z=!0;break;case e.keys.LEFT:w.ctrlKey||w.metaKey||w.shiftKey?_(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):N(e.keyPanSpeed,0),z=!0;break;case e.keys.RIGHT:w.ctrlKey||w.metaKey||w.shiftKey?_(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):N(-e.keyPanSpeed,0),z=!0;break}z&&(w.preventDefault(),e.update())}function ye(w){if(R.length===1)d.set(w.pageX,w.pageY);else{const z=Oe(w),V=.5*(w.pageX+z.x),ee=.5*(w.pageY+z.y);d.set(V,ee)}}function G(w){if(R.length===1)M.set(w.pageX,w.pageY);else{const z=Oe(w),V=.5*(w.pageX+z.x),ee=.5*(w.pageY+z.y);M.set(V,ee)}}function J(w){const z=Oe(w),V=w.pageX-z.x,ee=w.pageY-z.y,de=Math.sqrt(V*V+ee*ee);h.set(0,de)}function xe(w){e.enableZoom&&J(w),e.enablePan&&G(w)}function Ae(w){e.enableZoom&&J(w),e.enableRotate&&ye(w)}function Re(w){if(R.length==1)p.set(w.pageX,w.pageY);else{const V=Oe(w),ee=.5*(w.pageX+V.x),de=.5*(w.pageY+V.y);p.set(ee,de)}y.subVectors(p,d).multiplyScalar(e.rotateSpeed);const z=e.domElement;_(2*Math.PI*y.x/z.clientHeight),g(2*Math.PI*y.y/z.clientHeight),d.copy(p)}function ze(w){if(R.length===1)v.set(w.pageX,w.pageY);else{const z=Oe(w),V=.5*(w.pageX+z.x),ee=.5*(w.pageY+z.y);v.set(V,ee)}b.subVectors(v,M).multiplyScalar(e.panSpeed),N(b.x,b.y),M.copy(v)}function ue(w){const z=Oe(w),V=w.pageX-z.x,ee=w.pageY-z.y,de=Math.sqrt(V*V+ee*ee);x.set(0,de),A.set(0,Math.pow(x.y/h.y,e.zoomSpeed)),W(A.y),h.copy(x);const Le=(w.pageX+z.x)*.5,me=(w.pageY+z.y)*.5;D(Le,me)}function Se(w){e.enableZoom&&ue(w),e.enablePan&&ze(w)}function Ie(w){e.enableZoom&&ue(w),e.enableRotate&&Re(w)}function se(w){e.enabled!==!1&&(R.length===0&&(e.domElement.setPointerCapture(w.pointerId),e.domElement.addEventListener("pointermove",we),e.domElement.addEventListener("pointerup",he)),!ae(w)&&(ct(w),w.pointerType==="touch"?lt(w):le(w)))}function we(w){e.enabled!==!1&&(w.pointerType==="touch"?Ge(w):Ce(w))}function he(w){switch(ut(w),R.length){case 0:e.domElement.releasePointerCapture(w.pointerId),e.domElement.removeEventListener("pointermove",we),e.domElement.removeEventListener("pointerup",he),e.dispatchEvent(yn),s=o.NONE;break;case 1:const z=R[0],V=k[z];lt({pointerId:z,pageX:V.x,pageY:V.y});break}}function le(w){let z;switch(w.button){case 0:z=e.mouseButtons.LEFT;break;case 1:z=e.mouseButtons.MIDDLE;break;case 2:z=e.mouseButtons.RIGHT;break;default:z=-1}switch(z){case Qe.DOLLY:if(e.enableZoom===!1)return;X(w),s=o.DOLLY;break;case Qe.ROTATE:if(w.ctrlKey||w.metaKey||w.shiftKey){if(e.enablePan===!1)return;re(w),s=o.PAN}else{if(e.enableRotate===!1)return;H(w),s=o.ROTATE}break;case Qe.PAN:if(w.ctrlKey||w.metaKey||w.shiftKey){if(e.enableRotate===!1)return;H(w),s=o.ROTATE}else{if(e.enablePan===!1)return;re(w),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Nt)}function Ce(w){switch(s){case o.ROTATE:if(e.enableRotate===!1)return;Y(w);break;case o.DOLLY:if(e.enableZoom===!1)return;q(w);break;case o.PAN:if(e.enablePan===!1)return;ne(w);break}}function it(w){e.enabled===!1||e.enableZoom===!1||s!==o.NONE||(w.preventDefault(),e.dispatchEvent(Nt),ie(kt(w)),e.dispatchEvent(yn))}function kt(w){const z=w.deltaMode,V={clientX:w.clientX,clientY:w.clientY,deltaY:w.deltaY};switch(z){case 1:V.deltaY*=16;break;case 2:V.deltaY*=100;break}return w.ctrlKey&&!P&&(V.deltaY*=10),V}function Ye(w){w.key==="Control"&&(P=!0,e.domElement.getRootNode().addEventListener("keyup",qe,{passive:!0,capture:!0}))}function qe(w){w.key==="Control"&&(P=!1,e.domElement.getRootNode().removeEventListener("keyup",qe,{passive:!0,capture:!0}))}function Xe(w){e.enabled===!1||e.enablePan===!1||fe(w)}function lt(w){switch(dt(w),R.length){case 1:switch(e.touches.ONE){case Je.ROTATE:if(e.enableRotate===!1)return;ye(w),s=o.TOUCH_ROTATE;break;case Je.PAN:if(e.enablePan===!1)return;G(w),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(e.touches.TWO){case Je.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;xe(w),s=o.TOUCH_DOLLY_PAN;break;case Je.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ae(w),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Nt)}function Ge(w){switch(dt(w),s){case o.TOUCH_ROTATE:if(e.enableRotate===!1)return;Re(w),e.update();break;case o.TOUCH_PAN:if(e.enablePan===!1)return;ze(w),e.update();break;case o.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Se(w),e.update();break;case o.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ie(w),e.update();break;default:s=o.NONE}}function De(w){e.enabled!==!1&&w.preventDefault()}function ct(w){R.push(w.pointerId)}function ut(w){delete k[w.pointerId];for(let z=0;z<R.length;z++)if(R[z]==w.pointerId){R.splice(z,1);return}}function ae(w){for(let z=0;z<R.length;z++)if(R[z]==w.pointerId)return!0;return!1}function dt(w){let z=k[w.pointerId];z===void 0&&(z=new Ee,k[w.pointerId]=z),z.set(w.pageX,w.pageY)}function Oe(w){const z=w.pointerId===R[0]?R[1]:R[0];return k[z]}e.domElement.addEventListener("contextmenu",De),e.domElement.addEventListener("pointerdown",se),e.domElement.addEventListener("pointercancel",he),e.domElement.addEventListener("wheel",it,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Ye,{passive:!0,capture:!0}),this.update()}}Gn({OrbitControls:Rs});const Wn={FOLLOW:"follow"};function Cs({targetRef:i,mode:n=Wn.FOLLOW,config:t={},zoom:e=.5}){const{camera:o,gl:s}=vt(),a=E.useRef(),{distance:l=4,height:c=1.5,followSpeed:u=.08,lookAtOffset:m=[0,.8,0],minDistance:d=6,maxDistance:p=25,enableDamping:y=!0,dampingFactor:M=.05,minPolarAngle:v=Math.PI*.15,maxPolarAngle:b=Math.PI*.65,minCameraY:h=.5}=t,x=E.useRef(new oe),A=E.useRef(new oe),C=E.useRef(!1);E.useEffect(()=>{if(!a.current)return;const L=a.current;if(L.enableDamping=y,L.dampingFactor=M,L.minDistance=d,L.maxDistance=p,L.minPolarAngle=v,L.maxPolarAngle=b,L.enablePan=!1,L.enableZoom=!1,i?.current&&!C.current){const R=i.current.position.clone(),k=R.clone().add(new oe(...m));o.position.set(R.x,R.y+c,R.z+l),L.target.copy(k),x.current.copy(k),A.current.copy(k),L.update(),C.current=!0}},[i,o,l,c,m,y,M,d,p,v,b]);const S=E.useRef(l);return tt(()=>{if(!i?.current||!a.current)return;const L=a.current,k=i.current.position.clone().add(new oe(...m)),P=p-e*(p-d);S.current+=(P-S.current)*.08;const O=k.clone().sub(A.current);o.position.add(O.clone().multiplyScalar(u));const B=o.position.clone().sub(L.target),_=B.length();if(_>.01){const g=S.current/_,T=L.target.clone().add(B.multiplyScalar(g));o.position.lerp(T,.08)}o.position.y<h&&(o.position.y=h),x.current.lerp(k,u),L.target.copy(x.current),A.current.lerp(k,u),L.update(),o.position.y<h&&(o.position.y=h)}),r.createElement("orbitControls",{ref:a,args:[o,s.domElement]})}function Ls(){const i=E.useRef(),{positions:n,sizes:t}=E.useMemo(()=>{const o=new Float32Array(2400),s=new Float32Array(800);for(let a=0;a<800;a++){const l=Math.random()*Math.PI*2,c=Math.random()*Math.PI*.4+.1,u=200+Math.random()*100;o[a*3]=Math.sin(c)*Math.cos(l)*u,o[a*3+1]=Math.cos(c)*u+20,o[a*3+2]=Math.sin(c)*Math.sin(l)*u-100,s[a]=.3+Math.random()*.7}return{positions:o,sizes:s}},[]);return tt(e=>{if(i.current){const o=e.clock.elapsedTime,s=i.current.geometry.attributes.size.array;for(let a=0;a<s.length;a++){const l=Math.sin(o*2+a*.1)*.15+.85;s[a]=(.3+a%10*.07)*l}i.current.geometry.attributes.size.needsUpdate=!0}}),r.createElement("points",{ref:i},r.createElement("bufferGeometry",null,r.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/3,array:n,itemSize:3}),r.createElement("bufferAttribute",{attach:"attributes-size",count:t.length,array:t,itemSize:1})),r.createElement("pointsMaterial",{size:1.5,sizeAttenuation:!0,color:"#ffffff",transparent:!0,opacity:.8,fog:!1}))}function _s({timeOfDay:i}){const{scene:n}=vt(),t=i?.hour??12,e={morning:{top:"#1e3a5f",bottom:"#f4d9c0",ambient:.6,sun:.9,sunPos:[3,4,2],sunColor:"#ffd89b",rimColor:"#ffb347"},afternoon:{top:"#0f2744",bottom:"#1e3a5f",ambient:.7,sun:1,sunPos:[5,6,3],sunColor:"#ffffff",rimColor:"#60a5fa"},evening:{top:"#1a1025",bottom:"#4a2040",ambient:.4,sun:.5,sunPos:[8,2,1],sunColor:"#ff6b35",rimColor:"#a855f7"},night:{top:"#05080f",bottom:"#0f1724",ambient:.2,sun:.1,sunPos:[0,-2,3],sunColor:"#4a5568",rimColor:"#38bdf8"}},o=e[i?.period]||e.afternoon,s=(m,d)=>{let p;d?(p=(m-6)/12*Math.PI,(m<6||m>=18)&&(p=-.5)):(p=(m+6)%24/12*Math.PI,m>=6&&m<18&&(p=-.5));const y=50,M=Math.cos(p)*y*.5,v=Math.sin(p)*y*.3+10;return[M,Math.max(-5,v),-30]},a=s(t,!0),l=s(t,!1),c=t>=5&&t<20,u=t<7||t>=17;return E.useEffect(()=>{const m=document.createElement("canvas");m.width=2,m.height=256;const d=m.getContext("2d"),p=d.createLinearGradient(0,0,0,256);p.addColorStop(0,o.top),p.addColorStop(1,o.bottom),d.fillStyle=p,d.fillRect(0,0,2,256);const y=new An(m);return y.needsUpdate=!0,n.background=y,()=>{y.dispose()}},[n,o.top,o.bottom]),r.createElement(r.Fragment,null,r.createElement("ambientLight",{intensity:o.ambient}),c&&a[1]>-3&&r.createElement("group",{position:o.sunPos.map((m,d)=>m*8)},r.createElement("mesh",null,r.createElement("sphereGeometry",{args:[5,16,16]}),r.createElement("meshBasicMaterial",{color:i?.period==="evening"?"#FF6B35":"#FDB813",transparent:!0,opacity:.15})),r.createElement("mesh",null,r.createElement("sphereGeometry",{args:[3.5,16,16]}),r.createElement("meshBasicMaterial",{color:i?.period==="evening"?"#FF8855":"#FFD700",transparent:!0,opacity:.3})),r.createElement("mesh",null,r.createElement("sphereGeometry",{args:[2.5,24,24]}),r.createElement("meshStandardMaterial",{color:i?.period==="evening"?"#FF6B35":"#FDB813",emissive:i?.period==="evening"?"#FF4500":"#FFD700",emissiveIntensity:2,metalness:.8,roughness:.2}))),u&&l[1]>-3&&r.createElement("group",{position:o.sunPos.map((m,d)=>m*-6)},r.createElement("mesh",null,r.createElement("sphereGeometry",{args:[4,16,16]}),r.createElement("meshBasicMaterial",{color:"#a0c4e8",transparent:!0,opacity:.1})),r.createElement("mesh",null,r.createElement("sphereGeometry",{args:[2,24,24]}),r.createElement("meshStandardMaterial",{color:"#d0d8e8",emissive:"#8090a0",emissiveIntensity:.5,metalness:.9,roughness:.3}))),(i?.period==="night"||i?.period==="evening")&&r.createElement(Ls,null),r.createElement("directionalLight",{position:o.sunPos,intensity:o.sun,castShadow:!0,color:o.sunColor}),r.createElement("directionalLight",{position:[-3,2,-4],intensity:o.ambient*.5,color:o.rimColor}),r.createElement("directionalLight",{position:[-5,3,-5],intensity:o.ambient*.3}),r.createElement("pointLight",{position:[0,.5,0],intensity:.15,color:"#4080ff",distance:8,decay:2}))}function Ft({side:i="left",behind:n=!1}){const t=E.useRef(),e=E.useRef(),{geometry:o,wireGeometry:s}=E.useMemo(()=>{const l=n?20:14,c=n?10:35,u=n?140:60,m=n?50:350,d=new wt(u,m,l,c),p=new wt(u,m,l,c),y=d.attributes.position.array,M=p.attributes.position.array;for(let v=0;v<y.length;v+=3){const b=y[v],h=y[v+1];let x=0;if(n){const C=Math.sin(b*.05*3.5+h*.05*2)*.5+.5,S=Math.sin(b*.05*1.8+h*.05*2.5+1.5)*.5+.5,L=Math.sin(b*.05*5+h*.05*.8+3.2)*.5+.5,R=Math.pow(C,.5)*S+Math.pow(L,1.2)*.4,k=20,P=Math.abs(b),O=P<k?Math.pow(P/k,2):1,B=1-Math.pow(Math.abs(b)/(u/2),2.5),_=h/(m/2),g=_>.5?1-Math.pow((_-.5)*2,2):1;x=R*B*O*g*14}else{const A=b/(u/2);let C;i==="left"?C=Math.pow(Math.max(0,-A),1.5):C=Math.pow(Math.max(0,A),1.5);const S=.04,L=Math.sin(b*S*6+h*S*.4)*.5+.5,R=Math.sin(b*S*3+h*S*1+2)*.5+.5,k=Math.sin(h*S*.6+b*S*2)*.5+.5;x=(Math.pow(L,.4)*.5+Math.pow(R,.6)*.3+k*.2)*C*18}y[v+2]=x,M[v+2]=x+.03}return d.attributes.position.needsUpdate=!0,p.attributes.position.needsUpdate=!0,d.computeVertexNormals(),p.computeVertexNormals(),{geometry:d,wireGeometry:p}},[n,i]),a=n?[0,0,40]:[i==="left"?-45:45,0,-100];return r.createElement("group",{position:a},r.createElement("mesh",{ref:t,geometry:o,rotation:[-Math.PI/2,0,0],receiveShadow:!0},r.createElement("meshPhysicalMaterial",{color:"#050810",metalness:.7,roughness:.3,reflectivity:.4,clearcoat:.15,clearcoatRoughness:.5,envMapIntensity:.6,flatShading:!0})),r.createElement("mesh",{ref:e,geometry:s,rotation:[-Math.PI/2,0,0]},r.createElement("meshBasicMaterial",{color:"#3a6090",wireframe:!0,transparent:!0,opacity:.35})))}function Ps(){const{geometry:i,wireGeometry:n}=E.useMemo(()=>{const a=new wt(220,30,40,8),l=new wt(220,30,40,8),c=a.attributes.position.array,u=l.attributes.position.array;for(let m=0;m<c.length;m+=3){const d=c[m],p=c[m+1],y=.03,M=Math.sin(d*y*2.5)*.5+.5,v=Math.sin(d*y*5+1.3)*.5+.5,b=Math.sin(d*y*1.2+p*y*4)*.5+.5,h=Math.pow(M,.4)*.5+Math.pow(v,.6)*.35+b*.15,x=25,A=Math.abs(d),C=A<x?Math.pow(A/x,2):1,S=1-Math.pow(Math.abs(d)/(220/2),3),L=(p+30/2)/30,R=Math.pow(L,.5),k=h*S*C*R*22;c[m+2]=k,u[m+2]=k+.05}return a.attributes.position.needsUpdate=!0,l.attributes.position.needsUpdate=!0,a.computeVertexNormals(),l.computeVertexNormals(),{geometry:a,wireGeometry:l}},[]);return r.createElement("group",{position:[0,0,-260]},r.createElement("mesh",{geometry:i,rotation:[-Math.PI/2,0,0]},r.createElement("meshPhysicalMaterial",{color:"#080c18",metalness:.6,roughness:.35,reflectivity:.3,clearcoat:.1,clearcoatRoughness:.6,envMapIntensity:.5,flatShading:!0})),r.createElement("mesh",{geometry:n,rotation:[-Math.PI/2,0,0]},r.createElement("meshBasicMaterial",{color:"#1a3050",wireframe:!0,transparent:!0,opacity:.3})),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.1,10]},r.createElement("planeGeometry",{args:[200,3]}),r.createElement("meshBasicMaterial",{color:"#2050a0",transparent:!0,opacity:.15})))}const Is=1e3;function Ds({totalWeight:i=0,active:n=!1,characterRef:t,onComplete:e}){const o=bn(In,"./models/car.glb"),s=E.useRef(),[a,l]=E.useState([]),[c,u]=E.useState("idle"),m=E.useRef({x:0,y:0,z:0}),d=E.useMemo(()=>i<=0?0:Math.max(1,Math.round(i/Is)),[i]);if(E.useEffect(()=>{if(n&&d>0){let M=0,v=0,b=0;if(t?.current){const A=new oe;t.current.getWorldPosition(A),M=A.x,v=A.y,b=A.z}m.current={x:M,y:v,z:b};const h=[],x=6+Math.sqrt(d)*1.5;for(let A=0;A<d;A++){const C=A/d*Math.PI*2+Math.random()*.5,S=x*(.4+Math.random()*.6);h.push({id:A,offsetX:Math.cos(C)*S,offsetZ:Math.sin(C)*S,y:30+Math.random()*20,targetY:v+.05,rotationY:Math.random()*Math.PI*2,rotationX:Math.random()*.1-.05,velocity:0,landed:!1,delay:A*.1,scale:1.8+Math.random()*.4})}l(h),u("dropping")}else n||(l([]),u("idle"))},[n,d,t]),tt((M,v)=>{if(c!=="dropping"||a.length===0)return;let b=!0;l(h=>h.map(x=>{if(x.landed)return x;if(x.delay>0)return b=!1,{...x,delay:x.delay-v};const C=x.velocity+25*v;let S=x.y-C*v;return S<=x.targetY?(S=x.targetY,{...x,y:S,velocity:0,landed:!0}):(b=!1,{...x,y:S,velocity:C})})),b&&a.length>0&&a.every(h=>h.landed)&&u("landed")}),!n||a.length===0)return null;const{x:p,z:y}=m.current;return r.createElement("group",{ref:s},a.map(M=>r.createElement("primitive",{key:M.id,object:o.scene.clone(),position:[p+M.offsetX,M.y,y+M.offsetZ],rotation:[M.rotationX,M.rotationY,0],scale:M.scale})))}function Os({progress:i,isMoving:n,onCheckpointReached:t,onHoverMuscle:e,triggerCelebration:o,onCelebrationComplete:s,workoutData:a,muscleOpacities:l,muscleGenres:c,muscleTonnage:u,timeOfDay:m,cameraZoom:d,viewMode:p="journey",currentCheckpointId:y=null,selectedExercise:M=null,isAnimationPaused:v=!1,showCars:b=!1,carWeight:h=0}){const x=E.useRef(),{scene:A}=vt();return E.useEffect(()=>(new Me(1714762),A.environment=null,()=>{A.environment=null}),[A]),r.createElement(r.Fragment,null,r.createElement(_s,{timeOfDay:m}),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.02,-100],receiveShadow:!0},r.createElement("planeGeometry",{args:[400,400,100,100]}),r.createElement("meshPhysicalMaterial",{color:"#050810",metalness:.7,roughness:.3,reflectivity:.4,clearcoat:.15,clearcoatRoughness:.5,envMapIntensity:.6})),r.createElement("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.01,-100]},r.createElement("planeGeometry",{args:[400,400,100,100]}),r.createElement("meshBasicMaterial",{color:"#3a6090",wireframe:!0,transparent:!0,opacity:.35})),r.createElement("fog",{attach:"fog",args:["#05080f",15,180]}),r.createElement(Ft,{side:"left"}),r.createElement(Ft,{side:"right"}),r.createElement(Ft,{behind:!0}),r.createElement(Ps,null),r.createElement(E.Suspense,{fallback:null},r.createElement(bs,{ref:x,onHoverMuscle:e,isMoving:n,triggerCelebration:o,onCelebrationComplete:s,showMuscles:!0,muscleOpacities:l,muscleGenres:c,muscleTonnage:u,currentCheckpointId:y,selectedExercise:M,isAnimationPaused:v})),b&&r.createElement(E.Suspense,{fallback:null},r.createElement(Ds,{totalWeight:h,active:b,characterRef:x})),r.createElement(Ss,{characterRef:x,progress:i,onCheckpointReached:t,onMovementStateChange:()=>{},debugPath:!0,checkpointsOverride:a}),r.createElement(Cs,{targetRef:x,mode:Wn.FOLLOW,zoom:b?.3:d,lookAtOffset:[0,.8,0],config:{distance:4,height:1.5,followSpeed:.08,lookAtOffset:[0,.8,0],minDistance:b?8:4,maxDistance:p==="insights"?25:b?15:10}}))}function Ns({status:i="Initializing...",progress:n=0}){return r.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:f.color.bgDeep,color:f.color.textPrimary,fontFamily:f.font.body}},r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"3rem",background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",borderRadius:"24px",border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"}},r.createElement(_n,{size:"lg"}),r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:f.color.textSecondary,fontSize:"0.9375rem"}},r.createElement("div",{style:{width:"16px",height:"16px",border:`2px solid ${f.color.borderDefault}`,borderTop:`2px solid ${f.color.accent}`,borderRadius:"50%",animation:"spin 1s linear infinite"}}),i),r.createElement("div",{style:{width:"200px",height:"4px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"2px",overflow:"hidden"}},r.createElement("div",{style:{height:"100%",width:`${Math.max(5,n*100)}%`,background:`linear-gradient(90deg, ${f.color.accent}, ${f.color.accentGlow})`,borderRadius:"2px",transition:"width 0.3s ease-out",boxShadow:`0 0 10px ${f.color.accent}`}})),r.createElement("div",{style:{fontSize:"0.75rem",color:f.color.textTertiary}},Math.round(n*100),"%")),r.createElement("style",null,`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `))}function Fs({viewMode:i}){return r.createElement("div",{style:{position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",color:f.color.textTertiary,fontSize:"0.75rem",fontFamily:f.font.body,display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",animation:"breathe 3s ease-in-out infinite",pointerEvents:"none"}},r.createElement("span",null,i===ge.WEEK?"Scroll up for day view":"Scroll down for week view"),r.createElement("svg",{width:"16",height:"24",viewBox:"0 0 16 24",fill:"none"},r.createElement("path",{d:i===ge.WEEK?"M8 20v-12M4 12l4-4 4 4":"M8 4v12M4 12l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},r.createElement("animate",{attributeName:"opacity",values:"0.5;1;0.5",dur:"2s",repeatCount:"indefinite"}))),r.createElement("style",null,`
        @keyframes breathe {
          0%, 100% { opacity: 0.6; }
          50% { opacity: 1; }
        }
      `))}function Bt({icon:i,label:n,action:t}){const e={scroll:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.createElement("line",{x1:"12",y1:"6",x2:"12",y2:"10"})),arrows:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M5 12h14M12 5l7 7-7 7"})),drag:r.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},r.createElement("path",{d:"M12 2L12 22M2 12L22 12"}),r.createElement("circle",{cx:"12",cy:"12",r:"3"}))};return r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.7)",fontFamily:f.font.body}},r.createElement("span",{style:{color:f.color.accent}},e[i]),r.createElement("span",{style:{fontWeight:500,minWidth:"80px"}},n),r.createElement("span",{style:{color:"rgba(255, 255, 255, 0.5)"}},t))}function Bs(){const[i,n]=E.useState(null),[t,e]=E.useState(null),[o,s]=E.useState(!1),[a,l]=E.useState(null),[c,u]=E.useState(!1),[m,d]=E.useState({hour:12,period:"afternoon"}),[p,y]=E.useState(!1),[M,v]=E.useState(!1),[b]=E.useState(!0),[h,x]=E.useState(!1),[A,C]=E.useState(!0),[S,L]=E.useState(!1),[R,k]=E.useState(null),[P,O]=E.useState(!1),[B,_]=E.useState(null),[g,T]=E.useState(!1),[I,N]=E.useState(0),[W,F]=E.useState(null),[D,j]=E.useState(null),[H,X]=E.useState(!0),[re,Y]=E.useState("Initializing React..."),[q,ne]=E.useState(.05),{audioState:ie,audioRef:fe,toggleAudio:ye,playPreview:G,setAudioPreview:J,handleAudioEnded:xe,setVolume:Ae,stopAudio:Re,pauseAudio:ze,resumeAudio:ue}=no(),Se=Kt();E.useEffect(()=>{if(S)return;const $=Z=>{L(!0)},U=()=>{L(!0)};return window.addEventListener("keydown",$),window.addEventListener("click",U),()=>{window.removeEventListener("keydown",$),window.removeEventListener("click",U)}},[S]),E.useEffect(()=>{Y("Loading workout data..."),ne(.15),Wr().then($=>(Y("Loading music data..."),ne(.35),Xr().then(U=>({workout:$,spotify:U})))).then(({workout:$,spotify:U})=>{if(Y("Processing checkpoints..."),ne(.55),console.log("[App] Workout data loaded:",$.checkpoints?.length,"checkpoints"),console.log("[App] Spotify data loaded:",U?.size,"days"),$.checkpoints&&U){Y("Matching songs to exercises..."),ne(.7);const Z=$.checkpoints.map(Q=>{if(Q.isStart)return Q;const pe=Jr(U,Q.dateRaw||Q.date),ce=Qr(U,Q.dateRaw||Q.date,Q.exercises||[],Vt),Ne=(Q.dateRaw||Q.date)?.split(" ")[0]?.split("T")[0]?.replace(/"/g,""),Ze=Yr(U,Ne,ce.topGenre!=="unknown"?ce.topGenre:null,5),pt=qr(U,Ne,Q.exercises||[],ce.topGenre!=="unknown"?ce.topGenre:null),jn=(Q.exercises||[]).map(qt=>({...qt,song:pt[qt.name]||null}));return{...Q,exercises:jn,spotify:{...pe,song:ce.topSong||pe.song,genre:ce.topGenre!=="unknown"?ce.topGenre:pe.genre,alternativeSongs:Ze},smartMuscleGenres:ce.muscleGenres}});$.checkpoints=Z}Y("Preparing 3D viewport..."),ne(.9),F($),j(U),setTimeout(()=>{Y("Ready!"),ne(1),setTimeout(()=>X(!1),200)},100)}).catch($=>{console.error("[App] Failed to load data:",$),X(!1)})},[]);const Ie=E.useMemo(()=>W?.checkpoints?W.checkpoints.map($=>({...$,position:Fe+$.position*($e-Fe)})):[],[W]),{progress:se,velocity:we,zoom:he,viewMode:le,setZoomLevel:Ce,goToNextCheckpoint:it,goToPrevCheckpoint:kt,goToCheckpointIndex:Ye,currentCheckpointIndex:qe,totalCheckpoints:Xe}=to({checkpoints:Ie,disabled:!S}),lt=E.useCallback(()=>{Ce(le===ge.WEEK?1:0)},[Ce,le]),Ge=E.useMemo(()=>se<Fe?"hero":se>$e?"summary":"journey",[se]),De=E.useMemo(()=>se<=Fe?0:se>=$e?1:(se-Fe)/($e-Fe),[se]),ct=E.useMemo(()=>se<=0?1:se>=Fe?0:1-se/Fe,[se]),ut=E.useMemo(()=>se<=$e?0:se>=1?1:(se-$e)/(1-$e),[se]),ae=E.useMemo(()=>{if(!W?.checkpoints||W.checkpoints.length===0)return null;const $=W.checkpoints;let U=null,Z=1/0;for(const Q of $){const pe=Math.abs(De-Q.position);pe<Z&&(Z=pe,U=Q)}return U&&Z<.025?U:null},[W,De]);E.useEffect(()=>{if(ae?.dateRaw){const $=eo(ae.dateRaw);d($)}},[ae]),E.useEffect(()=>{s(ae!==null),ae&&(e(ae),k(null),O(!1),_(null),T(!1),Re())},[ae,Re]);const dt=E.useCallback(($,U,Z=null)=>{if(R?.name===$){O(ce=>!ce);return}k({name:$,animationFile:U}),O(!1);const Q=Z?`${Z.artistName}-${Z.trackName}`:null,pe=B?`${B.artistName}-${B.trackName}`:null;Q!==pe&&(Re(),_(Z?{...Z,shouldAutoPlay:!0}:null))},[R,B,Re]),Oe=E.useCallback(()=>{O($=>{const U=!$;return U?ze():ue(),U})},[ze,ue]),Yt=E.useCallback($=>{g?(T(!1),N(0)):(N($),T(!0))},[g]);E.useEffect(()=>(window.__debug={_state:{},goToCheckpoint:$=>{const U=window.__debug._state.checkpointPositions;if(!U||$<0||$>=U.length){console.log(`[Debug] Invalid checkpoint index. Valid range: 0-${U?.length-1}`);return}const Z=U[$];console.log(`[Debug] Going to checkpoint ${$}: ${Z.label||Z.id}`),window.__debug._state.goToCheckpointIndex($)},listCheckpoints:()=>{console.log("[Debug] Checkpoints:"),window.__debug._state.checkpointPositions?.forEach(($,U)=>{console.log(`  ${U}: ${$.label||$.id} (position: ${$.position?.toFixed(3)})`)})},tourCheckpoints:async($=3e3)=>{const U=window.__debug._state.checkpointPositions;console.log(`[Debug] Starting checkpoint tour (${$}ms per checkpoint)...`);for(let Z=0;Z<(U?.length||0);Z++){const Q=U[Z];console.log(`[Debug] Checkpoint ${Z}/${U.length-1}: ${Q.label||Q.id}`),window.__debug._state.goToCheckpointIndex(Z),await new Promise(pe=>setTimeout(pe,$))}console.log("[Debug] Tour complete!")},getState:()=>({progress:window.__debug._state.rawProgress,currentCheckpoint:window.__debug._state.activeCheckpoint?.label||window.__debug._state.activeCheckpoint?.id,isMoving:window.__debug._state.isMoving,checkpointCount:window.__debug._state.checkpointPositions?.length}),setProgress:$=>window.__debug._state.goToCheckpointIndex(0)},console.log("[Debug] Use __debug.listCheckpoints() or __debug.tourCheckpoints()"),()=>{delete window.__debug}),[]),E.useEffect(()=>{window.__debug&&(window.__debug._state={checkpointPositions:Ie,rawProgress:se,activeCheckpoint:ae,isMoving:c,goToCheckpointIndex:Ye})},[Ie,se,ae,c,Ye]);const w=E.useMemo(()=>!W||!W.checkpoints?null:jr(W.checkpoints,De),[W,De]),z=E.useMemo(()=>{if(!ae)return null;if(ae.smartMuscleGenres&&Object.keys(ae.smartMuscleGenres).length>0)return ae.smartMuscleGenres;const $=ae.spotify?.genre;if(!$||$==="unknown")return null;const U={},Z=ae.muscleVolumes||{};for(const Q of Object.keys(Z))U[Q]=$;return U},[ae]),V=E.useMemo(()=>ae&&ae.muscleTonnage||null,[ae]);E.useEffect(()=>{u(we>5e-4)},[we]);const ee=E.useCallback($=>{console.log("[Checkpoint]",$.id,$.label),$.celebration&&l(`${$.id}-${Date.now()}`)},[]),de=E.useCallback(()=>{l(null)},[]);if(H)return r.createElement(Ns,{status:re,progress:q});const Le=Ge==="hero"?.3+(1-ct)*.7:Ge==="summary"?1-ut*.7:1,me=()=>p||!t&&le!==ge.WEEK?null:r.createElement(us,{viewMode:le,checkpoint:t,allCheckpoints:W?.checkpoints||[],onPrev:kt,onNext:it,currentIndex:qe,totalCheckpoints:Xe,canGoPrev:qe>0,canGoNext:qe<Xe-1,audioState:ie,onSetAudioPreview:J,onToggleAudio:ye,onPlayPreview:G,onSetVolume:Ae,onMinimize:()=>y(!0),onExpand:()=>v($=>!$),isExpanded:M,onToggleViewMode:lt,currentAnimation:R?.name,onSelectExercise:dt,muscleGenres:z,isAnimationPaused:P,onToggleAnimationPause:Oe,workoutData:W,spotifyData:D,onNavigateToCheckpoint:Ye,isMobile:Se,onShowCars:Yt,currentExerciseSong:B}),mt=()=>r.createElement("div",{style:{width:"100%",height:"100%",position:"relative",opacity:Le,transition:"opacity 0.3s ease"}},r.createElement($n,{shadows:!0,camera:{position:[0,1.5,4],fov:50},onCreated:()=>{setTimeout(()=>C(!1),500)}},r.createElement(Os,{progress:De,isMoving:c,onCheckpointReached:ee,onHoverMuscle:n,triggerCelebration:a,onCelebrationComplete:de,workoutData:W,muscleOpacities:w,muscleGenres:z,muscleTonnage:V,timeOfDay:m,cameraZoom:he,viewMode:le===ge.WEEK?"insights":"journey",currentCheckpointId:t?.id,selectedExercise:R,isAnimationPaused:P,showCars:g,carWeight:I})),A&&r.createElement("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(5, 8, 16, 0.9)",backdropFilter:"blur(8px)",zIndex:100}},r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"}},r.createElement("div",{style:{width:"40px",height:"40px",border:`3px solid ${f.color.borderDefault}`,borderTop:`3px solid ${f.color.accent}`,borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.createElement("span",{style:{fontSize:"0.875rem",color:f.color.textSecondary,fontFamily:f.font.body}},"Loading 3D viewport...")),r.createElement("style",null,`
            @keyframes spin {
              to { transform: rotate(360deg); }
            }
          `)),r.createElement("div",{style:{position:"absolute",top:"20px",right:"24px",zIndex:10,display:"flex",alignItems:"center",gap:"12px"}},r.createElement("button",{onClick:()=>x($=>!$),style:{background:h?"rgba(59, 130, 246, 0.15)":"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",border:`1px solid ${h?"rgba(59, 130, 246, 0.3)":"rgba(255, 255, 255, 0.08)"}`,borderRadius:"10px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:h?"#3b82f6":"rgba(255,255,255,0.6)",fontWeight:600,fontSize:"14px",width:"36px",height:"36px",boxShadow:h?"0 4px 20px rgba(59, 130, 246, 0.15)":"0 2px 12px rgba(0, 0, 0, 0.3)"},title:"Help"},"?")),h&&r.createElement("div",{style:{position:"absolute",top:"70px",right:"24px",zIndex:20,background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",borderRadius:"16px",border:"1px solid rgba(255, 255, 255, 0.08)",padding:"20px 24px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)"}},r.createElement("div",{style:{fontSize:"0.875rem",fontWeight:600,color:f.color.textPrimary,marginBottom:"10px",fontFamily:f.font.body}},"About Forma"),r.createElement("p",{style:{fontSize:"0.75rem",color:f.color.textSecondary,lineHeight:1.5,marginBottom:"16px",fontFamily:f.font.body}},"Each checkpoint represents a workout day. The side panel shows detailed information including exercises, music played, and workout insights. Use the week view graph to quickly navigate between workouts."),r.createElement("div",{style:{height:"1px",background:"rgba(255, 255, 255, 0.08)",marginBottom:"16px"}}),r.createElement("div",{style:{fontSize:"0.75rem",fontWeight:600,color:f.color.textTertiary,marginBottom:"10px",fontFamily:f.font.body,textTransform:"uppercase",letterSpacing:"0.05em"}},"Controls"),r.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},r.createElement(Bt,{icon:"scroll",label:"Scroll",action:"Zoom week/day view"}),r.createElement(Bt,{icon:"arrows",label:"Arrow Keys",action:"Navigate checkpoints"}),r.createElement(Bt,{icon:"drag",label:"Click + Drag",action:"Rotate camera"}))),r.createElement(po,{muscle:i}),r.createElement(Fs,{viewMode:le}));return Ge==="summary"&&ut>.3?r.createElement(r.Fragment,null,ie.previewUrl&&r.createElement("audio",{ref:fe,src:ie.previewUrl,onEnded:xe,preload:"none"}),p&&r.createElement(rn,{items:[{id:"panel",label:"Journey Complete"}],onRestore:()=>y(!1),audioState:ie,onToggleAudio:ye}),r.createElement(At,{showLeftPanel:b&&!p,isLeftPanelExpanded:M,leftPanel:me(),mainContent:mt()})):Ge==="hero"||!S&&se<.1?r.createElement(r.Fragment,null,ie.previewUrl&&r.createElement("audio",{ref:fe,src:ie.previewUrl,onEnded:xe,preload:"none"}),r.createElement(At,{showLeftPanel:!0,leftPanel:me(),mainContent:mt()}),r.createElement(fo,{workoutData:W,spotifyData:D,opacity:S?ct:1,showDismissHint:!S})):r.createElement(r.Fragment,null,ie.previewUrl&&r.createElement("audio",{ref:fe,src:ie.previewUrl,onEnded:xe,preload:"none"}),p&&r.createElement(rn,{items:[{id:"panel",label:le===ge.WEEK?"Week View":t?.label||"Day View"}],onRestore:()=>y(!1),audioState:ie,onToggleAudio:ye}),r.createElement(At,{showLeftPanel:b&&!p&&Ge==="journey"&&(le===ge.WEEK||t!==null),isLeftPanelExpanded:M,leftPanel:me(),mainContent:mt()}))}const Wt=document.getElementById("initial-loader");Wt&&(Wt.classList.add("hidden"),setTimeout(()=>Wt.remove(),300));Rn(document.getElementById("root")).render(r.createElement(Bs,null));
